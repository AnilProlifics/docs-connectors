= Azure Event Hubs Management Connector 1.0 Examples - Mule 4

The following examples show several Mule flows for Azure Event Hubs Management Connector:

* <<create-event-hub>>
* <<update-event-hub>>

== Prerequisites

* Java 8 or 11
* Anypoint Studio 7.5 and later
* Mule runtime engine (Mule) 4.3.0 and later
* DataWeave

[[create-event-hub]]
== Create an Event Hub

This Mule flow creates an Event Hub. The result is displayed on the console.

=== Create the First Flow

This example uses the following operations:

* *HTTP Listener* +
Accepts data from HTTP requests
+
Enter the following values:
[%header%autowidth.spread]
|===
|Field|Value
|Path | `eventhub`
|===
* *Update or create event hub* +
Creates an Event Hub.
+
Enter the following values:
[%header%autowidth.spread]
|===
|Field|Value
|Connector configuration | `Event_Hubs_Management_Connector_Config`
|Event Hub Path | `/test`
|Api Version | `2014-01`
|Body |
----
'<entry xmlns="http://www.w3.org/2005/Atom">
  <content type="application/xml">
    <EventHubDescription xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/netservices/2010/10/servicebus/connect">
      <MessageRetentionInDays>3</MessageRetentionInDays>
      <PartitionCount>8</PartitionCount>
    </EventHubDescription>
  </content>
</entry>'
----
|===
* *Transform Message* +
Transforms the response to JSON
+
Enter the following value:
----
%dw 2.0
output application/json
ns ns0 http://www.w3.org/2005/Atom
ns ns01 http://schemas.microsoft.com/netservices/2010/10/servicebus/connect
---
{
	"entry": payload.ns0#entry,
}
----
* *Logger* +
Shows the HTTP response from the *Update or create event hub* operation
+
Enter the following values:
[%header%autowidth.spread]
|===
|Field|Value
|Message | `payload`
|Level | `INFO (Default)`
|===
* *Flow Reference* +
Deletes an Event Hub. References the <<delete-event-hub-1, Delete Event Hub subflow>>.

[delete-event-hub-1]
=== Create the Second Flow

This example uses the following operations:

* *Delete event hub* +
Deletes an Event Hub
+
Enter the following values:
[%header%autowidth.spread]
|===
|Field|Value
|Connector configuration | `Event_Hubs_Management_Connector_Config`
|Event Hub Path | `test`
|===

image::create-eventhub.png[Studio Flow for the Update or create event hub operation]

image::delete-eventhub-subflow.png[Studio Flow for the Delete event hub operation subflow]

=== XML for This Example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:azure-event-hub-management-connector="http://www.mulesoft.org/schema/mule/azure-event-hub-management-connector"
	  xmlns:http="http://www.mulesoft.org/schema/mule/http"
	  xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/azure-event-hub-management-connector http://www.mulesoft.org/schema/mule/azure-event-hub-management-connector/current/mule-azure-event-hub-management-connector.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<configuration-properties doc:name="Configuration properties" doc:id="ba516762-cc65-45c6-b62a-0b0e6c7aeb60" file="mule-app.properties" />
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="0ef86c37-d049-4110-b0a5-65ede8d60436" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<azure-event-hub-management-connector:config name="Event_Hubs_Management_Connector_Config" doc:name="Event Hubs Management Connector Config" doc:id="b45ecad1-d2ba-4b3e-a948-ee258f1caea2" >
		<azure-event-hub-management-connector:shared-access-signature-connection namespace="${sas-config.namespace}" sharedAccessKeyName="${sas-config.sharedAccessKeyName}" sharedAccessKey="${sas-config.sharedAccessKey}"/>
	</azure-event-hub-management-connector:config>
	<flow name="create-eventhub-demo-flow" doc:id="28055823-f6a0-4484-b245-43e3723ff560" >
		<http:listener doc:name="Event Hub Create Endpoint" doc:id="21703161-9050-4bc7-9e7f-b1337a4deb97" path="/eventhub" config-ref="HTTP_Listener_config"/>
		<azure-event-hub-management-connector:put-event-hub doc:name="Create Event Hub" doc:id="416f5c1c-e4d1-4cce-b491-f3ab71451d49" eventHubPathUriParam="/test" versionParam="2014-01" config-ref="Event_Hubs_Management_Connector_Config">
			<azure-event-hub-management-connector:put-event-hub-path-body ><![CDATA[#['<entry xmlns="http://www.w3.org/2005/Atom">
  <content type="application/xml">
    <EventHubDescription xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/netservices/2010/10/servicebus/connect">
      <MessageRetentionInDays>3</MessageRetentionInDays>
      <PartitionCount>8</PartitionCount>
    </EventHubDescription>
  </content>
</entry>']]]></azure-event-hub-management-connector:put-event-hub-path-body>
		</azure-event-hub-management-connector:put-event-hub>
		<ee:transform doc:name="Response to JSON" doc:id="d79cccb6-be31-440c-b8ca-27e7429227c6" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
ns ns0 http://www.w3.org/2005/Atom
ns ns01 http://schemas.microsoft.com/netservices/2010/10/servicebus/connect
---
{
	"entry": payload.ns0#entry,
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Logger" doc:id="0e76408c-31e6-4302-8c73-8b166fc6bc9c" message="#[payload]"/>
		<flow-ref doc:name="Delete Event Hub" doc:id="23017e59-cbfb-4051-9b28-e8c1dc28ab96" name="delete-subflow"/>
	</flow>
<sub-flow name="delete-subflow" doc:id="24c415c0-d89e-4ea1-b831-019defeef0ce">
  <azure-event-hub-management-connector:delete-event-hub doc:name="Delete event Hub" doc:id="b5c48f38-1b93-4ce4-98da-a74f6ff30df0" eventHubPathUriParam="test" config-ref="Event_Hubs_Management_Connector_Config"/>
</sub-flow>
</mule>
----

=== Steps for Running This Example

. Verify that your connector is configured.
. Save the project.
. From a web browser, test the application by entering `http://localhost:8081/eventhub`.

[[update-event-hub]]
== Update an Event Hub

This Mule flow updates an Event Hub. You can update the message retention in the days attribute. The result is displayed on the console.

=== Create the First Flow

This example uses the following operations:

* *HTTP Listener* +
Accepts data from HTTP requests
+
Enter the following values:
[%header%autowidth.spread]
|===
|Field|Value
|Path | `/eventhubupdate`
|===
* *Update or create event hub* +
Creates an Event Hub with a message retention of 3 days.
+
Enter the following values:
[%header%autowidth.spread]
|===
|Field|Value
|Connector configuration | `Event_Hubs_Management_Connector_Config`
|Event Hub Path | `/test`
|Api Version | `2014-01`
|Body |
----
'<entry xmlns="http://www.w3.org/2005/Atom">
  <content type="application/xml">
    <EventHubDescription xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/netservices/2010/10/servicebus/connect">
      <MessageRetentionInDays>3</MessageRetentionInDays>
      <PartitionCount>8</PartitionCount>
    </EventHubDescription>
  </content>
</entry>'
----
|===
* *Transform Message* +
Transforms the response to JSON
+
Enter the following value:
----
%dw 2.0
output application/json
ns ns0 http://www.w3.org/2005/Atom
ns ns01 http://schemas.microsoft.com/netservices/2010/10/servicebus/connect
---
{
	"entry": payload.ns0#entry,
}
----
* *Logger* +
Shows the HTTP response from the *Update or create event hub* operation
+
Enter the following values:
[%header%autowidth.spread]
|===
|Field|Value
|Message | `payload`
|Level | `INFO (Default)`
|===
* *Update or create event hub* +
Updates an Event Hub with a message retention of 6 days.
+
Enter the following values:
[%header%autowidth.spread]
|===
|Field|Value
|Connector configuration | `Event_Hubs_Management_Connector_Config`
|Event Hub Path | `/test`
|Api Version | `2014-01`
|If Match | `*`
|Body |
----
'<entry xmlns="http://www.w3.org/2005/Atom">
  <content type="application/xml">
    <EventHubDescription xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/netservices/2010/10/servicebus/connect">
      <MessageRetentionInDays>6</MessageRetentionInDays>
      <PartitionCount>8</PartitionCount>
    </EventHubDescription>
  </content>
</entry>'
----
|===
* *Transform Message* +
Transforms the response to JSON
+
Enter the following value:
----
%dw 2.0
output application/json
ns ns0 http://www.w3.org/2005/Atom
ns ns01 http://schemas.microsoft.com/netservices/2010/10/servicebus/connect
---
{
	"entry": payload.ns0#entry,
}
----
* *Logger* +
Shows the HTTP response from the *Update or create event hub* operation
+
Enter the following values:
[%header%autowidth.spread]
|===
|Field|Value
|Message | `payload`
|===
* *Flow Reference* +
Deletes an Event Hub. References the <<delete-event-hub-2, Delete Event Hub subflow>>.

[delete-event-hub-2]
=== Create the Second Flow

This example uses the following operations:

* *Delete event hub* +
Deletes an Event Hub
+
Enter the following values:
[%header%autowidth.spread]
|===
|Field|Value
|Connector configuration | `Event_Hubs_Management_Connector_Config`
|Event Hub Path | `test`
|===

image::update-eventhub.png[Studio Flow for the Update or create event hub operation]

image::delete-eventhub-subflow.png[Studio Flow for the Delete event hub operation subflow]

=== XML for This Example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:azure-event-hub-management-connector="http://www.mulesoft.org/schema/mule/azure-event-hub-management-connector"
	  xmlns:http="http://www.mulesoft.org/schema/mule/http"
	  xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/azure-event-hub-management-connector http://www.mulesoft.org/schema/mule/azure-event-hub-management-connector/current/mule-azure-event-hub-management-connector.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<configuration-properties doc:name="Configuration properties" doc:id="03e5822b-3325-4c56-9650-cea2e27f0758" file="mule-app.properties" />
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="0d1c1064-e368-4255-a693-2026138ee895" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<azure-event-hub-management-connector:config name="Event_Hubs_Management_Connector_Config" doc:name="Event Hubs Management Connector Config" doc:id="b69110c5-d1d6-47b6-b419-fbfda540b70a" >
		<azure-event-hub-management-connector:shared-access-signature-connection namespace="${sas-config.namespace}" sharedAccessKeyName="${sas-config.sharedAccessKeyName}" sharedAccessKey="${sas-config.sharedAccessKey}"/>
	</azure-event-hub-management-connector:config>
  <flow name="update-eventhub-demo-flow" doc:id="fc69af2f-6e58-4a46-918b-58ea4fb57268" >
  <http:listener doc:name="Event Hub Update Endpoint" doc:id="29e5966c-9746-4d12-945f-aeddef07ff13" path="/eventhubupdate" config-ref="HTTP_Listener_config"/>
  <azure-event-hub-management-connector:put-event-hub doc:name="Create event hub with message retention in days = 3" doc:id="272e28ce-7817-492e-8104-e5ece2afb93a" eventHubPathUriParam="/test" versionParam="2014-01" config-ref="Event_Hubs_Management_Connector_Config">
    <azure-event-hub-management-connector:put-event-hub-path-body ><![CDATA[#['<entry xmlns="http://www.w3.org/2005/Atom">
<content type="application/xml">
  <EventHubDescription xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/netservices/2010/10/servicebus/connect">
    <MessageRetentionInDays>3</MessageRetentionInDays>
    <PartitionCount>8</PartitionCount>
  </EventHubDescription>
</content>
</entry>']]]></azure-event-hub-management-connector:put-event-hub-path-body>
  </azure-event-hub-management-connector:put-event-hub>
  <ee:transform doc:name="Response to JSON" doc:id="745e7da8-9365-4058-a31a-727d308e5150" >
    <ee:message >
      <ee:set-payload ><![CDATA[%dw 2.0
output application/json
ns ns0 http://www.w3.org/2005/Atom
ns ns01 http://schemas.microsoft.com/netservices/2010/10/servicebus/connect
---
{

"entry": payload.ns0#entry,

}]]></ee:set-payload>
    </ee:message>
  </ee:transform>
  <logger level="INFO" doc:name="Event Hub created" doc:id="4e0d2be1-0adc-45cb-b063-25f445217dda" message="#[payload]"/>
  <azure-event-hub-management-connector:put-event-hub doc:name="Update event hub with message retention in days = 6" doc:id="35d2d983-e27c-44a8-bee7-26ef8adcb97f" eventHubPathUriParam="/test" versionParam="2014-01" ifMatchHeader="*" config-ref="Event_Hubs_Management_Connector_Config">
    <azure-event-hub-management-connector:put-event-hub-path-body ><![CDATA[#['<entry xmlns="http://www.w3.org/2005/Atom">
<content type="application/xml">
  <EventHubDescription xmlns:i="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://schemas.microsoft.com/netservices/2010/10/servicebus/connect">
    <MessageRetentionInDays>6</MessageRetentionInDays>
    <PartitionCount>8</PartitionCount>
  </EventHubDescription>
</content>
</entry>']]]></azure-event-hub-management-connector:put-event-hub-path-body>
  </azure-event-hub-management-connector:put-event-hub>
  <ee:transform doc:name="Transform Message" doc:id="d9e3a400-66ce-4895-b25c-aa1063351d18" >
    <ee:message >
      <ee:set-payload ><![CDATA[%dw 2.0
output application/json
ns ns0 http://www.w3.org/2005/Atom
ns ns01 http://schemas.microsoft.com/netservices/2010/10/servicebus/connect
---
{

"entry": payload.ns0#entry,

}]]></ee:set-payload>
    </ee:message>
  </ee:transform>
  <logger level="INFO" doc:name="Event Hub updated" doc:id="ad0a50a8-f118-4b7e-a304-e77f1d5ffba7" message="#[payload]"/>
  <flow-ref doc:name="Delete Event Hub" doc:id="2e048158-24d8-4517-afb5-15e54bf15d62" name="delete-subflow"/>
</flow>
<sub-flow name="delete-subflow" doc:id="7920f5bb-065b-4af0-a863-e4091ffd5410">
  <azure-event-hub-management-connector:delete-event-hub doc:name="Delete event Hub" doc:id="64f3c260-563d-4dd4-8b27-cfbca562dde9" eventHubPathUriParam="test" config-ref="Event_Hubs_Management_Connector_Config"/>
</sub-flow>
</mule>
----

=== Steps for Running This Example

. Verify that your connector is configured.
. Save the project.
. From a web browser, test the application by entering `localhost:8081/eventhubupdate`.
