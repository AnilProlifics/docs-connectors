= Amazon EC2 Connector Example - Mule 4

[[example-use-case]]
=== Create an EBS Volume

This example creates an Amazon EBS (Elastic Block Store) volume that you can attach to an Amazon EC2 instance that is in the same availability zone:

image::amazon-ec2-create-volume-usecase-flow.png[Creating an EBS volume]

. Create a new Mule project in Anypoint Studio.
. Create a file named `mule-artifact.properties` to store your Amazon credentials. 
.. Add the following properties to the `mule-artifact.properties` file:
+
[source,text,linenums]
----
amazon.accesskey=<Access Key>
amazon.secretkey=<Secret Key>
amazon.region=<Region>
amazon.sessionToken=<Session Token>
----
+
.. Save the `mule-artifact.properties` file in the project's `src/main/resources` directory.
. Drag the *HTTP Listener* component to the canvas.
. Add a global element for *HTTP Listener*:
.. Select *Listener* on the canvas.
.. Click the plus sign next to the *Connector Configuration* field.
.. In the *Global Element Properties* dialog, provide the following values: +
* *Name* +
`Listener`
* *Host* +
`localhost`
* *Port* +
`8081`
+
The following image shows an example of the *Listener* global element configuration:
+
image::http-listener-config.png[Global element configuration for HTTP Listener]
+
.. Click *OK*.
. Drag the Amazon EC2 Connector *Create volume* operation next to the *Listener* component.
. Add a new Amazon EC2 global element:
.. Select the *Create volume* operation on the canvas.
.. Click *+* next to the *Connector Configuration* field.
. Configure the global element as follows:
* *Name* +
Name by which to reference the connector
* *Session Token* +
Session token used to validate the temporary security credentials
* *Access Key* +
Alphanumeric text string that uniquely identifies the user who owns the account
* *Secret Key* 
Key that acts as the password
* *Region Endpoint* +
Region to select from the drop-down menu for the Amazon EC2 client
+
The following image shows an example of what the configuration looks like:
+
image::mule-amazon-ec2-global-config.png[ec2 global config]
+
The corresponding XML looks like this:
+
[source,xml,linenums]
----
<ec2:config
	name="Amazon_EC2_configuration"
	doc:name="Amazon EC2 Configuration" >
<ec2:basic-connection
	accessKey="${amazon.accesskey}"
	secretKey="${amazon.secretkey}"
	region="${amazon.region}"
	sessionToken="${amazon.sessionToken}"/>
</ec2:config>
----
+
. Click *Test Connection* to confirm that Mule can connect with the Amazon EC2 instance.
. If the connection is successful, click *OK* to save the configurations.
+
Otherwise, review or correct any incorrect parameters, then test again.
. In the Properties editor, configure the remaining parameters:
+
[%header,cols="30s,70a"]
|===
|Studio Field |Value
|Display Name |Create Volume (or any other name you prefer)
2+|Basic Settings
|Extension Configuration |Amazon_EC2_Configuration (the name you created for the global element)
2+|General
|Availability Zone |`us-east-1a` (or any other availability zone to which you have access)
|Size |5 (the size of the volume, in gibibytes GiBs)
|Volume Type |Standard (the default volume type)
|===
+
image::amazon-ec2-create-volume-props.png[publish message connector props]
+
. Verify that your XML looks like this:
+
[source,xml,linenums]
----
<ec2:create-volume
	config-ref="Amazon_EC2_configuration"
	availabilityZone="us-east-1a"
	doc:name="Create volume"
	size="5"/>
----
+
. Add *Set Payload* after the Amazon EC2 Create Volume operation to send the response to the client in the browser.
. Set *Value* to `#[payload.volume.volumeId]` to print the volume ID of the EBS volume:
+
image::amazon-ec2-create-volume-payload.png[ec2 create volume payload transformer]
+
. Add a Logger component after Set Payload to display the Volume ID that is being transformed by the Set Payload transformer from the Create Volume operation in the Mule Console.
. Set the Logger *Message* to `#[payload]` and *Level* to INFO:
+
image::amazon-ec2-create-volume-logger-props.png[ec2 create volume logger]
+
. In Package Explorer, right-click the project and select *Run As* > *Mule Application*.
. Browse to `+http://localhost:8081/createVolume+`.
+
You should see the generated Volume ID in the browser and console.

[[example-code]]
=== Example Mule App XML Code

Paste this code into your XML Editor to quickly load the flow for this example use case into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ec2="http://www.mulesoft.org/schema/mule/ec2"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core
	http://www.mulesoft.org/schema/mule/core/current/mule.xsd
	http://www.mulesoft.org/schema/mule/http
	http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
	http://www.mulesoft.org/schema/mule/ec2
	http://www.mulesoft.org/schema/mule/ec2/current/mule-ec2.xsd">
	<http:listener-config
		name="HTTP_Listener_config"
		doc:name="HTTP Listener config" >
		<http:listener-connection host="localhost" port="8081" />
	</http:listener-config>
	<ec2:config
		name="Amazon_EC2_configuration"
		doc:name="Amazon EC2 Configuration" >
		<ec2:basic-connection
			accessKey="${amazon.accesskey}"
			secretKey="${amazon.secretkey}"
			region="USEAST1"
			sessionToken="${amazon.sessionToken}"/>
	</ec2:config>
	<flow name="create-ebs-volume" >
		<http:listener
			config-ref="HTTP_Listener_config"
			path="/createVolume"
			doc:name="Listener" />
		<ec2:create-volume
			config-ref="Amazon_EC2_configuration"
			availabilityZone="us-east-1a"
			doc:name="Create volume"
			size="5"/>
		<set-payload
			value="#[payload.volume.volumeId]"
			doc:name="Set Payload"  />
		<logger
			level="INFO"
			doc:name="Logger"
			message="#[payload]"/>
	</flow>
</mule>
----

////
While each example differs, all connector examples should have the following components:

An introductory paragraph that states what the example depicts. This paragraph should explicitly state why the example is helpful to the audience, and it can provide other necessary contextual information.

A screenshot of each Studio flow that the user is creating

Step-by-step instructions for creating the example in Studio

The resulting XML that users can paste into the Studio XML editor. You must remove the  attributes from the XML before including it in the topic. 

If the example contains multiple flows or is long and complex, break up the example into subsections that reflect logical chunks of functionality. For example, the Apache Kafka Connector Examples topic shows how to publish a message for Apache Kafka and then retrieve it. It has one subsection for each flow plus one for the XML:

Create the Producer Flow
Create the Consumer Flow
XML for Consuming and Publishing a Topic

The Amazon SQS Connector Examples topic also contains two flows: one for publishing an Amazon SQS topic and one for consuming the published topic. However, the first flow consists of many components. This topic breaks up the first flow into additional subsections:

Create a Flow to Send a Message
Add a Transform Message Component to Attach the Metadata
Add and Configure the SQS Send Message Operation
Add a Logger Component to Display the Response in the Mule Console
Obtain the Number of Messages in the Queue
Add a Logger to Display the Number in the Mule Console 
Create a Flow to Receive Messages
Example Mule Application XML Code

If your Examples topic contains multiple examples, create a hyperlinked list of examples in the topic introduction, as shown in the Template for Creating Multiple Examples in One Examples Topic, or use the Template for Using Multiple Examples Topics.
//// 

// Put Examples here -- You may need to obtain these from the 
// code repo /demo folder.

Template for a Single Example

// Use this template to include a single example in the Examples topic. 
// For examples of this template, see Amazon SQS Connector Examples and Apache Kafka Connector Examples.

= <connector> Example - Mule 4

<Introductory text>
The following text can be in the same paragraph as the introductory text or in a separate paragraph, depending on the introductory paragraph length.
This example uses variables for some field values. You can either:
Replace the variables with their values in the code.
Provide the values for each variable in a properties file and then refer to that file from the connector configuration.
If you don’t know how to use a properties file, see Configuring Property Placeholders.
Use subsections, if needed, to show the configuration steps.
== Subsection 1 
== Subsection 2
== Subsection 3
.
.
.

// Add these steps to the end of the numbered list:
. Save the project. 
. Test the app by sending a <REST command> request to <url>.

== XML for <what the example shows>

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here. 
// Remove the  attributes from the XML before including it in the topic.>

// If you aren’t splitting the example into subsections, add these subsections instead:

== Steps for <what the example shows>

// Add these steps to the end of the numbered list:
. Save the project. 
. Test the app by sending a <REST command> request to <url>.

== XML for <what the example shows>

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here. 
// Remove the  attributes from the XML before including it in the topic.>

Template for Including Multiple Examples in One Examples Topic

// Use this template under one of these circumstances to include multiple examples in the 
// Examples topic:

// The examples are related. 
// There are only a few examples and the documentation for each one is fairly short.

////
For an example of this template, see NetSuite Connector 10.0 Examples - Mule 4. Consider using the Template for Including Multiple Examples in One Examples Topic if you have multiple, unrelated examples.
////

= <connector> Examples - Mule 4

The following examples show how to <action> with <connector-name>: 

<Hyperlink 1>
<short description of the example>
<Hyperlink 2>
<short description of the example>
.
.
.
These examples use variables for some field values. You can either:
Replace the variables with their values in the code
Provide the values for each variable in a properties file and then refer to that file from the connector configuration.
If you don’t know how to use a properties file, see Configuring Property Placeholders.

== <Example 1>

// Use subsections, if needed, to show configuration steps. 
=== Subsection 1 
=== Subsection 2
=== Subsection 3
.
.
.
// Add these steps to the end of the numbered list:
. Save the project. 
. Test the app by sending a <REST command> request to <url>.

=== XML for <what the example shows>

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here. 
// Remove the  attributes from the XML before including it in the topic.>

// If you aren’t splitting the example into subsections, add these subsections instead:

=== Steps for <what the example shows>

// Add these steps to the end of the numbered list:
. Save the project. 
. Test the app by sending a <REST command> request to <url>.

=== XML for <what the example shows>

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here. 
// Remove the  attributes from the XML before including it in the topic.>

== <Example 2>

// Same template for Example 1

== <Example 3>
.
.
.

== See Also

* xref:connectors::introduction/anypoint-connector-authentication.adoc[Anypoint Connector Authentication]
* https://help.mulesoft.com[MuleSoft Help Center]
