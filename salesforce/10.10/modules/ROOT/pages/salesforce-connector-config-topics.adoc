= Salesforce Connector 10.10 Additional Configuration - Mule 4
:page-aliases: connectors::salesforce/salesforce-connector-config-topics.adoc

Configure Anypoint Connector for Salesforce (Salesforce Connector) to:

* Load data in batches
* Specify a Lead ID for a Lead Convert Request operation
* Update Field Values to Null
* Create an OAuth 2.0 Consumer Key
* Generate an OAuth 2.0 Keystore File

[[batchdata]]
== Load Data in Batches

The Salesforce Bulk API loads batches of your organization's data into Salesforce. Salesforce Connector provides the *Create* and *Create Bulk* operations for working with the Bulk API.

For all bulk operations, Salesforce handles the creation process in the background. The connector replies with a `BatchInfo` object, which contains the ID of the batch and the ID of the job it creates to upload the batched objects.

In Salesforce, you can track the status of bulk data load jobs and their associated batches by using the job ID for Bulk Data Load Jobs:

. Click *<YOUR_NAME > Setup > Monitoring > Bulk Data Load Jobs*.
. Click the job ID to view the job detail page.

The job detail page includes a list of all the batches related to the job. The list provides `View Request` and `View Response` links for each batch. If the batch is a CSV file, the links return the request or response in CSV format. If the batch is an XML file, the links return the request or response in XML format.

[[leadconvert]]
== Specify a Lead Convert Request ID

To specify a lead ID for a `LeadConvertRequest` operation, use a DataWeave transform message. When you use a transform message before the operation, you must add the `leadId` field, because the metadata for the operation doesn't specify it:

[source,example,linenums]
----
<ee:transform doc:name="Transform Message" >
            <ee:message >
                <ee:set-payload ><![CDATA[%dw 2.0
output application/java
---
{
    leadId: "LEAD_ID",
    accountId: "ACCOUNT_ID",
    convertedStatus: "Closed - Converted",
    doNotCreateOpportunity: true
} as Object {
    class : "org.mule.extension.salesforce.api.core.LeadConvertRequest"
}]]></ee:set-payload>
            </ee:message>
</ee:transform>
----
== Update Field Values to Null

In Salesforce Connector 10.x, to set field values to null, use an *Update* or *Upsert* request operation and set the name of the fields you want to nullify in the *Transform Message* component's *fieldsToNull* field:

.Specify the field names you want to nullify in the *Transform Message* component *fieldsToNull* field.
image::salesforce-connector-10-set-fields-to-null.png[Set a field to null]

 [[create-consumer-key]]
 == Create an OAuth 2.0 Consumer Key

A consumer key is required when setting up OAuth 2.0 configurations for Salesforce Connector. It is used by the OAuth, JWT, and SAML bearer configurations, and by the OAuth Username and Password configuration.

This procedure provides guidance for using Salesforce to create a consumer key and explains how to create a connected app in Salesforce. However, the steps might differ in your Salesforce instance.

This procedure assumes that you already have a certification file (such as `salesforce-cert.crt`). If not, you can produce one by generating a Java keystore and public key.

. Log in to Salesforce.
. From Setup, enter `Apps` in the *Quick Find* box.
. Click *App Manager*.
. Click *New Connected App*.
. To create a new connected app, enter:
+
* A name for the connected app
* The API name
* The contact email
+
. In the *API (Enable OAuth Settings)* section, select the *Enable OAuth Settings* checkbox:
+
* Enter the *Callback URL*.
* Select the *Use Digital Signatures* checkbox.
* Click *Choose File* and load your Salesforce certificate (for example, `salesforce-cert.crt`), which contains your public key.
+
In Studio, you typically store the certificate in the workspace that contains your Mule app.
+
. Add and save these OAuth scopes to *Selected OAuth Scopes*:
+
** *Full Access* (`full`)
** *Perform Requests On Your Behalf At Any Time* (`refresh_token`, `offline_access`)
+
. Configure the authorization settings for the app.
. Click *Manage*.
. In the OAuth Policies section, expand the *Permitted Users* list and select *Admin Approved Users are Pre-Authorized*.
+
. Click *Save*.
. In the Profiles section, click *Manage Profiles*.
. Select your user profile and click *Save*.
. Select *Build* > *Create* > *Apps* to return to the list of connected apps.
. In the Connected Apps section, select the connected app you created.

You can now see the consumer key that you need to provide in your connector's configuration.

== Generate a Keystore File

This example demonstrates how to create a JKS keystore (PKCS12 format is also supported).

The Key Store field is the path to the keystore used to sign data during authentication.

[NOTE]
Salesforce Connector is using the Bouncy Castle cryptographic library to load the certificate from the keystore and sign the payload for the authentication requests.
The Bouncy Castle library has a https://nvd.nist.gov/vuln/detail/CVE-2018-5382[vulnerability (CVE-2018-5382)] that is related to the BKS-V1 keystore file type.
By default, Salesforce Connector is using JKS or PKCS12 keystores. It is best not to use BKS-V1 keystore files, as documented in the https://www.kb.cert.org/vuls/id/306792[Bouncy Castle proposed solution].

To generate a keystore file:

. Go to your Mule workspace and open the command prompt (for Windows) or Terminal (for Mac).
. Type this command and press enter:
+
[source]
----
keytool -genkeypair -alias salesforce-cert -keyalg RSA -keystore salesforce-cert.jks
----
+
. Enter the following information:
+
** Password for the keystore
** Your first name and last name
** Your organization unit
** Name of your city, state, and the two-letter code for your country
+
The system generates a Java keystore file (JKS format) that contains a private or public key pair in your workspace.
+
. Provide the file path for the keystore in your connector configuration.
+
Type this command and press enter:
+
[source]
----
keytool -exportcert -alias salesforce-cert -file salesforce-cert.crt -keystore salesforce-cert.jks
----
+
The system exports the public key from the keystore into the workspace. This is the public key that you need to enter in your Salesforce instance.
+
. Verify that you have both the keystore (`salesforce-cert.jks`) and the public key (`salesforce-cert.crt`) files in your workspace.

== Generate an OAuth 2.0 Keystore File

== See Also

* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
