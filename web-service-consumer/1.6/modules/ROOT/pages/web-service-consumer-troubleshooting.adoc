= Troubleshoot Web Service Consumer Connector

To troubleshoot Anypoint Connector for Web Service Consumer (Web Service Consumer Connector), review the following sections for performing general troubleshooting, addressing specific common errors, and interpreting commonly thrown messages.

== Enable Wire Logging

When troubleshooting Web Service Consumer Connector it is helpful to look at the transport request and response on the Web Service Consumer.
If you are using the underlying HTTP transport, you can enable wire logging to see the exact HTTP message, the headers used in the transmission and the status of the response.

To enable wire logging:

. Access Anypoint Studio, navigate to the *Package Explorer* view.
. Open your application's project name.
. Open the *src/main/resources* path folder.
. Open the `log4j2.xml` file inside the folder.
. Add or uncomment the following line:
+
[source,xml,linenums]
----
<AsyncLogger name="org.mule.service.http.impl.service.HttpMessageLogger" level="DEBUG" />
----
+
. Save all your application changes.
.  Click the project name in *Package Explorer* and then click *Run* > *Run As* > *Mule Application*.
. Navigate to the *Console* view to read the HTTP messages in the Mule's logger, for example:
+

[source,plain-text]
----
POST /essentials/delta HTTP/1.1
soapaction:
Host: ilt.mulesoft-training.com
User-Agent: AHC/1.0
Connection: keep-alive
Accept: */*
Content-Type: text/xml; charset=UTF-8
Transfer-Encoding: chunked

b1
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><ns0:listAllFlights xmlns:ns0="http://soap.training.mulesoft.com/"/></soap:Body></soap:Envelope>

DEBUG 2021-04-06 15:04:23,058 [[wsc-base].wsc-dispatcher.11 SelectorRunner] [processor: ; event: ] org.mule.service.http.impl.service.HttpMessageLogger.wsc-dispatcher: REQUESTER
0


DEBUG 2021-04-06 15:04:23,319 [[wsc-base].wsc-dispatcher.11 SelectorRunner] [processor: ; event: ] org.mule.service.http.impl.service.HttpMessageLogger.wsc-dispatcher: REQUESTER
HTTP/1.1 200
Date: Tue, 06 Apr 2021 18:04:23 GMT
Content-Type: text/xml; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
MULE_ENCODING: UTF-8
Strict-Transport-Security: max-age=31536000; includeSubdomains;
X-Content-Type-Options: 1
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block

bfe
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><ns2:listAllFlightsResponse xmlns:ns2="http://soap.training.mulesoft.com/">...
----

== Troubleshoot Access Attachments

Some servers can respond with MTOM messages. These messages separate their data into parts which enables different content types of data to coexist in the same HTTP message.

MTOM is in charge of sending binary data in a separate part and referencing the part from the corresponding field within the SOAP envelope.
Web Service Consumer users interact with these messages (multipart) only with the MTOM configuration. This is not to say that MTOM, XOP, and MIME or multipart are the same.

Refer to the following documentation for further information:

* https://www.ietf.org/rfc/rfc2387.txt[RFC2387 - The MIME Multipart/Related Content-type]
* https://www.w3.org/TR/2005/REC-xop10-20050125/[XML-binary Optimized Packaging (XOP) W3C Recommendation]
* https://www.w3.org/TR/soap12-mtom/[SOAP Message Transmission Optimization Mechanism (MTOM) W3C Recommendation]


Since version 1.6.4, Web Service Consumer Connector enables you to configure MTOM for request messages, that also automatically manages MTOM responses regardless of the MTOM setting in the Web Service Consumer global configuration. Thereby, incoming messages with MTOM are treated as MTOM enabled regardless of whether MTOM is configured in the Web Service Consumer global configuration.

The following example shows the Web Service Consumer Connector global configuration with MTOM enabled:

.Web Service Consumer Connector Global Element
image::wsc-troubleshoot-3.png[Web Service Consumer global element configuration with MTOM field set to TRUE]

In the XML editor, the `<wsc:config>` and `mtomEnabled` configurations look like this:

[source,xml,linenums]
----
<wsc:config name="Web_Service_Consumer_Config" doc:name="Web Service Consumer Config">
    <wsc:connection wsdlLocation="http://ilt.mulesoft-training.com/essentials/delta?wsdl" service="TicketServiceService" port="TicketServicePort" address="http://ilt.mulesoft-training.com/essentials/delta" mtomEnabled="true">
        <wsc:web-service-security actor="http://schemas.xmlsoap.org/soap/actor/next" />
    </wsc:connection>
</wsc:config>
----

Depending on the server side multipart setting, the server may decide to send some binary data as a base64-encoded text field or as a referenced binary part in the MIME message.

To troubleshoot how to access the binary data:

* If the server sends the binary data as base64-encoded text field, you must access this field as part of the message. +
Base64 decoding is not required because the Web Service Consumer performs the decoding by itself.
* If the server sends the binary data as a referenced binary part, you must access this field as an attachment.
+
The following example shows an image that was sent as an attachment with MTOM by a Web service server. You use DataWeave to access and transform the image into JSON. In this case, Base64 encoding is required:
+
[source,DataWeave,linenums]
----
import * from dw::core::Strings
import dw::core::Binaries
output application/json
ns nam http://mynamespace.com
---
{
...
"image": Binaries::toBase64(payload.attachments[0]),
...
}
----

== Troubleshoot Design Time WSDL Issues

Some errors related to incorrect WSDL recognition, acquisition, or parsing may lead to some of the following issues:

* DataSense does not correctly expose the message metadata defined in the WSDL.
* In the Web Service Consumer Connector configuration screen, the *Operations* field does not show any Web service operation names that the connector aims to invoke:
+
.Web Service Consumer Connector Operations field
image::wsc-troubleshoot-1.png[Web Service Consumer Connector Operations field shows empty]

* In the Web Service Consumer Connector global element configuration, the *Port* and *Address* fields are not automatically filled when a WSDL location is provided.
+
.Web Service Consumer Connector Global Element
image::wsc-troubleshoot-2.png[In the Web Service Consumer Connector global element window, the port and address fields are not filled when a WSDL location is selected]

To resolve these issues:

* Check the integrity of your WSDL by using your preferred online or desktop viewer applications. +
Every parsing error during the configuration it not shown at design time, so an external application is needed.

* If you do not add the WSDL as a resource in the application's *src/main/resources* folder in Studio, check for a correct connection to the server hosting the WSDL. +
Sometimes you need to add custom HTTP settings to access an HTTP server in an HTTP security layer, such as OAuth settings or user/password settings. See xref:web-service-consumer-configure.adoc[Setting a Custom HTTP Transport Configuration.]


[[common-throws]]
== Understand Common Throws

Here is a list of common throws messages and how to interpret them.

* WSC:SOAP_FAULT

  Error matching the SOAP response with the format provided by the WSDL.

  Every CXF SOAP fault error is wrapped in a WSC:SOAP_FAULT.

* WSC:BAD_REQUST

  The Web Service Consumer Connector operation does not exist in the WSDL.

  The request body is not a valid XML.

* WSC:INVALID_WSDL

  Bad formatted WSDL.


== See Also
* https://help.mulesoft.com[MuleSoft Help Center]
* xref:Web Service Consumer-reference.adoc[Web Service Consumer Connector Reference]
