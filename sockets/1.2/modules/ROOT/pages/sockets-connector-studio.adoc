= Use Studio to Configure Sockets Connector 1.2 - Mule 4

Anypoint Studio (Studio) editors help you design and update your Mule applications, properties, and configuration files.

To add and configure a connector in Studio:

. <<create-mule-project,Create a Mule project>>.
. <<add-connector-to-project,Add the connector to your Mule project>>.
. <<configure-input-source,Configure Socket Listener source for the connector's flow>>.
. <<add-connector-operation, Configure Send and Receive Operations in the flow>>.
. <<configure-other-fields,Configure Supported TCP Protocols>>.


If you are new to configuring connectors in Studio, see xref:connectors::introduction/intro-config-use-studio.adoc[Use Studio to Configure a Connector]. If, after reading this topic, you need additional information about the connector fields, see the <link to the connector Reference Guide [<connector name> Reference].

[[create-mule-project]]
== Create a Mule Project

In Studio, create a new Mule project in which to add and configure the connector:

. In Studio, select *File > New > Mule Project*.
. Enter a name for your Mule project and click *Finish*.


[[add-connector-to-project]]
== Add the Connector to Your Mule Project

Add Sockets Connector to your Mule project to automatically populate the XML code with the connector's namespace and schema location and add the required dependencies to the project's `pom.xml` file:

. In the *Mule Palette* view, click *(X) Search in Exchange*.
. In *Add Modules to Project*, type `Sockets` in the search field.
. Click *Sockets* in *Available modules*.
. Click *Add*.
. Click *Finish*.

Adding a connector to a Mule project in Studio does not make that connector available to other projects in your Studio workspace.


[[configure-input-source]]
== Configure Socket Listener Source

An input source initiates a flow when a specified condition is met. The Socket Listener operation represents a socket endpoint that clients can connect to. By browsing to this endpoint, external clients establish a TCP/UDP Socket connection and trigger the flow each time they send a message.

. In the *Mule Palette* view, select *Socket* > *Listener*.
. Drag *Listener* to the Studio canvas.
. On the *Listener* configuration screen, optionally change the value of the *Display Name* field.
. Click the plus sign (+) next to the *Connector configuration* field to configure a global element that can be used by all instances of `Socket Listener` in the app.
. On the *General* tab, for *Connection* select `Tcp listener` or `Udp listener` connections.
. Configure the specific tabs for the connection previously selected:
+
[%header,cols=2]
|===
| Tab Name | Description
| *General* | Set *Host* and *Port* required attributes, and configure any other optional fields.
| *Buffer Configuration* | Optionally specify send and receive buffer size information.
| *TLS* | Optionally specify TLS information.
| *Timeout Configuration* | Optionally specify client and server timeout information.
| *Advanced* | Optionally specify reconnection information, including a reconnection strategy.
|===

[start=7]
. Click *Test Connection* to confirm that Mule can connect with the specific server.
. Click *OK*.

In Studio, configuring the Socket Listener with TCP connection to accept local incoming connections on port `8082`, looks as follows:

.Socket Listener Configuration
image::socket-listener-configuration.png[Socket Listener Configuration]

In the *Configuration XML* tab, the XML looks as follows:

[source,xml,linenums]
----
	<sockets:listener-config name="SocketsListenerConfig">
		<sockets:tcp-listener-connection host="localhost" port="8082" />
	</sockets:listener-config>
----


== Configure Send, and Send and Receive Operations

When you add a connector operation to your flow, you immediately define a specific operation for that connector to perform. Sockets Connector provides two basic operations:

 * Send +
 Sends the data using the client associated to the RequesterConnection.
 * Send and Receive +
 Sends the data using the client associated and then blocks until a response is received or the timeout is met, in which case the operation returns a null payload.

To configure the Send, or Send and Receive operations:

. In the *Mule Palette* view, select *Socket* > *Send*, or *Send and Receive*.
. Drag *Send* or *Send and Receive* operation to the Studio canvas.
. On the operation configuration screen, optionally change the value of the *Display Name* field.
. Click the plus sign (+) next to the *Connector configuration* field to configure a global element that can be used by all instances of `Socket Send` or `Socket Send and Receive` in the app.
. On the *General* tab, for *Connection* select `Tcp requester` or `Udp requester` connections.
. Configure the specific tabs for the connection previously selected:
+
[%header,cols=2]
|===
| Tab Name | Description
| *General* | Set *Host* and *Port* required attributes, and configure any other optional fields.
| *Buffer Configuration* | Optionally specify send and receive buffer size information.
| *Connection* | Optionally select and configure one of the supported TCP protocols.
| *Local Address Settings* | Optionally specify local address.
| *TLS* | Optionally specify TLS information.
| *Timeout Configuration* | Optionally specify client and server timeout information.
| *Advanced* | Optionally specify reconnection information, including a reconnection strategy.
|===

[start=7]
. Click *Test Connection* to confirm that Mule can connect with the specific server.
. Click *OK*.

Additionally, for the *Send and Receive* operation configure the MIME Type as follows:

. Click the *Send and Receive* operation from your flow.
. On the *MIME Type* tab, select a MIME type from the dropwdown menu field.

In Studio, configuring the Send operation with TCP connection to accept local incoming connections on port `8082`, looks as follows:

.Socket Send Operation Configuration
image::socket-send-configuration.png[Socket Send Operation Configuration]

In the *Configuration XML* tab, the XML looks as follows:

[source,xml,linenums]
----
	<sockets:listener-config name="SocketsListenerConfig">
		<sockets:tcp-listener-connection host="localhost" port="8082" />
	</sockets:listener-config>
----

In Studio, configuring the Send and Receive operation with TCP connection to accept local incoming connections on port `8082` and the MIME Type as `application/json`, looks as follows:

.Socket Send and Receive Operation Configuration
image::socket-sendreceive-configuration.png[Socket Send and Receive Operation Configuration]

.Socket MIME Type Configuration
image::socket-sendreceive-configuration.png[Socket MIME type Configuration]

In the *Configuration XML* tab, the XML looks as follows:

[source,xml,linenums]
----
	<sockets:listener-config name="SocketsListenerConfig">
		<sockets:tcp-listener-connection host="localhost" port="8082" />
	</sockets:listener-config>
----

== Configure Supported TCP Protocols

The Socket Connector supports application-level protocols implemented on top of TCP, and you need to implement these protocols in both client and server ends so they can work properly. +
By default, the Socket Connector implements the Safe Protocol; however, you can configure a different protocol for the connector operations both in Anypoint Studio and XML.

Supported TCP protocols:

* Direct Protocol +
  The socket reads until no more bytes are immediately available. On slow networks, `EOFProtocol` and `LengthProtocol` might be more reliable.
* EOF Protocol +
  Reading is terminated by the stream being closed by the client.
* Length Protocol +
  This protocol is defined by sending or reading an integer (the packet length) and then the data to transfer.
* Custom Class Loading Length Protocol +
  A length protocol that uses a specific class loader to load objects from streams.
* Safe Protocol +
  A test protocol that precedes every message with a cookie, and should not be used in production environments.
* Streaming Protocol +
  Allows the socket's Send operation to return a message with the original `InputStream` as payload.
* XML Message Protocol +
  Use this protocol to read streaming XML documents. The only requirement is that each document includes an XML declaration at the beginning of the document in the form  of `<?xml....`. +
  Data is read until a new document is found or until there is no more currently available data. For slower networks, `XmlMessageEofProtocol` might be more reliable. +
  Also, because the default character encoding for the platform is used to decode the message bytes when looking for the XML declaration, some caution with message character encodings is warranted.
* XML Message EOF Protocol +
  Extends `XmlMessageProtocol` to continue reading until either a new message or EOF is found.
* Custom Protocol +
  Define your own custom protocol by writing a class that extends `TcpProtocol`.

=== Configure TCP Protocols for Socket Listener

To configure supported TCP protocols for the Socket Listener:

. Open the *Global Element Properties* configuration of the Socket Listener.
. On the *General* tab, for *Connection* select `Tcp listener`.
. On the *General* section of the *General* tab, for *Protocol* select one of the supported protocols.
. Set the required fields for the connector.
. Click *Test Connection* to confirm that Mule can connect with the specific server.
. Click *OK*.

In Studio, configuring the Socket Listener to use Direct Protocol, looks as follows:

.Socket Direct Protocol Configuration
image::socket-tcp1-configuration.png[Socket Direct Protocol Configuration]

In the *Configuration XML* tab, the XML looks as follows:

[source,xml,linenums]
----
	<sockets:listener-config name="Sockets_Listener_config" doc:name="Sockets Listener config" >
		<sockets:tcp-listener-connection host="localhost" port="8082" >
			<sockets:protocol>
				<sockets:direct-protocol />
			</sockets:protocol>
		</sockets:tcp-listener-connection>
	</sockets:listener-config>
----

=== Configure TCP Protocols for Send and Receive Operations

To configure supported TCP protocols for the Socket Send, and Send and Receive operations:

. Open the *Global Element Properties* configuration of your Socket operation.
. On the *General* tab, for *Connection* select `Tcp requester`.
. On the *Connection* tab, for *Protocol* select one of the supported protocols.
. Set the required fields for the connector.
. Click *Test Connection* to confirm that Mule can connect with the specific server.
. Click *OK*.

In Studio, configuring the Socket Send operation to use Direct Protocol, looks as follows:

.Socket Direct Protocol Configuration
image::socket-tcp2-configuration.png[Socket Direct Protocol Configuration]

In the *Configuration XML* tab, the XML looks as follows:

[source,xml,linenums]
----
<sockets:request-config name="Sockets_Request_config" doc:name="Sockets Request config" >
	<sockets:tcp-requester-connection >
		<sockets:protocol >
			<sockets:direct-protocol />
		</sockets:protocol>
	</sockets:tcp-requester-connection>
</sockets:request-config>
----
