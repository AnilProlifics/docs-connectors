= Receiving Messages with the AS2 Listener - Mule 4
:page-aliases: connectors::as2/as2-connector-receiving-messages.adoc

The following example illustrates how to configure the Anypoint  *As 2 listener* source to start receiving messages from your trading partners. In this example, the *As 2 listener* source listens on a specific port for every network interface on the server. When the source detects a new message, the app logs a message that contains the message playload.

The following screenshot shows the Anypoint Studio app flow for this example:

image::as2-listener-flow.png[AS2 Listener Flow]

== Configure the Listener

Configure the *AS 2 Listener* source to initiate a Mule flow when a call is made to the `/as2-receive path` on local host port `8081`:

. In Anypoint Studio, create a new Mule project.
. In the *Mule Palette* view, select the *As 2 listener* source and drag it to the canvas. 
. On the *As 2 listener* properties screen, optionally change the value of the *Display Name* field.
. Set the *Path* field to `/as2-receive`.
. Click the plus sign (*+*) next to the *Connector configuration* field to configure a global element that can be used by all instances of *As 2 listener* in the app.
. On the *General* tab, click the plus sign (*+*) next to the *HTTP Listener field*.
. Accept the defaults and click *OK*.
. On the *General* tab, configure the keystore that contains the certificates and keys:
+
[%header%autowidth.spread]
|===
|Field |Value
|Host | Leave the default, `All Interfaces [0.0.0.0] (default)` 
|Port | `8081`
|Keystore Password |`test`
|Keystore Path| `as2/partnera.p12`
|Private Key Password | `test`
|===
+
For example:
+
image::as2-listener-config-general.png[AS2 Listener global element General tab]
+
. On the *Partners* tab, specify the self and partner credentials. 
+
For the self credentials, configure these fields:
+
[%header%autowidth.spread]
|===
|Field |Value
|AS2 Partner Name | partnera  
|x509 Alias | parnera
|email | support@partnera.com
|===
+
. For the partner credentials, configure these fields:
+
[%header%autowidth.spread]
|===
|Field |Value
|AS2 Partner Name | partnerb  
|x509 Alias | parnerb
|email | support@partnerb.com
|===
+
image::as2-listener-config-partners.png[AS2 Listener global elem]

== Add the Logger Component

Add the *Logger* component to the flow and configure it to log a message that includes the payload of the received message:

. From the *Mule Palette* view, select *Core* and drag the *Logger* component to the right of *As 2 listener*.
. In the Logger configuration screen, set the Message field to `Message Received: #[payload]`.
+
image::as2-listener-logger-component.png[Logger Component]
[start=13]

== Save and Run the Mule App

. Save the Mule app.
. Click the project name in *Package Explorer* and then click *Run* > *Run As* > *Mule Application*.
+
If the application starts correctly, the console displays this message:
+
`Mule is up and kicking`
. Test the app with using the following command on a xxx like Postman:
+
`curl commands/postman/AS2` Sender.

For each new request, you will see the received message, in the Studio console. For example:

[source,console,linenums]
----
INFO  2022-09-09 17:15:46,409 [[MuleRuntime].uber.06: [as2-basic-example].AS2Listener.CPU_LITE @1369de96] [processor:
AS2Listener/processors/0; event: 30609f70-307c-11ed-8f5a-38f9d3713331] org.mule.runtime.core.internal.processor.
LoggerMessageProcessor: Message Received: Test Message
----

== XML for Receiving Messages with AS2 Listener

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:as2-mule4="http://www.mulesoft.org/schema/mule/as2-mule4" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/as2-mule4 http://www.mulesoft.org/schema/mule/as2-mule4/current/mule-as2-mule4.xsd">
	<http:listener-config name="HTTP_Server_Config" doc:name="HTTP Listener config">
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<as2-mule4:listener-config name="AS2_Server_Listener" doc:name="AS2 Connector Listener config" httpListenerConfig="HTTP_Server_Config" securityLevel="SIGNED_ENCRYPTED">
		<as2-mule4:self-config as2Name="partnera" x509Alias="partnera" email="support@partnera.com"/>
		<as2-mule4:partner-config as2Name="partnerb" x509Alias="partnerb" email="support@partnerb.com"/>
		<as2-mule4:key-store-config keystorePassword="test" keystorePath="as2/partnera.p12" privateKeyPassword="test" />
	</as2-mule4:listener-config>
	<flow name="AS2Listener" >
		<as2-mule4:as2-listener doc:name="As 2 listener" config-ref="AS2_Server_Listener" path="/as2-receive"/>
		<logger level="INFO" doc:name="Message Received!" message="Message Received: #[payload]"/>
	</flow>
</mule>

----

== See Also

* xref:as2-connector-examples.adoc[AS2 Connector Examples]
* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]

Example Files:

// Insert Link for example keystore
* https://insertlink.com[partnera.p12]