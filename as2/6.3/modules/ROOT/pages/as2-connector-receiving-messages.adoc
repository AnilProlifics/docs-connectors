= Receiving Messages with AS2 Listener - Mule 4
:page-aliases: connectors::as2/as2-connector-receiving-messages.adoc

The following example illustrates how to configure the *As 2 listener* (AS2 Connector) source to start receiving messages from your trading partners. In this example, the *As 2 listener* source listens on a specific port for every network interface on the server. Then, the Logger component logs the message `Message Received`. To accomplish this example, you must create the Mule app, configure an AS2 Listener global element, run, and test the app with curl commands/postman/AS2 Sender.

The following screenshot shows the Anypoint Studio app flow for this example:

image::as2-listener-flow.png[AS2 Listener Flow]

== Create the Mule Application

To create the Mule flow:

. In the *Mule Palette* view, select the *As 2 listener* source and drag it on to the canvas. +
The source initiates the flow by listening for incoming HTTP message attributes.
. On the *As 2 listener* configuration screen, optionally change the value of the *Display Name* field.
. Set the *Path* field to `/as2-receive` to receive the messages in this endpoint.
. Click the plus sign (*+*) next to the *Connector configuration* field to configure a global element that can be used by all instances of the *As 2 listener* in the app.
. On the *General* tab, you should first configure the HTTP Listener global element with the fields:

* *Host* +
`All Interfaces [0.0.0.0] (default)`
* *Port* +
`8081`
[start=6]
. Click *OK*.

image::as2-http-config.png[AS2 Listener HTTP global config]
[start=7]
. On the same *General* tab, you should specify the keystore that has the certificates and keys, which will be included in this example.

* *Keystore Password* +
`test`
* *Keystore Path* +
`as2/partnera.p12`
* *Private Key Password* +
`test`
[start=7]

image::as2-listener-config-general.png[AS2 Listener global element General tab]

[start=8]
. On the *Partners* tab, you should specify the self and partner credentials. +
In this example we will leave the Listener Mode by default (Dedicated mode)
. For the *Self config* you will configure the following fields:
* *AS2 Partner Name* +
`partnera`
* *x509 Alias* +
`partnera`
* *email* +
`support@partnera.com`
. For the *Partner config* you will configure the following fields:
* *AS2 Partner Name* +
`partnerb`
* *x509 Alias* +
`partnerb`
* *email* +
`support@partnerb.com`

image::as2-listener-config-partners.png[AS2 Listener global element Partners tab]
image::as2-listener-component.png[AS2 Listener Component]
[start=11]
. Drag a Logger component to the right of *As 2 listener*.
. In the Logger configuration screen, set the Message field to `Message Received: #[payload]`.

image::as2-listener-logger-component.png[Logger Component]
[start=13]
. Save your Mule app.
. Click the project name in *Package Explorer* and then click *Run* > *Run As* > *Mule Application*.
. Ensure that the console messages state that the application started correctly by looking at the message `Mule is up and kicking`.
. You can now receive AS2 requests, for that you can try the xref:as2-connector-sending-messages.adoc[Sending an AS2 Request Example]
. In the Studio Console, for each new request, you will see the received message, for example:

[source,console,linenums]
----
INFO  2022-09-09 17:15:46,409 [[MuleRuntime].uber.06: [as2-basic-example].AS2Listener.CPU_LITE @1369de96] [processor:
AS2Listener/processors/0; event: 30609f70-307c-11ed-8f5a-38f9d3713331] org.mule.runtime.core.internal.processor.
LoggerMessageProcessor: Message Received: Test Message
----

== XML for Receiving Messages with AS2 Listener

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:as2-mule4="http://www.mulesoft.org/schema/mule/as2-mule4" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/as2-mule4 http://www.mulesoft.org/schema/mule/as2-mule4/current/mule-as2-mule4.xsd">
	<http:listener-config name="HTTP_Server_Config" doc:name="HTTP Listener config">
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<as2-mule4:listener-config name="AS2_Server_Listener" doc:name="AS2 Connector Listener config" httpListenerConfig="HTTP_Server_Config" securityLevel="SIGNED_ENCRYPTED">
		<as2-mule4:self-config as2Name="partnera" x509Alias="partnera" email="support@partnera.com"/>
		<as2-mule4:partner-config as2Name="partnerb" x509Alias="partnerb" email="support@partnerb.com"/>
		<as2-mule4:key-store-config keystorePassword="test" keystorePath="as2/partnera.p12" privateKeyPassword="test" />
	</as2-mule4:listener-config>
	<flow name="AS2Listener" >
		<as2-mule4:as2-listener doc:name="As 2 listener" config-ref="AS2_Server_Listener" path="/as2-receive"/>
		<logger level="INFO" doc:name="Message Received!" message="Message Received: #[payload]"/>
	</flow>
</mule>

----

== See Also

* xref:as2-connector-examples.adoc[AS2 Connector Examples]
* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]

Example Files:

// Insert Link for example keystore
* https://insertlink.com[partnera.p12]