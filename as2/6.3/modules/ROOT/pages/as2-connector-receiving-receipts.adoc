= Receiving Receipts with AS2 MDN Listener - Mule 4
:page-aliases: connectors::as2/as2-connector-receiving-receipts.adoc

The *As 2 mdn listener* works similar to the *As 2 listener* so the instructions will be similar the xref::as2-connector-receiving-messages.adoc[AS2 Listener example]. This listener receives the receipts (MDNs) instead of messages.

The following screenshot shows the Anypoint Studio app flow for this example:

image::as2-mdn-listener-flow.png[AS2 MDN Listener Flow]

== Create the Mule Application

To create the Mule flow:

. In the *Mule Palette* view, select the *As mdn 2 listener* source and drag it on to the canvas. +
. On the *As 2 mdn listener* configuration screen, optionally change the value of the *Display Name* field.
. Set the *Path* field to `/receiveMDN` to receive the receipts in this endpoint.
. Click the plus sign (*+*) next to the *Connector configuration* field to configure a global element that can be used by all instances of the *As 2 mdn listener* in the app.
. On the *General* tab, you should first configure the HTTP Listener global element with the fields:

* *Host* +
`All Interfaces [0.0.0.0] (default)`
* *Port* +
`8082`
[start=6]
. Click *OK*.

image::as2-http-client-config.png[AS2 MDN Listener HTTP global config]

[start=7]
. On the same *General* tab, you should specify the keystore that has the certificates and keys, which will be included in this example.

* *Keystore Password* +
`test`
* *Keystore Path* +
`as2/partnerb.p12`
* *Private Key Password* +
`test`
[start=7]

image::as2-mdn-listener-config-general.png[AS2 MDN Listener global element General tab]

[start=8]
. On the *Partners* tab, you should specify the self and partner credentials. +
In this example we will leave the MDN Listener Mode by default (Mdn dedicated mode)
. For the *Self config* you will configure the following fields:
* *AS2 Partner Name* +
`partnerb`
* *x509 Alias* +
`partnerb`
* *email* +
`support@partnerb.com`
. For the *Partner config* you will configure the following fields:
* *AS2 Partner Name* +
`partnera`
* *x509 Alias* +
`partnera`
* *email* +
`support@partnera.com`

image::as2-mdn-listener-config-partners.png[AS2 MDN Listener global element Partners tab]
image::as2-mdn-listener-component.png[AS2 MDN Listener Component]
[start=11]
. Drag a Logger component to the right of *As 2 mdn listener*.
. In the Logger configuration screen, set the Message field to `MDN Received: #[payload]`.

image::as2-mdn-listener-logger-component.png[Logger Component]
[start=13]
. Save your Mule app.
. Click the project name in *Package Explorer* and then click *Run* > *Run As* > *Mule Application*.
. Ensure that the console messages state that the application started correctly by looking at the message `Mule is up and kicking`.
. You can now receive AS2 receipts, for that you can try the xref:as2-connector-sending-messages.adoc#_send_with_async_mdn[Sending an Async AS2 Request Example]
. In the Studio Console, for each new request, you will see the received message, for example:

[source,console,linenums]
----
INFO  2022-09-09 17:15:46,409 [[MuleRuntime].uber.06: [as2-basic-example].ReceiveAsyncMDN.CPU_LITE @1369de96] [processor:
ReceiveAsyncMDN/processors/0; event: 30609f70-307c-11ed-8f5a-38f9d3713331] org.mule.runtime.core.internal.processor.
LoggerMessageProcessor: MDN Received!
----

[NOTE]
In the case you are not using the *Send with Async MDN* with the *Receipt delivery url* field configured, and you are using an HTTP request, the header `Receipt-Delivery-Option` must be included with the *As 2 mdn listener* endpoint (`http://localhost:8082/receiveMDN`)

== XML for Receiving Receipts with AS2 MDN Listener

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:as2-mule4="http://www.mulesoft.org/schema/mule/as2-mule4"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/as2-mule4 http://www.mulesoft.org/schema/mule/as2-mule4/current/mule-as2-mule4.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	<http:listener-config name="HTTP_Client_Config" doc:name="HTTP Listener config" >
		<http:listener-connection host="0.0.0.0" port="8082" />
	</http:listener-config>
	<as2-mule4:mdn-listener-config name="AS2_Client_MDN_Listener" doc:name="AS2 Connector Mdn listener config" httpListenerConfig="HTTP_Client_Config" >
		<as2-mule4:self-config as2Name="partnerb" x509Alias="partnerb" email="support@partnerb.com"/>
		<as2-mule4:partner-config as2Name="partnera" x509Alias="partnera" email="support@partnera.com" />
		<as2-mule4:key-store-config keystorePassword="test" keystorePath="as2/partnerb.p12" privateKeyPassword="test" />
	</as2-mule4:mdn-listener-config>
	<flow name="ReceiveAsyncMDN" >
		<as2-mule4:as2-mdn-listener doc:name="As 2 mdn listener" config-ref="AS2_Client_MDN_Listener" path="/receiveMDN"/>
		<logger level="INFO" doc:name="MDN Received!" message="MDN Received! #[payload]"/>
	</flow>
</mule>


----

== See Also

* xref:as2-connector-examples.adoc[AS2 Connector Examples]
* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]

Example Files:

// Insert Link for example keystore
* https://insertlink.com[partnerb.p12]