= Receiving AS2 MDNs - Mule 4
:page-aliases: connectors::as2/as2-connector-receiving-receipts.adoc

The following example shows how to use Anypoint Connector for AS2 (AS2 Connector) to receive AS2 MDN (Message Disposition Notification) messages from a trading partner and, for every received MDN, log a message
that contains the message payload to the Studio console.

This example is similar to the xref:as2-connector-example-receive-send.adoc#receiving-messages[Receiving AS2 Messages] example, except that in this example:

* You use the *AS2 mdn listener* source instead of the *As 2 listener* source and set the path to `/receiveMDN`.
* On the *Logger* properties window, you set the *Message* field to `MDN Received: #[payload]`.  

The following screenshot shows the Anypoint Studio app flow for this example:

image::as2-connector-example-mdn-listener-flow.png[Receive MDN Messages Example App Flow]

To test this example:

. Run this app.
. Run the app configured in the xref:as2-connector-example-receive-send.adoc#asynchronous-mdns[Sending Asynchronous AS2 MDNs] example.
+
In the Studio console in this app, you should see a message for each received AS2 MDN. that was sent asynchronously. For example:
+
[source,console,linenums]
----
INFO  2022-09-09 17:15:46,409 [[MuleRuntime].uber.06: [as2-basic-example].ReceiveAsyncMDN.CPU_LITE @1369de96] [processor:
ReceiveAsyncMDN/processors/0; event: 30609f70-307c-11ed-8f5a-38f9d3713331] org.mule.runtime.core.internal.processor.
LoggerMessageProcessor: MDN Received!
----
. Run the app configured in the xref:as2-connector-example-receive-send.adoc#synchronous-mdns[Sending Synchronous AS2 MDNs] example.
+
In the Studio Console for this app, you should see a message for each received MDN that was sent synchronously. For example:
+
[source,console,linenums]
----
INFO  2022-09-09 17:15:46,409 [[MuleRuntime].uber.06: [as2-basic-example].ReceiveAsyncMDN.CPU_LITE @1369de96] [processor:
ReceiveAsyncMDN/processors/0; event: 30609f70-307c-11ed-8f5a-38f9d3713331] org.mule.runtime.core.internal.processor.
LoggerMessageProcessor: MDN Received!
----

NOTE: If the *Receipt delivery url* field is not configured for the *Send with Async MDN* source and you are using an HTTP request, the header `Receipt-Delivery-Option` must be included with the *As 2 mdn listener* endpoint (`+http://localhost:8082/receiveMDN+`).

== XML for the Receiving AS2 MDNs Example

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:as2-mule4="http://www.mulesoft.org/schema/mule/as2-mule4" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/as2-mule4 http://www.mulesoft.org/schema/mule/as2-mule4/current/mule-as2-mule4.xsd">
	<http:listener-config name="HTTP_Server_Config" doc:name="HTTP Listener config" doc:id="86258f1d-930a-4495-9e46-3d0a16a3c898" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<as2-mule4:listener-config name="AS2_Server_Listener" doc:name="AS2 Connector Listener config" doc:id="7228c8f3-0fe4-4f4d-b57e-79c40f60c582" httpListenerConfig="HTTP_Server_Config" securityLevel="SIGNED_ENCRYPTED">
		<as2-mule4:self-config as2Name="partnera" x509Alias="partnera" email="support@partnera.com"/>
		<as2-mule4:listener-mode >
			<as2-mule4:shared-mode>
				<as2-mule4:partner-configs >
					<as2-mule4:partner-detail-extended as2Name="partnerb" x509Alias="partnerb" email="support@partnerb.com" />
					<as2-mule4:partner-detail-extended as2Name="partnerc" x509Alias="partnerc" email="support@partnerc.com" />
				</as2-mule4:partner-configs>
			</as2-mule4:shared-mode>
		</as2-mule4:listener-mode>
		<as2-mule4:key-store-config keystorePassword="test" keystorePath="as2/partnera.p12" privateKeyPassword="test" />
	</as2-mule4:listener-config>
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="904f07cb-feba-48e4-b901-7699dc83da90" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<as2-mule4:mdn-listener-config name="AS2_Connector_Mdn_listener_config" doc:name="AS2 Connector Mdn listener config" doc:id="e736668c-f8c0-41c4-8ef9-2866aca4ba05" httpListenerConfig="HTTP_Listener_config" >
		<as2-mule4:self-config as2Name="partnera" x509Alias="partnera" email="support@partnera.com" />
		<as2-mule4:partner-config as2Name="partnerb" x509Alias="partnerb" email="support@partnerb.com" />
		<as2-mule4:key-store-config keystorePassword="test" keystorePath="as2/partnera.p12" privateKeyPassword="test" />
	</as2-mule4:mdn-listener-config>
	<flow name="AS2Listener" doc:id="df016a98-22fc-4405-9797-187b3c47a179" >
		<as2-mule4:as2-mdn-listener doc:name="As 2 mdn listener" doc:id="2da9cef0-6ce2-42fd-af5c-eeb3cfb901f3" path="/receiveMDN" config-ref="AS2_Connector_Mdn_listener_config"/>
		<logger level="INFO" doc:name="Message Received!" doc:id="a09b37d1-678b-4e48-96f1-7dd2943db283" message="MDN Received: #[payload]"/>
	</flow>
</mule>
----

== See Also

* xref:as2-connector-examples.adoc[AS2 Connector Examples]
* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]