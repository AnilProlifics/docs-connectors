= Consume Messages with the JMS Connector Examples
:keywords: jms, connector, consume, message
:page-aliases: connectors::jms/jms-consume.adoc

Anypoint Connector for JMS (JMS Connector) *Consume* operation enables you to consume a message at any time in the flow, from any given specified destination.

== Consume a Message from a Queue

In the following example, you configure the *Consume* operation to consume new messages in the queue specified in the *Destination* field. The operation returns a Mule message each time a JMS message is available in the queue. The Mule message consists of:

* The message content as payload
* The message metadata in the message attributes

By default, the message consumed is acknowledged ("ACKed") only when the execution of the flow receiving the message completes successfully. If you want to control the ACK of the message after some processing, then you need to set the `ackMode` to `MANUAL`.
For more information regarding a Message ACK, review the xref:jms-ack.adoc[Manage Message Acknowledgement] documentation.

To configure the source in Studio, follow these steps:

. In the *Mule Palette* view, select *JMS > Consume*.
. Drag *Consume* to the Studio canvas.
. In the *Consume* configuration screen, optionally change the value of the *Display Name* field.
. In the *Consume* configuration screen, in *Destination*, specify the name of the destination from which to consume the message, for example, `#[vars.destination]`.

.JMS Connector Consume configuration
image::jms-consume-queue.png[In the Consume operation screen, set the Destination field to the name of the destination from where to consume the message]

In the XML editor, the `<jms:consume>` configuration looks like this:

[source,xml,linenums]
----
<jms:consume config-ref="JMS_config" destination="#[vars.destination]"/>
----


== Wait for a Message

By default, the maximum wait time is configured in 10 seconds, producing a `JMS:TIMEOUT` error if no message is available in that period.
If order to configure a timeout that fits better your use case, customize the `maximumWait` and `maximumWaitUnit` parameters.

In order to wait indefinitely for a Message to arrive, the `maximumWait` value has to be set to `-1`. In this case, no `TIMEOUT` error will be thrown.

== Polling for a Message

When polling for a Message with a certain frequency, you don't want the consumer to block waiting for the Message, but instead just try to consume it if one is present.
In this cases, the `maximumWait` can be set to `0`, indicating that no waiting should occur, and neither a `JMS:TIMEOUT` should be thrown if no Message is available in the destination.
The output of the `consume` operation will be `null` when no Message is present for consumption and no error is thrown.

== Filtering Incoming messages

The JMS connector provides full support for filtering which Messages should be consumed based on the standard *JMS selector language*.

For example, if you have a priority Queue with Messages that need to be processed faster than the others, we can do:

[source,xml,linenums]
----
<jms:consume config-ref="JMS_config" destination="openTickets" selector="JMSPriority=8"/>
----

When a selector is configured, only the Messages matching it will be received, ignoring if any other Message is in the destination.

== Configure Mime Types and Encoding

JMS Connector determines a messageâ€™s mime type (`contentType`) based on the `MM_MESSAGE_CONTENT_TYPE` property. However, when you must manage the message's content, configure the *Content-Type* field to the particular content type value you need. +

By default, JMS Connector assumes that Mule runtime engine default encoding matches the encoding in the message if no other information is provided. Use the *Encoding* field to configure a different type of encoding.

== Consuming A Message Using Topic Subscriptions

Consuming messages from a Topic destination is very similar to consuming them from a Queue, but with the extra functionality of being able to use Topic subscriptions to share state between consumers.
The syntax for consuming messages from a Topic is:

[source,xml,linenums]
----
<jms:consume config-ref="JMS_config" destination="#[vars.destination]">
    <jms:consumer-type>
        <jms:topic-consumer/>
    </jms:consumer-type>
</jms:consume>
----

All the `consume` operation parameters remain the same, but now you can handle the subscription configuration in the `topic-consumer` parameter.

For details on how to configure the Topic subscriptions go to xref:jms-topic-subscription.adoc[Using Topic Subscriptions].


== Incoming Message Metadata

As stated before, each Message received will consist of two parts:

* The payload, containing the content of the Message
* The attributes, containing metadata regarding the Message

This Metadata has three parts that map all the information available in a JMS Message:

* AckId
* Headers
* Properties

Check the xref:1.6@jms-xml-ref.adoc[JMS Reference] for details about the Attributes structure.

== See Also

* xref:jms-topic-subscription.adoc[Using Topic Subscriptions]
* xref:jms-listener.adoc[To Listen For New Messages]
