= Configure Topic Subscriptions with JMS Connector
:keywords: jms, connector, consume, source, listener, topic, subscription
:page-aliases: connectors::jms/jms-topic-subscription.adoc

Topics in JMS enables you to configure how the subscription behaves regarding the connection of the consumer and also how these consumers interact with each other.

The Anypoint Connector for JMS (JMS Connector) *Consumer* and *On New Message* operations can manage the aspects of a topic subscription in the *Consumer type* field by selecting the *Topic consumer* configuration.

== Configure Durable Subscriptions

Durable subscriptions enables you to receive published messages to the topic while the consumer is offline.
Once you configure a durable subscription, an available consumer receives all the published messages before the established connection. +
Then the JMS provider stores the messages sent or published to the topic, as it would store messages sent to a queue. If another application has a topic consumer configuration that uses the same connection and its client ID, the same topic, and the same subscription name, the subscription reactivates, and the JMS provider delivers the published messages while the subscriber was inactive.

In the following example, you configure the *Durable* field for the *Topic consumer* configuration:

. In Studio, select the *Consume* operation from your flow.
. Set the *Destination* field to `#[vars.destination]`.
. Set the *Consumer type* field to *Topic consumer*:
. Select the *Durable* option.
. Set the *Subscription name* to `SampleSub`.

.JMS Connector Topic Consumer Durable configuration
image::jms-topic-durable.png[In the Consume operation screen, set the Destination field to the name of the destination from where to consume the message]

In the XML editor, the `<jms:topic-consumer>` and `shared` configurations look like this:

[source,xml,linenums]
----
<jms:consume config-ref="JMS_config" destination="#[vars.destination]">
    <jms:consumer-type>
        <jms:topic-consumer durable="true" subscriptionName="SampleSub"/>
    </jms:consumer-type>
</jms:consume>
----



== Configure Shared Subscriptions

In JMS spec 1.1 connection, a subscription on a topic can not have more than one consumer at a time, meaning that processing work of messages on a topic subscription can not be shared, thereby limiting the scalability of the application.
JMS spec 2.0 connection removes this restriction and enables you to configure shared consumers on the same subscription.

In the following example, you configure the *Shared* field for the *Topic consumer* configuration. With this configuration on two different *On New Messages* source instances, when a message is published to the invoices destination it is delivered only to one of the sources and not the other:

. In Studio, select the *Consume* operation from your flow.
. Set the *Destination* field to `InvoiceEventsTopic`.
. Set the *Consumer type* field to *Topic consumer*:
. Select the *Shared* option.
. Set the *Subscription name* to `ClusterSubscription`.

.JMS Connector Topic Consumer Shared configuration
image::jms-topic-shared.png[In the Consume operation screen, set the Destination field to the name of the destination from where to consume the message]

In the XML editor, the `<jms:topic-consumer>` and `shared` configurations look like this:

[source,xml,linenums]
----
<jms:listener config-ref="config" destination="InvoiceEventsTopic">
    <jms:consumer-type>
        <jms:topic-consumer shared="true" subscriptionName="ClusterSubscription"/>
    </jms:consumer-type>
</jms:listener>
----


== Configure No Local Subscriptions

There are cases in which you may not want to receive the published messages to a topic by the same application. To prevent the consumer to receive published messages to the topic by the same connection, configure the *Topic consumer* field to *No local*. Consumers configured as no local can not be part of a shared subscription.

In the following example, you configure the *No local* field for the *Topic consumer* configuration:

. In Studio, select the *Consume* operation from your flow.
. Set the *Destination* field to `{notificationsChannel}`.
. Set the *Consumer type* field to *Topic consumer*:
. Select the *Shared* option.
. Set the *Subscription name* to `ClusterSubscription`.

.JMS Connector Topic Consumer No local configuration
image::jms-topic-nolocal.png[In the Consume operation screen, set the Destination field to the name of the destination from where to consume the message]

In the XML editor, the `<jms:topic-consumer>` and `noLocal` configurations look like this:

[source,xml,linenums]
----
<jms:listener config-ref="config" destination="${notificationsChannel}">
    <jms:consumer-type>
        <jms:topic-consumer noLocal="true"/>
    </jms:consumer-type>
</jms:listener>
----

== See Also

* xref:jms-listener.adoc[Listen For New Messages]
* xref:jms-consume.adoc[Consume Messages]
