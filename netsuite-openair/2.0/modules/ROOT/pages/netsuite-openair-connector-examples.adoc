= NetSuite OpenAir 2.0 Examples - Mule 4

This example shows how to add, modify, read, and delete two customers by using the same request. This example contains five flows:

. The first flow configures a template for the input.
. The second flow adds two customers from the input.
. The third flow modifies the customer information of the two customers.
. The fourth flow retrieves the modified customer information of the two customers.
. The fifth flow deletes the two customers. 

The following screenshot shows the flows in Anypoint Studio:

image::netsuite-openair-examples.png[The five flows in Anypoint Studio]

== Create the First Flow

The first flow configures an HTML template for the input to later use when adding, modifying, reading, and deleting the two customers. Configuring this flow involves creating a new Mule project, configuring the HTTP *Listener* source, and adding the *Parse Template* component.

=== Configure the HTTP Listener Source

Configure the HTTP *Listener* source to initiate a Mule flow when a call is made to the default path (`/`):

. Create a new Mule project in Studio.
. From the *Mule Palette* view, select *HTTP* and drag the *Listener* source to the canvas.
. In the properties window, click *+* next to the *Connector configuration* field to add a global element.
. In the *Display Name* field, enter `Listener` and accept the default values.

=== Add the Parse Template Component

Add the *Parse Template* component to create a template for an HTML form (`form.html`), which is located in the main resources folder. The example uses this form to later add, modify, read, and delete the two customers:

. From the *Mule Palette* view, select *Core* and drag the *Parse Template* component next to the *Listener* source.
. In the *Location* field, enter `form.html`.

== Create the Second Flow

The second flow adds the two customers from the customer name and company input values. Configuring this flow involves configuring the HTTP *Listener* source, adding the *Logger* component, adding the *Transform Message* component, adding the *Add* operation, adding another *Transform Message* component, and adding another *Logger* component.

=== Configure the HTTP Listener Source 

Configure the HTTP *Listener* source to initiate a Mule flow when a call is made to the `/add` path:

. From the *Mule Palette* view, select *HTTP* and drag the *Listener* source to the canvas.
. In the properties window, click *+* next to the *Connector configuration* field to add a global element.
. In the *Display Name* field, enter `Listener`.
. In the *Path* field, enter `/add`.

=== Add the Logger Component 

Add the *Logger* component to log the payload:

. From the *Mule Palette* view, select *Core* and drag the *Logger* component next to the *Listener* source.
. In the *Message* field, enter `payload`.

=== Add the Transform Message Component

Add the *Transform Message* component to transform the customer name and company input values of the two customers to XML: 

. From the *Mule Palette* view, select *Core* and drag the *Transform Message* component next to the *Logger* component.
. In the properties window, overlay the brackets in the *Output* section with this DataWeave code:
+
[source,dataweave,linenums]
----
%dw 2.0
output application/xml
ns ns0 http://namespaces.soaplite.com/perl
---
{
	ArrayOfoaBase: {
		oaBase: {
			ns0#oaCustomer: {
				name: payload.customerName_1,
         		company: payload.customerCompany_1
			},
			ns0#oaCustomer: {
				name: payload.customerName_2,
				company: payload.customerCompany_2
			}
		}
	}
}
----

=== Add the Add Operation

Add the *Add* operation to add the two customers: 

. From the *Mule Palette* view, select *NetSuite OpenAir* and drag the *Add* operation next to the *Transform Message* component.
. In the properties window, complete the following fields:
+
[%header%autowidth.spread]
|===
|Field|Value
|*oaObject* |`oaCustomer`
|*Request* |`payload`
|===

=== Add Another Transform Message Component 

Add another *Transform Message* component to transform the customer name and company input values of the two customers to JSON: 

. From the *Mule Palette* view, select *Core* and drag the *Transform Message* component next to the *Add* operation.
. In the properties window, overlay the brackets in the *Output* section with this DataWeave code:
+
[source,dataweave,linenums]
----
%dw 2.0
output application/json
ns ns0 http://namespaces.soaplite.com/perl
---
{
	customerID_1: payload.ns0#ArrayOfUpdateResult.*updateResult[0].id,
	customerID_2: payload.ns0#ArrayOfUpdateResult.*updateResult[1].id
}
----

=== Add Another Logger Component 

Add another *Logger* component to log the payload:

. From the *Mule Palette* view, select *Core* and drag the *Logger* component next to the *Transform Message* component.
. In the *Message* field, enter `payload`.

== Create the Third Flow 

The third flow modifies the customer information of the two customers. Configuring this flow involves configuring the HTTP *Listener* source, adding the *Logger* component, adding the *Transform Message* component, adding the *Modify* operation, adding another *Transform Message* component, and adding another *Logger* component.

=== Configure the HTTP Listener Source 

Configure the HTTP *Listener* source to initiate a Mule flow when a call is made to the `/modify` path:

. From the *Mule Palette* view, select *HTTP* and drag the *Listener* source to the canvas.
. In the properties window, click *+* next to the *Connector configuration* field to add a global element.
. In the *Display Name* field, enter `Listener`.
. In the *Path* field, enter `/modify`.

=== Add the Logger Component 

Add the *Logger* component to log the payload:

. From the *Mule Palette* view, select *Core* and drag the *Logger* component next to the *Listener* source.
. In the *Message* field, enter `payload`.

=== Add the Transform Message Component

Add the *Transform Message* component to transform the customer name and company input values of the two customers to XML: 

. From the *Mule Palette* view, select *Core* and drag the *Transform Message* component next to the *Logger* component.
. In the properties window, overlay the brackets in the *Output* section with this DataWeave code:
+
[source,dataweave,linenums]
----
%dw 2.0
output application/xml
ns ns0 http://namespaces.soaplite.com/perl
---
//Some output fields where skipped as the structure is too deep (more than 2 levels).
//To add missing fields click on the scaffold icon (second on the toolbar).
{
	modifyRequest: {
		ArrayOfoaBase: {
			oaBase : {
				ns0#oaCustomer: {
					id: payload.modifyCustomerID_1,
					name: payload.modifyCustomerName_1,
					company: payload.modifyCustomerCompany_1
				},
				ns0#oaCustomer: {
					id: payload.modifyCustomerID_2,
					name: payload.modifyCustomerName_2,
					company: payload.modifyCustomerCompany_2
				}			
			}
		}
		
	}
}
----

=== Add the Modify Operation

Add the *Modify* operation to modify the customer information of the two customers: 

. From the *Mule Palette* view, select *NetSuite OpenAir* and drag the *Modify* operation next to the *Transform Message* component.
. In the properties window, complete the following fields:
+
[%header%autowidth.spread]
|===
|Field|Value
|*oaObject* |`oaCustomer`
|*Request* |`payload`
|===

=== Add Another Transform Message Component 

Add another *Transform Message* component to transform the modified customer name and company values of the two customers to JSON: 

. From the *Mule Palette* view, select *Core* and drag the *Transform Message* component next to the *Modify* operation.
. In the properties window, overlay the brackets in the *Output* section with this DataWeave code:
+
[source,dataweave,linenums]
----
%dw 2.0
output application/json
ns ns0 http://namespaces.soaplite.com/perl
---
{
	customerID_1: payload.ns0#ArrayOfUpdateResult.*updateResult[0].id,
	customerStatus_1: payload.ns0#ArrayOfUpdateResult.*updateResult[0].status,
	customerID_2: payload.ns0#ArrayOfUpdateResult.*updateResult[1].id,
	customerStatus_2: payload.ns0#ArrayOfUpdateResult.*updateResult[1].status
}
---- 

=== Add Another Logger Component 

Add another *Logger* component to log the payload:

. From the *Mule Palette* view, select *Core* and drag the *Logger* component next to the *Transform Message* component.
. In the *Message* field, enter `payload`.