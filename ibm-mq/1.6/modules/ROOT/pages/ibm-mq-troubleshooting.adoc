= Troubleshoot IBM MQ Connector
This page contains common troubleshooting suggestions for Anypoint Connector for IBM MQ Connector

[[generic-issues]]
== Troubleshoot Generic Issues
You can find here a listing of the most common IBM MQ Connector generic issues and how to overcome them.

*<<gathering-detailed-logs,GATHERING DETAILED LOGS>>
*<<acknowledgement-issues,ACKNOWLEDGEMENT ISSUES>>.


[[gathering-detailed-logs]]
=== Gathering Detailed Logs
Sometimes you are not sure why the application is failing and you require a better understanding of what is going on in the app's interaction with the MQ server.

To fine tune the logs:

* Use the configuration file to increase the logging level on the server side.

* Get better and more detailed logs on the Mule application side by enabling verbose logging for Mule JMS and MQ Packages:
+
. Access Anypoint Studio and navigate to the *Package Explorer* view.
. Open your application's project name.
. Open the *src/main/resources* path folder.
. Open the *log4j2.xml* file inside the folder.
. If the following line is already in the *log4j2.xml* file, uncomment it to enable it; otherwise, add it:
+
[source,xml,linenums]
----
    <AsyncLogger name=“com.mulesoft.connectors.ibmmq” level=“DEBUG”/>
    <AsyncLogger name=“org.mule.jms.commons” level=“DEBUG”/>
----


[[acknowledgment-issues]]
=== Acknowledgment Issues
There are several ways an application setup may be inconsistent in terms of message acknowledgment.
An application may set the session acknowledgment as:

* IMMEDIATE
* AUTO
* MANUAL
* DUPS_OK

When the session acknowledgement is set to IMMEDIATE, the message gets acknowledged as soon as it's received. Please take care of not mixing IMMEDIATE acknowledgment with Ack or Recover session operations.
When the session acknowledgement is set to AUTO, the On new message source takes control of the acknowledment (when the event finishes) or session recover (when an error is throwin while processing the event). Adding a manual acknowledgement or session recover in an application with AUTO acknowledgment will lead to duplicate operations on a channel. 
When the session acknowledgment is set to MANUAL or DUPS_OK, please ensure that every path on of the flow execution gets a message acknowledgement or a session recover. Otherways, there will be a message leak that may lead to an unresponsive consumer once the max depth of the unit of work is reached. 

To resolve this issue:
Take a detailed look at the flow desing and be sure that every message gets acknoledgment o the session is recovered. 

[common-errors]]
== Troubleshoot Common Errors
You can find here a listing of the most common IBM MQ Connector errors and how to overcome them.

*<<error-consuming-messages,MQ Stopped Consuming Messages>>.
*<<error-redeploiment,Redeployment errors when using binding mode.>>.


[[error-consuming-messages]]
=== MQ Stopped Consuming messages
This usually is related to a large number of unacknowledged messages. When you have a mule application that has a On new message source with manual acknowledgement of messages and not every path of it has the proper Acknowledge or Session recover, it may lead to an unresponsive consumer.

To resolve this error:
Check the depth of unacknowledged messages broker side and review the application logic.

[[error-redeployment]]
=== Redeployment erros when using binding mode
When using binding mode for connections, the driver loads a JNI resource. This JNI resource can only be loaded once and when the application is redeployed an error is thrown.

To resolve this error:
Add the driver dependency at domain level. This will allow application redeployments.


[[common-throws]]
== Understand Common Throws

* IBM-MQ:ACK

There was an error in the context of the acknowledgment of an inflight message. This may be related to <<Acknoledgement Issues 

* IBM-MQ:CONNECTIVITY

The connection is no longer valid, it will be disposed and a reconnection policy may be applied if defined in the application setup.

* IBM-MQ:CONSUMING

There was an error consuming messages from WMQ, this may be related to the absense of a pending message.

* IBM-MQ:DESTINATION_NOT_FOUND

This exception is thrown when the connector is not able to find or create the Destination.

* IBM-MQ:RETRY_EXHAUSTED

The maximum number of retries for the operation was reached.

* IBM-MQ:SECURITY

This exception is thrown in case of security exception related errors.

* IBM-MQ:TIMEOUT

The timeout for the requested operation was exceeded. 

* IBM-MQ:ILLEGAL_BODY

This exception is thrown in the cases in which a message body invalid or cannot be converted to a supported type

* IBM-MQ:PUBLISHING

There was an error while publishing to the target Queue or Topic.

== See Also
* https://help.mulesoft.com[MuleSoft Help Center]
* xref:<connector name>-reference.adoc[Connector Reference]
