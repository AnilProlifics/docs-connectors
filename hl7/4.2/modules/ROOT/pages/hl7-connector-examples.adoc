= HL7 EDI - Examples - Mule 4

////
While each example differs, all connector examples should have the following components:

An introductory paragraph that states what the example depicts. This paragraph should explicitly state why the example is helpful to the audience, and it can provide other necessary contextual information.

A screenshot of each Studio flow that the user is creating

Step-by-step instructions for creating the example in Studio

The resulting XML that users can paste into the Studio XML editor. You must remove the  attributes from the XML before including it in the topic.

If the example contains multiple flows or is long and complex, break up the example into subsections that reflect logical chunks of functionality. For example, the Apache Kafka Connector Examples topic shows how to publish a message for Apache Kafka and then retrieve it. It has one subsection for each flow plus one for the XML:

Create the Producer Flow
Create the Consumer Flow
XML for Consuming and Publishing a Topic

The Amazon SQS Connector Examples topic also contains two flows: one for publishing an Amazon SQS topic and one for consuming the published topic. However, the first flow consists of many components. This topic breaks up the first flow into additional subsections:

Create a Flow to Send a Message
Add a Transform Message Component to Attach the Metadata
Add and Configure the SQS Send Message Operation
Add a Logger Component to Display the Response in the Mule Console
Obtain the Number of Messages in the Queue
Add a Logger to Display the Number in the Mule Console
Create a Flow to Receive Messages
Example Mule Application XML Code

If your Examples topic contains multiple examples, create a hyperlinked list of examples in the topic introduction, as shown in the Template for Creating Multiple Examples in One Examples Topic, or use the Template for Using Multiple Examples Topics.
////

// Put Examples here -- You may need to obtain these from the
// code repo /demo folder.

Template for a Single Example

// Use this template to include a single example in the Examples topic.
// For examples of this template, see Amazon SQS Connector Examples and Apache Kafka Connector Examples.
=== Simplify a Schema Using Example Messages

The HL7 standard definitions are very complex, with segments often
having twenty or more components and many of the components composites
which themselves are broken down into many subcomponents. This can
make mapping HL7 difficult, since the DataSense view of the message
has to contain all these subcomponents.

In practice, most users of HL7 populate only a small fraction of the
total HL7 standard definitions. To take advantage of this, the HL7
EDI Connector provides a console-based Java tool you can use to
simplify your schema definitions by eliminating components which
are not normally used in your messages.

The schema simplification tool is in the
`hl7-simplify-4.0.0.jar` file, which is found in the standard
MuleSoft enterprise Maven repositories (under group ID `com.mulesoft.connectors`).
It takes a message structure schema and one or more example messages
(as separate files) as input, and generates an output schema reduced
down to only those segments and components present in one or more of
the sample messages.

To use this tool, download the `JAR` and open a command line console, then type:

[source,console]
----
java -jar hl7-simplify-4.0.0.jar {input-schema} {output-schema} {sample1} {sample2} ...
----

Where:

* `input-schema` is the message structure schema used to read the messages,
which can be a file or a classpath reference to a supplied schema
such as the `/hl7/v2_5_1/ADT_A05.esl` path.
* `output-schema` is the file path for the simplified schema output.
* `sample1...n` are the file paths to the sample messages.

Make sure the sample message files are saved with carriage return (CR)
line endings, since this is the required HL7 segment delimiter. Text editors
generally use the default line ending for your operating system, which may not be correct.

Here's a partial example of a simplified schema generated using this tool:

[source,yaml,linenums]
----
form: HL7
version: '2.5.1'
structures:
- id: 'SIU_S12'
  name: 'SIU_S12'
  data:
  - { idRef: 'MSH', position: '01', usage: O }
  - { idRef: 'SCH', position: '02', usage: O }
  - groupId: 'PATIENT'
    count: '>1'
    usage: O
    items:
    - { idRef: 'PID', position: '06', usage: O }
    - { idRef: 'PV1', position: '08', usage: O }
  - groupId: 'RESOURCES'
    count: '>1'
    usage: O
    items:
    - { idRef: 'RGS', position: '14', usage: O }
    - groupId: 'SERVICE'
      count: '>1'
      usage: O
      items:
      - { idRef: 'AIS', position: '16', usage: O }
    - groupId: 'GENERAL_RESOURCE'
      count: '>1'
      usage: O
      items:
      - { idRef: 'AIG', position: '20', usage: O }
    - groupId: 'LOCATION_RESOURCE'
      count: '>1'
      usage: O
      items:
      - { idRef: 'AIL', position: '24', usage: O }
    - groupId: 'PERSONNEL_RESOURCE'
      count: '>1'
      usage: O
      items:
      - { idRef: 'AIP', position: '28', usage: O }
segments:
- id: 'AIG'
  name: 'Appointment Information - General Resource'
  varTag: 'AIG'
  values:
  - { idRef: 'SI', name: 'Set ID - AIG', usage: O }
  - { idRef: 'varies', name: 'Segment Action Code', usage: U, count: '>1' }
  - { idRef: 'CE_2', name: 'Resource ID', usage: O }
  - { idRef: 'varies', name: 'Resource Type', usage: U, count: '>1' }
  - { idRef: 'varies', name: 'Resource Group', usage: U, count: '>1' }
  - { idRef: 'varies', name: 'Resource Quantity', usage: U, count: '>1' }
  - { idRef: 'varies', name: 'Resource Quantity Units', usage: U, count: '>1' }
  - { idRef: 'TS', name: 'Start Date/Time', usage: O }
- id: 'AIL'
  name: 'Appointment Information - Location Resource'
  varTag: 'AIL'
  values:
  - { idRef: 'SI', name: 'Set ID - AIL', usage: O }
  - { idRef: 'varies', name: 'Segment Action Code', usage: U, count: '>1' }
  - { idRef: 'PL', name: 'Location Resource ID', usage: O, count: '>1' }
  - { idRef: 'CE', name: 'Location Type-AIL', usage: O }
  - { idRef: 'varies', name: 'Location Group', usage: U, count: '>1' }
  - { idRef: 'TS', name: 'Start Date/Time', usage: O }
- id: 'AIP'
  name: 'Appointment Information - Personnel Resource'
  varTag: 'AIP'
  values:
  - { idRef: 'SI', name: 'Set ID - AIP', usage: O }
  - { idRef: 'varies', name: 'Segment Action Code', usage: U, count: '>1' }
  - { idRef: 'XCN_2', name: 'Personnel Resource ID', usage: O, count: '>1' }
  - { idRef: 'CE_1', name: 'Resource Type', usage: O }
  - { idRef: 'varies', name: 'Resource Group', usage: U, count: '>1' }
  - { idRef: 'TS', name: 'Start Date/Time', usage: O }
...
composites:
- id: 'CE'
  name: 'Coded Element'
  values:
  - { idRef: 'ST', name: 'Identifier', usage: O }
  - { idRef: 'ST', name: 'Text', usage: O }
- id: 'CE_1'
  name: 'Coded Element'
  values:
  - { idRef: 'ST', name: 'Identifier', usage: O }
- id: 'CE_2'
  name: 'Coded Element'
  values:
  - { idRef: 'ST', name: 'Identifier', usage: O }
  - { idRef: 'ST', name: 'Text', usage: O }
  - { idRef: 'ID', name: 'Name of Coding System', usage: O }
...
----

Unused components of a segment cannot be dropped from the segment
definition (unless they're at the end of the segment), so the simplification
tool just substitutes a `varies` data type for the component and marks it
with `Usage: U` for Unused. The repetition count for the `varies` remains the
same as for the original component in this case, but it does not display
in the DataSense view of the data you see in DataWeave.

When the schema simplification tool checks which data is present in the
messages, it handles each occurrence of a composite in context. Different
usages of the same composite may have different values present in your samples. When this happens, the composite is defined more than once with different identifiers.
The CE composite in the above example shows this.

The simplified schema retains the segment positions from the original schema.
You can delete these position values from the simplified schema if you want,
since they're not used by the HL7 EDI Connector unless you use position
prefixes on segment keys (one of the connector configuration options).




=== Example: HL7 Studio

The following flow can be loaded from the XML that follows.

image::hl7-connector-flow-in-studio.png[Example flow in Studio]

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
xmlns:hl7="http://www.mulesoft.org/schema/mule/hl7"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
  xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core
  http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http
http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/hl7
http://www.mulesoft.org/schema/mule/hl7/current/mule-hl7.xsd
http://www.mulesoft.org/schema/mule/ee/core
http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<http:listener-config name="HTTP_Listener_config"
  doc:name="HTTP Listener config" >
		<http:listener-connection host="localhost" port="8081" />
	</http:listener-config>
	<hl7:config name="HL7_Extension_Config" doc:name="HL7 Extension Config" identKeys="true">
		<hl7:schemas >
			<hl7:schema value="/hl7/v2_5_1/ADT_A05.esl" />
			<hl7:schema value="/hl7/v2_5_1/ADT_A01.esl" />
		</hl7:schemas>
	</hl7:config>
	<flow name="hl7testFlow" >
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config" path="/hl7"/>
		<hl7:read doc:name="Read" config-ref="HL7_Extension_Config"/>
		<ee:transform doc:name="Transform Message" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/java
---
{
	Delimiters: payload.Delimiters,
	Id: payload.Id
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<hl7:write doc:name="Write" config-ref="HL7_Extension_Config"/>
	</flow>
</mule>
----

=== Set Your HL7 Identification in XML

You can configure the Message Header (MSH) application and facility identification for you and your trading partner on the HL7 EDI connector configuration.

The values you set are used when writing HL7 messages to supply the namespace ID, universal ID, and universal ID type, and are verified in receive messages. If you don't want to restrict incoming messages you can leave these blank, and set the values for outgoing messages on the write operation or the actual outgoing message. Values set on the write operation override the connector configuration, and values set directly on the message override both the connector configuration and any values set on the write operation.

* Self identification parameters identify your side of the trading partner relationship.
+
Self identification parameters:
+
[source,text,linenums]
----
appNamespaceIdSelf="<value>"
appUniversalIdSelf="<value>"
appUniversalIdTypeSelf="<value>"
----
+
* Partner identification parameters identify your trading partner.
+
Partner identification parameters:
+
[source,text,linenums]
----
appNamespaceIdPartner="<value>"
appUniversalIdPartner="<value>"
appUniversalIdTypePartner="<value>"
----

= Title for what example does

<Introductory text>
The following text can be in the same paragraph as the introductory text or in a separate paragraph, depending on the introductory paragraph length.
This example uses variables for some field values. You can either:
Replace the variables with their values in the code.
Provide the values for each variable in a properties file and then refer to that file from the connector configuration.
If you don’t know how to use a properties file, see Configuring Property Placeholders.
Use subsections, if needed, to show the configuration steps.
== Subsection 1
== Subsection 2
== Subsection 3
.
.
.

// Add these steps to the end of the numbered list:
. Save the project.
. Test the app by sending a <REST command> request to <url>.

== XML for <what the example shows>

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here.
// Remove the  attributes from the XML before including it in the topic.>

// If you aren’t splitting the example into subsections, add these subsections instead:

== Steps for <what the example shows>

// Add these steps to the end of the numbered list:
. Save the project.
. Test the app by sending a <REST command> request to <url>.

== XML for <what the example shows>

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here.
// Remove the  attributes from the XML before including it in the topic.>

Template for Including Multiple Examples in One Examples Topic

// Use this template under one of these circumstances to include multiple examples in the
// Examples topic:

// The examples are related.
// There are only a few examples and the documentation for each one is fairly short.

////
For an example of this template, see NetSuite Connector 10.0 Examples - Mule 4. Consider using the Template for Including Multiple Examples in One Examples Topic if you have multiple, unrelated examples.
////

= <connector> Examples - Mule 4

The following examples show how to <action> with <connector-name>:

<Hyperlink 1>
<short description of the example>
<Hyperlink 2>
<short description of the example>
.
.
.
These examples use variables for some field values. You can either:
Replace the variables with their values in the code
Provide the values for each variable in a properties file and then refer to that file from the connector configuration.
If you don’t know how to use a properties file, see Configuring Property Placeholders.

== <Example 1>

// Use subsections, if needed, to show configuration steps.
=== Subsection 1
=== Subsection 2
=== Subsection 3
.
.
.
// Add these steps to the end of the numbered list:
. Save the project.
. Test the app by sending a <REST command> request to <url>.

=== XML for <what the example shows>

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here.
// Remove the  attributes from the XML before including it in the topic.>

// If you aren’t splitting the example into subsections, add these subsections instead:

=== Steps for <what the example shows>

// Add these steps to the end of the numbered list:
. Save the project.
. Test the app by sending a <REST command> request to <url>.

=== XML for <what the example shows>

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here.
// Remove the  attributes from the XML before including it in the topic.>

== <Example 2>

// Same template for Example 1

== <Example 3>
.
.
.

== See Also

* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
