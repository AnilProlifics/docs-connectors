= X12 EDI Connector 2.5 - Examples - Mule 4

Use this example to translate Outbound Enterprise purchase order XML messages from back-end Enterprise Resource Planning (ERP) into Electronic Data Interchange (EDI) X12 850 transactions. It validates Inbound EDI purchase orders received, translates to an Enterprise purchase order with a JSON structure, and integrates with back-end systems.

== Transforming Outbound XML Purchase Order Messages to X12 EDI 850 Transactions

This example uses two fictional Enterprises:

* NTO Retailer: Translates Outbound Enterprise purchase order XML messages from back-end ERP into EDI X12 850 transactions.

* Mythical Supplier: Validates inbound EDI purchase orders received, translate to an Enterprise purchase order JSON structure, and integrate with back-end systems.

Both are exchanging purchase orders as outlined in the following diagram:

////
image::foo.jpg[Overview]
////

There is an HTTPS Listener used as the message source in order to receive Enterprise purchase order XML messages from back-end systems. DataWeave and X12 Writes are used to translate the XML message into an X12 v4010 850 Purchase order EDI message. The generated X12 message is published to an Anypoint MQ queue, and sent to Mythical Supplier via AS2.

== Prerequisites

The example uses static configurations for X12 identifiers and Anypoint MQ. They can be replaced with expressions for dynamic routing and identifier set up.

. Open the Example project in Anypoint Studio from Anypoint Exchange.
. Install the latest version of Anypoint X12 connector.
. Update (or create) the configuration property file located in `src/main/resources/app.properties` with these values:

`tls-truststore.password=test`

`tls-keystore.password=muletest`


=== Configuring Anypoint MQ

. From Anypoint MQ console create a new Anypoint MQ called: `queue b2b-outbound-mythical-as2.q`.

. Create a new client app in Anypoint MQ console.

. Update these properties in the `app.properties` file with the API URL, Client Id and Client Secret for the Anypoint MQ connection:
+
`anypoint-mq.url`

`anypoint-mq.clientid`

`anypoint-mq.clientsecret`
+
. Deploy the example to CloudHub or run it locally.

== Global Configurations

Configure the General tab setting for the X12 Write configuration.

. Choose Edit inline from schema definitions and add:

`/x12/004010/850.esl`

X12 Connector uses EDI Schema Language (ESL) to maintain X12 standard specifications supported by the connector. You can also clone the standard ESLs and customize them to suit you or your trading partner's requirements if different from the X12 standards.

. Use the Identity tab to setup the ISA/GS Sender and Receiver identifiers and the qualifiers. This demo example uses a static configuration, but these fields can be dynamically populated using expressions.

. Use the Writer tab to set configurations for delimiters, control numbers, and other validations for the X12 data generated.

== Translating XML to EDI X12 850

The Transform message component in the application translates the received XML enterprise purchase order payload into EDI X12 850 message structure. X12 Write component with the schema definition (850.esl) lets DataSense to automatically populate the X12 structure on the target side of the map, enabling easier way to map the XML data into X12 structure.

The output of the DataWeave map is an X12 message presented in a Java Object structure and the X12 Write component in the next step performs the validation against X12 specifications and the validation rules in the connector configuration, producing the raw EDI message in X12 format.

== X12 Control numbers

X12 Connector provides three ways of generating control numbers on the generated X12 payload.

X12 Connector managed global control numbers through control number keys
When to use: If your organization or your trading partner have a requirement to maintain uniqueness of interchange, group or transaction set control numbers across different identifier combinations and document types.
How to use:
Set the configuration “Use supplied values” to False.
Leverage the control number key configurations (at the configuration level, or operation level) to set a key that is unique for the partner. These values can be dynamically passed at the operation-level.

For example: The values for the interchange and group control number keys can be “PartnerName-ISA,” “PartnerName-GS,” used across different identifiers and transaction types for the same partner.

X12 Connector managed identifier combination control numbers:
The connector automatically maintains the sequencing of control numbers for the sender/receiver identifier combination, initializing the value to the number specified in the configuration.
When to use: If you want the connector to automatically maintain the sequencing based on the sender/receiver identifiers and do not have requirements for global control numbers at a partner level.
How to use:
This is the default behavior when no value is passed into the optional interchange / group / Transaction number key configurations.
The Write configuration “Use supplied values” must be set to False.
Bring your own control number
If you need to generate the control numbers and use them on the EDI payload, you can set the parameter “Use supplied values” to true, and map the desired control number on the payload in the DataWeave map.

== Deploying the outbound PO application

Deploy the application to CloudHub or a standalone Mule runtime, and NTO Retailer is now ready to receive outbound enterprise purchase order XML messages from back-end systems, and send EDI purchase orders to Mythical Supplier.

== Mythical Supplier: Inbound purchase order application

We will use the demo application example-b2b-mythical-inbound-purchase-order to showcase how to implement the inbound purchase order service at Mythical Supplier’s end.

The application receives the raw X12 850 purchase order messages from an Anypoint MQ (published by the AS2 receiver application in the previous blog), uses X12 Read operation to validate received EDI 850 purchase order messages, transform to the inbound enterprise purchase order JSON format and handoff to a process API for further processing into the ERP/Order Management system. For demo purposes, the process API writes the translated JSON to Anypoint MQ.

== X12 Read configuration

Configure the path to the ESL (/x12/004010/850.esl) in the Schema definition.

Identity: ISA/GS sender and receiver identifiers.

== EDI X12 850 to JSON transformation

DataWeave component after the X12 read is used to transform the EDI data into the enterprise inbound purchase order JSON message format.

The translated data then gets sent to the process API via HTTP request component, and subsequently is published to Anypoint MQ.

Deploying the inbound PO application
Deploy the application to CloudHub or a standalone Mule runtime, and Mythical supplier is now ready to receive EDI purchase orders and seamlessly integrate with the backend applications.

== Running the Example

Now test the end to end flow with this example.

. Post an XML purchase order payload to NTO Retailer’s outbound purchase order service.

The message will not go through the below processing stages:

Browse the Anypoint MQ queue where the translated inbound enterprise purchase order is published after Mythical Supplier receives the EDI data via AS2 and converts into JSON format.



. Using a REST Client, POST the XML payload `src/main/resources/Enterprise-Outbound-PO.xml` to https://localhost:8443/b2b/enterprise-ob-po/ or https://app-name.cloudhub.io/b2b/enterprise-ob-po/ if deployed to CloudHub.

You see the raw EDI X12 850 purchase order transaction returned as the response. It is also published to the Anypoint MQ queue `b2b-outbound-mythical-as2.q`, ready to be sent to the trading partner.







== See Also

* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
