= X12 EDI - Examples - Mule 4

////
While each example differs, all connector examples should have the following components:

An introductory paragraph that states what the example depicts. This paragraph should explicitly state why the example is helpful to the audience, and it can provide other necessary contextual information.

A screenshot of each Studio flow that the user is creating

Step-by-step instructions for creating the example in Studio

The resulting XML that users can paste into the Studio XML editor. You must remove the  attributes from the XML before including it in the topic.

If the example contains multiple flows or is long and complex, break up the example into subsections that reflect logical chunks of functionality. For example, the Apache Kafka Connector Examples topic shows how to publish a message for Apache Kafka and then retrieve it. It has one subsection for each flow plus one for the XML:

Create the Producer Flow
Create the Consumer Flow
XML for Consuming and Publishing a Topic

The Amazon SQS Connector Examples topic also contains two flows: one for publishing an Amazon SQS topic and one for consuming the published topic. However, the first flow consists of many components. This topic breaks up the first flow into additional subsections:

Create a Flow to Send a Message
Add a Transform Message Component to Attach the Metadata
Add and Configure the SQS Send Message Operation
Add a Logger Component to Display the Response in the Mule Console
Obtain the Number of Messages in the Queue
Add a Logger to Display the Number in the Mule Console
Create a Flow to Receive Messages
Example Mule Application XML Code

If your Examples topic contains multiple examples, create a hyperlinked list of examples in the topic introduction, as shown in the Template for Creating Multiple Examples in One Examples Topic, or use the Template for Using Multiple Examples Topics.
////

// Put Examples here -- You may need to obtain these from the
// code repo /demo folder.



== XML for <what the example shows>

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here.
// Remove the  attributes from the XML before including it in the topic.>

// If you aren’t splitting the example into subsections, add these subsections instead:

== Example: X12 Studio Flow

The following flow can be loaded in the XML for a project.

image::x12-edi-mapping-flow.jpg[Mapping Flow Diagram]

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
xmlns:x12="http://www.mulesoft.org/schema/mule/x12"
xmlns:http="http://www.mulesoft.org/schema/mule/http"
xmlns="http://www.mulesoft.org/schema/mule/core"
xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core
http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http
http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/x12
http://www.mulesoft.org/schema/mule/x12/current/mule-x12.xsd
http://www.mulesoft.org/schema/mule/ee/core
http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config">
		<http:listener-connection host="localhost" port="8081" />
	</http:listener-config>
	<x12:config name="X12_EDI_Config" doc:name="X12 EDI Config">
	    <x12:schemas>
	        <x12:schema value="/x12/005010/850.esl"/>
	    </x12:schemas>
	</x12:config>
	<flow name="x12mappingFlow">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config" path="/x12"/>
		<x12:read doc:name="Read" config-ref="X12_EDI_Config"/>
		<ee:transform doc:name="Transform Message">
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/java
---
{
    TransactionSets: {
        v005010: {
            "850": payload.TransactionSets.v005010."850"
        }
    }
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<x12:write doc:name="Write" config-ref="X12_EDI_Config"/>
	</flow>
</mule>
----


== Steps for <what the example shows>

// Add these steps to the end of the numbered list:
. Save the project.
. Test the app by sending a <REST command> request to <url>.

== XML for <what the example shows>

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here.
// Remove the  attributes from the XML before including it in the topic.>

Template for Including Multiple Examples in One Examples Topic

// Use this template under one of these circumstances to include multiple examples in the
// Examples topic:

// The examples are related.
// There are only a few examples and the documentation for each one is fairly short.

////
For an example of this template, see NetSuite Connector 10.0 Examples - Mule 4. Consider using the Template for Including Multiple Examples in One Examples Topic if you have multiple, unrelated examples.
////

= <connector> Examples - Mule 4

The following examples show how to <action> with <connector-name>:

<Hyperlink 1>
<short description of the example>
<Hyperlink 2>
<short description of the example>
.
.
.
These examples use variables for some field values. You can either:
Replace the variables with their values in the code
Provide the values for each variable in a properties file and then refer to that file from the connector configuration.
If you don’t know how to use a properties file, see Configuring Property Placeholders.

== <Example 1>

// Use subsections, if needed, to show configuration steps.
=== Subsection 1
=== Subsection 2
=== Subsection 3
.
.
.
// Add these steps to the end of the numbered list:
. Save the project.
. Test the app by sending a <REST command> request to <url>.

=== XML for <what the example shows>

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here.
// Remove the  attributes from the XML before including it in the topic.>

// If you aren’t splitting the example into subsections, add these subsections instead:

=== Steps for <what the example shows>

// Add these steps to the end of the numbered list:
. Save the project.
. Test the app by sending a <REST command> request to <url>.

=== XML for <what the example shows>

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

// <Copy the XML from Studio and paste it here.
// Remove the  attributes from the XML before including it in the topic.>

== <Example 2>

// Same template for Example 1
== About the X12 Message Structure

The connector enables reading or writing of X12 documents into or from the canonical EDI message structure. This structure is represented as a hierarchy of Java Maps and Lists, which can be manipulated using DataWeave or code. Each transaction has its own structure, as defined in the schemas, as outlined above.

The message itself contains the following keys (some of which only apply to either the read operation or the write operation, as indicated):

[%header%autowidth.spread]
|===
|Key name |Description
|Delimiters (optional) |The delimiters used for the message (set based on the last interchange processed by a read operation). If set for a write operation this overrides the values in the module configuration. The characters in the string are interpreted based on position, in the following order: (data separator), (sub-element separator), (repetition separator, or 'U' if none), (segment terminator).
|Errors (read only) |A list of errors that are associated with the input as a whole, or with interchanges with no valid transaction sets. See the X12Error structure description in the To Read and Validate X12 EDI Messages section below.
|FunctionalAcksGenerated (read only) |A list of 997 or 999 acknowledgments (as configured) that were generated by the module during the read operation. To send an acknowledgment, see the Sending Acknowledgments section below.
|Group (write only) |Map of GS group header segment values used as defaults when writing groups.
|Interchange (write only) |Map of ISA interchange header segment values used as defaults when writing interchanges.
|InterchangeAcksGenerated (read only) |A list of TA1 acknowledgments that were generated by the module during the read operation.
|InterchangeAcksReceived (read only) |A list of TA1 acknowledgments that were received by the module during the read operation.
|InterchangeAcksToSend (write only) |A list of TA1 acknowledgments that are to be sent by the module during the write operation.
|Transactions |A hierarchy of the transaction sets which were read by the module during a read operation, or which are to be sent by the module during a write operation. The value of this top-level key is a map with standard versions as keys, in the form "v005010" (for instance). For example, if you are using version 005010 850 and 855 transaction sets, the Transactions would contain a map with one key, "v005010". The value of this key would be another map, this one with two keys, "850" and "855". Each of these would contain a list of individual 850 and 855 transaction sets that you could then process. If you're using 997 functional acknowledgments "997" is the key for a list of 997 transaction sets.
|===

Individual transaction sets have their own maps, with the following keys:

[%header%autowidth.spread]
|===
|Key |Description
|Detail |Map of segments or loops from the detail section of the transaction set. Values are maps for segments or loops which occur at most once, lists of maps for values which may be repeated.
|Errors (read only) |A list of errors which are associated with the transaction set. (See the X12Error class description in the Reading and Validating EDI Messages section below.)
|Group |Map of GS group header segment values. When reading a message, this map is the actual data from the enclosing group (a single map linked from all transaction sets in the group). When writing a message, these values are used for creating the enclosing group. Values not populated in this map default to the values from the Group map at the message level.
|Heading |Map of segments or loops from the heading section of the transaction set. Values are maps for segments or loops which occur at most once, lists of maps for values which may be repeated.
|Id |Transaction ID, which must match the key of the containing transaction list.
|Interchange |Map of ISA interchange header segment values. When reading a message, this map is the actual data from the enclosing interchange (a single map linked from all transaction sets in the interchange). When writing a message, these values are used for creating the enclosing interchange (gathering transactions with the same interchange values into a single interchange, regardless of whether the actual maps are the same or not). Values not populated in this map default to the values from the Interchange map at the message level.
|Name |Transaction set name.
|SetHeader |Map of ST transaction set header segment values. This gives the actual header data for a read operation, and allows you to provide overrides for configuration settings for a write operation.
|Summary |Map of segments or loops from the summary section of the transaction set. Values are maps for segments or loops which occur at most once, lists of maps for values which may be repeated.
|===

Generated 997/999 functional acknowledgment transactions differ from received messages in their handling of interchange information:

[%header%autowidth.spread]
|===
|Key name |Description
|Interchange |Map of ISA interchange header segment values. For functional acknowledgments generated by receive processing, this map is a copy of the data for the containing interchange with sender and receiver identification components (ISA05/ISA06 and ISA07/ISA08) interchanged. When writing a message, these values are used for creating the enclosing interchange (gathering transactions with the same interchange values into a single interchange, regardless of whether the actual maps are the same or not). Values not populated in this map default to the values from the Interchange map at the message level.
|===

TA1 interchange acknowledgments are in the form of maps representing the TA1 segment data and linked to data on the corresponding interchange:

[%header%autowidth.spread]
|===
|Key name |Description
|Interchange |Map of ISA interchange header segment values. For TA1 acknowledgments generated by receive processing, this map is a copy of the data for the interchange matching the TA1 with sender and receiver identification components (ISA05/ISA06 and ISA07/ISA08) interchanged. When writing a message, these values are used for creating the enclosing interchange (gathering transactions with the same interchange values into a single interchange, regardless of whether the actual maps are the same or not). Values not populated in this map default to the values from the Interchange map at the message level.
|===

== About Time Fields

All X12 Time fields are represented as Integer values for the number of milliseconds.
For example, if a message has the value `024020`, its DataWeave mapping
appears as `9620000` milliseconds.

The value `024020` is in the format "HHMMSS", so if we convert it to milliseconds, use this formula:

----
(02*3600000) + (40*60000) + (20*1000) = 9620000

== <Example 3>

== To Read and Validate X12 EDI Messages

. To read an X12 message, search the palette for X12 EDI and drag the X12 Read operation into a flow.
. Go to the properties view, select the connector configuration you created above and select the Read operation. This operation reads any byte stream into the structure described by your X12 schemas.

The X12 module validates the message when it reads it in. Message validation includes checking the syntax and content of envelope segments ISA, GS, GE, and IEA as well as the actual transaction sets in the message. Normally errors are both logged and accumulated and reported in either TA1 technical acknowledgment segments or 997 acknowledgment transaction sets, and all accepted transaction sets (whether error free or with non-fatal errors) are passed on for processing as part of the output message Map. Errors in reading the input data results in exceptions being thrown.

Error data entered in the receive data map uses the X12Error class, a read-only JavaBean with the following properties:

[%header%autowidth.spread]
|===
|Property |Description
|segment |The zero-based index within the input of the segment causing the error.
|segTag |The tag for the segment causing the error.
|fatal |Flag for a fatal error, meaning the associated transaction set, group, or interchange was rejected as a result of the error.
|errorType |Enumeration for the different types of errors defined by the X12 standards: INTERCHANGE_NOTE, GROUP_SYNTAX, TRANSACTION_SYNTAX, SEGMENT_SYNTAX, or ELEMENT_SYNTAX.
|errorCode |Error code, as defined by the X12 standard for the indicated type of error.
|errorText |Text description of the error.
|errorLevel |Enumeration for the different levels of errors: ROOT_LEVEL, INTERCHANGE_LEVEL, GROUP_LEVEL, or TRANSACTION_LEVEL.
|interchangeId |Interchange identifier, if errorLevel INTERCHANGE_LEVEL or above.
|groupId |Group identifier, if errorLevel GROUP_LEVEL or TRANSACTION_LEVEL.
|transactionId |Interchange identifier, if errorLevel TRANSACTION_LEVEL.
|===

Error data is returned by the read operation as optional lists with the "Errors" key at every level of the data structure. At the transaction set level, this list contains non-fatal errors encountered during the parsing of that transaction set. At the interchange level, this list contains errors (both fatal and non-fatal) for transaction sets with fatal errors. At the root level of the read, this list contains both interchange errors and every other error reported at any nested level.

== To Write X12 EDI Messages

To write an outgoing message, search the palette for X12 EDI and drag the X12 Write operation into a flow. Construct an outgoing X12 EDI message according to the structure as defined above for input to the write operation. If no errors are found in the write operation the normal flow continues. Otherwise, an exception is thrown which includes an array of X12Error instances, the same as returned by the Read operation (documented above).

== To Send Functional Acknowledgments

Sending generated functional acknowledgments (997 or 999 transaction sets) is the same as writing any other EDI message, except you set the transactions to the acknowledgments that were generated during the read operation.

For example:

image::x12-edi-ack-flow.jpg[Ack Flow Diagram]

[source,xml,linenums]
----
<x12-edi:read config-ref="X12_EDI__Configuration" doc:name="Read EDI Doc"/>
  ...
<dw:transform-message doc:name="Create Outgoing Acks Message">
    <dw:set-payload><![CDATA[%dw 1.0
%output application/java
---
{
	TransactionSets: {
		v005010: {
			'997' : payload.FunctionalAcksGenerated
		}
	}
}]]></dw:set-payload>
</dw:transform-message>
<x12-edi:write config-ref="X12_EDI__Configuration" doc:name="Send Acks"/>
----

The generated functional acknowledgments have interchange data set up for sending back to the sender of the original message, so you don't need to change anything in the transactions to do the send.

If you use 999 acknowledgments, add any required CTX segments yourself to the basic structure generated by the X12 Module. The X12 connector does not track implementation convention changes to the base transaction set structure.

== Sending Interchange Acknowledgments

To send interchange acknowledgments (TA1 segments), set the value of the InterchangeAcksToSend key in the message map to the list of TA1 segment maps to be sent. The generated TA1 segments have interchange data set up for sending back to the sender of the original message, so you don't need to change anything in the segment data to do the send.

.
.

== See Also

* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
