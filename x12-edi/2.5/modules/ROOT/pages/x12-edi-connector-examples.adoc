= X12 EDI Connector 2.5 - Examples - Mule 4

Use this example to translate Outbound Enterprise purchase order XML messages from back-end Enterprise Resource Planning (ERP) into Electronic Data Interchange (EDI) X12 850 transactions. It validates Inbound EDI purchase orders received, translates to an Enterprise purchase order with a JSON structure, and integrates with back-end systems.

== Transforming Outbound XML Purchase Order Messages to X12 EDI 850 Transactions

This example uses two fictional Enterprises:

* NTO Retailer: Translates Outbound Enterprise purchase order XML messages from back-end ERP into EDI X12 850 transactions.

* Mythical Supplier: Validates inbound EDI purchase orders received, translate to an Enterprise purchase order JSON structure, and integrate with back-end systems.

Both are exchanging purchase orders as outlined in the following diagram:

////
image::foo.jpg[Overview]
////

There is an HTTPS Listener used as the message source in order to receive Enterprise purchase order XML messages from back-end systems. DataWeave and X12 Writes are used to translate the XML message into an X12 v4010 850 Purchase order EDI message. The generated X12 message is published to an Anypoint MQ queue, and sent to Mythical Supplier via AS2.

== Prerequisites

The example uses static configurations for X12 identifiers and Anypoint MQ. They can be replaced with expressions for dynamic routing and identifier set up.

. Open the Example project in Anypoint Studio from Anypoint Exchange.
. Install the latest version of Anypoint X12 connector.
. Update (or create) the configuration property file located in `src/main/resources/app.properties` with these values:

`tls-truststore.password=test`

`tls-keystore.password=muletest`


=== Configuring Anypoint MQ

. From Anypoint MQ console create a new Anypoint MQ called: `queue b2b-outbound-mythical-as2.q`.

. Create a new client app in Anypoint MQ console.

. Update these properties in the `app.properties` file with the API URL, Client Id and Client Secret for the Anypoint MQ connection:
+
`anypoint-mq.url`
+
`anypoint-mq.clientid`
+
`anypoint-mq.clientsecret`
+
. Deploy the example to CloudHub or run it locally.

== Global Configurations

Configure the General tab setting for the X12 Write configuration.

. From *Schema definitions* choose *Edit inline* add the following for the *value* field:

`/x12/004010/850.esl`

X12 Connector uses EDI Schema Language (ESL) to maintain X12 standard specifications supported by the connector. You can clone the standard ESLs and customize them to suit you or your trading partner's requirements if different from the X12 standards.

* Use the Identity tab to setup the ISA/GS Sender and Receiver identifiers and the qualifiers:

. Enter the Interchange ID qualifier and Interchange ID for your Mule application as *ZZ* and *NTORETAIL*.

. Enter the Interchange ID qualifier and Interchange ID for your partner as *01* and *MYTHICAL*.

This demo example uses a static configuration, but these fields can be dynamically populated using expressions.

* Use the Writer tab to set configurations for delimiters, control numbers, and other validations for the X12 data generated. For more detail on setting these configurations, refer to xref:x12-edi-connector-studio.adoc[Use Anypoint Studio to Configure X12 EDI Connector]

== Translating XML to EDI X12 850

The Transform message component in the application translates the received XML enterprise purchase order payload into an EDI X12 850 message structure. For the target portion of the map the X12 Write component (schema definition 850.esl) enables DataSense to automatically populate the X12 structure. This provides an easy way to map the XML data into the X12 structure.

The output of the DataWeave map is an X12 message in Java Object structure. The X12 Write component in the following step first performs the validation against X12 specifications, then the validation rules in the connector configuration, and produces the raw EDI message in X12 format.

== X12 Control Numbers

X12 Connector provides three ways of generating control numbers on the generated X12 payload. Refer to the one that best suits your needs.

* X12 Connector: using control number keys to manage global control numbers

Use this if your organization or your trading partner has a requirement to maintain unique interchange, group, or transaction set control numbers across different identifier combinations and document types.

. Set the configuration “Use supplied values” to `False`.

. Leverage the control number key configurations (at the configuration level, or operation level) to set a key that is unique for the partner.

These values can be dynamically passed at the operation-level.

For example: The values for the interchange and group control number keys can be `PartnerName-ISA`, `PartnerName-GS`, both used across different identifiers and transaction types for the same partner.

* X12 Connector: automatically manage identifier combination control numbers

The connector automatically maintains the sequencing of control numbers for the Sender/Receiver identifier combination, initializing the value to the number specified in the configuration.

Use this if you want the connector to automatically maintain the sequencing based on the Sender/Receiver identifiers and there are no requirements for global control numbers at a partner level.

This is the default behavior when no value is passed into the optional interchange / group / Transaction number key configurations.

The Write configuration `Use supplied values` must be set to `False`.

* Use your own control number

To generate the control numbers and use them on the EDI payload:

. Set the parameter `Use supplied values` to `True`.

. Map the desired control number on the payload in the DataWeave map.

== Deploying the Outbound Purchase Order Application

Once you deploy the application to CloudHub or a standalone Mule runtime, the NTO Retailer is now ready to:

* Receive outbound enterprise purchase order XML messages from back-end systems

* Send EDI purchase orders to Mythical Supplier

== Mythical Supplier: Inbound Purchase Order application

The demo application, `example-b2b-mythical-inbound-purchase-order` shows how to implement the Inbound purchase order service at Mythical Supplier’s end. It:

* Receives the raw X12 850 purchase order messages from an Anypoint MQ

* Uses the X12 Read operation to validate received EDI 850 purchase order messages

* Transforms to the Inbound Enterprise purchase order JSON format

* Hands off to a process API for further processing into the ERP/Order Management system.

In this example, the process API writes the translated JSON to Anypoint MQ.

== X12 Read configuration

Make the following changes:

. Configure the path to the ESL ``/x12/004010/850.esl` in the Schema definition.

. On the *Identity* tab configure the ISA/GS sender and receiver identifiers.

. On the *Parser* tab configure the validation and parsing rules needed for validation.

== EDI X12 850 to JSON transformation

An example of the DataWeave component after the X12 read is used to transform the EDI data into the Enterprise Inbound purchase order JSON message format.


The translated data is sent to the process API via an HTTP request component, and is subsequently published to Anypoint MQ.

== Deploying the Inbound Purchase Order Application

Once the application is deployed to CloudHub or a standalone Mule runtime, the Mythical supplier is now ready to receive EDI purchase orders and seamlessly integrate with the backend applications.

== Running the Example

To test the end-to-end flow with this example:

. Post an XML purchase order payload to NTO Retailer’s outbound purchase order service.
+
The message will not go through the below processing stages:
+


. Browse the Anypoint MQ queue where the translated Inbound Enterprise purchase order is published after Mythical Supplier receives the EDI data via AS2 and converts it into the JSON format.


////
. Using a REST Client, POST the XML payload `src/main/resources/Enterprise-Outbound-PO.xml` to https://localhost:8443/b2b/enterprise-ob-po/ or https://app-name.cloudhub.io/b2b/enterprise-ob-po/ if deployed to CloudHub.

You see the raw EDI X12 850 purchase order transaction returned as the response. It is also published to the Anypoint MQ queue `b2b-outbound-mythical-as2.q`, ready to be sent to the trading partner.
////


== See Also

* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
