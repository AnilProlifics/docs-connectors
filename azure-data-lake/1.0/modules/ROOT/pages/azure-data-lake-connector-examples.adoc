= Azure Data Lake Storage Connector Examples - Mule 4

The following Azure Data Lake Storage Connector examples show you how to:

* <<create-file-system-example,Create a file system>>. +
This flow shows you how to create a file system using the Azure Data Lake Storage connector.
* <<create-path-example,Create a path in a file system>>. +
This flow shows you how to create a path inside a file system using the Azure Data Lake Storage connector.
* <<update-path-example,Update a path in a file system>>. +
This flow shows you how to update a path inside a file system using the Azure Data Lake Storage connector.
* <<error-handling-example,Error handling example>>. +
This flow shows you a small example of how to implement error handling with the Azure Data Lake Storage connector.

These examples use variables for some field values. You can either:

* Replace the variables with their values in the code.
* Provide the values for each variable in a properties file and then refer to that file from the connector configuration.

If you donâ€™t know how to use a properties file, see Configuring Property Placeholders.

[[create-file-system-example]]
== Create a File System

=== Steps to Create a File System

==== Set up the Flow

. Create a new Mule project in Studio.
. In the *Mule Palette* view, search for `http` and select the *Listener* operation:
. Drag the *Listener* operation onto the Studio canvas.
. In the *Listener* configuration, click *+* next to the *Connector configuration* field to add a global element.
. Accept the defaults and click *OK*.
. In the *General* properties tab, set the *Path* field to `/create-fs`.

==== Configure the File System Operation

. In the Mule Palette view, search for azure and select the Azure Data Lake Storage Connector *Create File System* operation.
. Drag the *Create File System* operation from the Studio canvas into the Listener flow.
. In the *Create File System* configuration, click *+* next to the *Connector Configuration* field to add a connection configuration.
. From the *Connection* drop-down, select your connection authentication method and specify all the required values.
. Click *OK*.
. In the *File System* field, enter your desired file system name.
. Save the project.
. Test the app by sending a GET request to `localhost:8081/create-fs`.

=== XML for Creating a File System

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
xmlns:azure-data-lake-storage="http://www.mulesoft.org/schema/mule/azure-data-lake-storage"
xmlns="http://www.mulesoft.org/schema/mule/core"
xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/azure-data-lake-storage http://www.mulesoft.org/schema/mule/azure-data-lake-storage/current/mule-azure-data-lake-storage.xsd">
<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config">
<http:listener-connection host="0.0.0.0" port="8081" />
</http:listener-config>
<azure-data-lake-storage:config name="Azure_Data_Lake_Storage_Connector_Config" doc:name="Azure Data Lake Storage Connector Config">
<azure-data-lake-storage:shared-access-signature-connection accountName="${account.name}" dnsSuffix="${dns.suffix}" sasToken="${sas.token}" />
</azure-data-lake-storage:config>
<flow name="create-file-system-flow">
<http:listener doc:name="Listener" config-ref="HTTP_Listener_config" path="create-fs"/>
<azure-data-lake-storage:create-file-system doc:name="Create File System" config-ref="Azure_Data_Lake_Storage_Connector_Config" filesystem="newfilesystem"/>
</flow>

</mule>
----
For more information, see the *Create File System DEMO*. <link-to-demo>

[[create-path-example]]
== Create a Path

=== Steps to Create a Path

==== Set up the Flow

. Create a new Mule project in Studio.
. In the *Mule Palette* view, search for `http` and select the *Listener* operation:
. Drag the *Listener* operation onto the Studio canvas.
. In the *Listener* configuration, click *+* next to the *Connector configuration* field to add a global element.
. Accept the defaults and click *OK*.
. In the *General* properties tab, set the *Path* field to `/create-path`.

==== Specify the values for the Create Path operation:

. In the *Mule Palette* view, search for `azure` and select the *Create/Rename Path* operation.
. Drag the *Create/Rename Path* operation from the Studio canvas onto the Listener flow.
. In the *Create/Rename Path* configuration, click *+* next to the *Connector Configuration* field to add a connection configuration.
. From *Connection*, select your connection authentication method and specify all the required values.
. Click *OK*.
. In the *File System* field, enter the value for your target file system. +
The file system must exist, or an error is thrown.
. In *Path*, enter your desired path name.
. In *Resource*, enter either `file` or `directory`.
. Save the project.
. Test the app by sending a GET request to `localhost:8081/create-path`.

=== XML for Creating a Path

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:azure-data-lake-storage="http://www.mulesoft.org/schema/mule/azure-data-lake-storage"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/azure-data-lake-storage http://www.mulesoft.org/schema/mule/azure-data-lake-storage/current/mule-azure-data-lake-storage.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config">
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<azure-data-lake-storage:config name="Azure_Data_Lake_Storage_Connector_Config" doc:name="Azure Data Lake Storage Connector Config">
		<azure-data-lake-storage:shared-access-signature-connection accountName="${account.name}" dnsSuffix="${dns.suffix}" sasToken="${sas.token}" />
	</azure-data-lake-storage:config>
	<flow name="create-path-flow">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config" path="create-path"/>
		<azure-data-lake-storage:create-or-rename doc:name="Create/Rename Path" config-ref="Azure_Data_Lake_Storage_Connector_Config" fileSystem="newfilesystem" path="newpath" resource="directory"/>
	</flow>

</mule>
----
For more information, see the *Path CRUD DEMO*. <link-to-demo>

[[update-path-example]]
== Update a Path

=== Steps to Update a Path

==== Set up the Flow

. Create a new Mule project in Studio.
. In the *Mule Palette* view, search for `http` and select the *Listener* operation:
. Drag the *Listener* operation onto the Studio canvas.
. In the *Listener* configuration, click *+* next to the *Connector configuration* field to add a global element.
. Accept the defaults and click *OK*.
. In the *General* properties tab, set the *Path* field to `/update-path`.

==== Add a File Connector to the Project

. In the *Mule Palette* view, click *Search in Exchange*. 
. Type `file connector` and add it to the project.

==== Using the File Connector to Read a File

. In the Mule Palette, click on *File* and drag the *Read* operation onto the flow.
. In the *Read* configuration, click *+* next to the *Connector Configuration* field to add a connection configuration.
. Click *OK*.
. In *File Path*, fill the value with the absolute path to the file to upload.
. From the *Mule Palette* view, search for `set variable` and drag *Set Variable* next to the *Read* operation on the Studio canvas.
. In the *General* properties tab, enter these values:
* *Name*: `fileSize`
* *Value*: Enter the Mule Expression `&#35;[attributes.size]`. +
This will save the length of the file for the next operations.

[[update-path-append]]
==== Using the Update Path operation for Append

. In the *Mule Palette* view, search for `azure` and select the Azure Data Lake Storage Connector *Update Path* operation.
. Drag the *Update Path* operation from the Studio canvas onto the *Listener* flow, next to the *Set Variable* component.
. In the *Update Path* configuration, click *+* next to the *Connector Configuration* field to add a connection configuration.
. From *Connection*, select the connection authentication method and enter the values for all the required fields.  
. Click *OK*
. In the *General* properties tab, enter the following values:
* *File System* +
Value for your target file system.
. *Path* +
Value for your target path.
. *Action* +
`append`
. *Position* +
`0`
. *Content Length* +
Enter the Mule expression `&#35;[vars.fileSize]`.
. *Content* +
`payload`
. Save the project.

==== Using the Update Path operation for flush:

. In the *Mule Palette* view, search for `azure` and select the Azure Data Lake Storage Connector *Update Path* operation.
. Drag the *Update Path* operation from the Studio canvas onto the *Listener* flow, next to the *Update Path* operation that you created in <<update-path-append,the step for append>>.
. In the *Connector Configuration* drop-down, select your connection configuration.
. In the *General* properties tab, enter the following values:
* *File System* +
Your target file system.
* *Path* +
Your target path.
* *Action* +
`flush`
* *Position* +
Enter the Mule expression `#[vars.fileSize]` 
* *Content Length* +
`0`
. Save the project.
. Test the app by sending a GET request to `localhost:8081/update-path`.

=== XML for Updating a Path

Paste this code into your Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:file="http://www.mulesoft.org/schema/mule/file"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:azure-data-lake-storage="http://www.mulesoft.org/schema/mule/azure-data-lake-storage"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
		http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
		http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
		http://www.mulesoft.org/schema/mule/azure-data-lake-storage http://www.mulesoft.org/schema/mule/azure-data-lake-storage/current/mule-azure-data-lake-storage.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config">
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<azure-data-lake-storage:config name="Azure_Data_Lake_Storage_Connector_Config" doc:name="Azure Data Lake Storage Connector Config">
		<azure-data-lake-storage:shared-access-signature-connection accountName="${account.name}" dnsSuffix="${dns.suffix}" sasToken="${sas.token}" />
	</azure-data-lake-storage:config>
	<file:config name="File_Config" doc:name="File Config"/>
	<flow name="create-path-flow">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config" path="update-path"/>
		<file:read doc:name="Read" config-ref="File_Config" path="${file.path}"/>
		<set-variable value="#[attributes.size]" doc:name="Set Variable" variableName="fileSize"/>
		<azure-data-lake-storage:update-path doc:name="Update Path" config-ref="Azure_Data_Lake_Storage_Connector_Config" fileSystem="${filesystem.name}" path="${path.name}" action="append" position="0" contentLength="#[vars.fileSize]"/>
		<azure-data-lake-storage:update-path doc:name="Update Path" config-ref="Azure_Data_Lake_Storage_Connector_Config" fileSystem="${filesystem.name}" path="${path.name}" action="flush" position="#[vars.fileSize]" contentLength="0"/>
	</flow>

</mule>
----

For more information, see the *Path CRUD DEMO*. <link-to-demo>

[[error-handling-example]]
== Error Handling

This section shows you how to implement a simple error handling on a flow that uses Azure Data Lake Storage Connector.

=== Set up the Error Handling Flow

. In any flow, from  the *Mule Palette* view, select *Core > On Error Continue* and drag it to the *Error Handling* section of the flow.
. From the *Mule Palette* view, drag *Core > Transform Message* to the flow.
. Enter the following values:
+
----
 output application/json
 ---
 error.errorMessage.payload
----
+
. To access to the error code that comes from the Azure service, the expression is: +
`error.muleMessage.typedValue.error.code`
. To access to the error message, the expression is: +
`error.muleMessage.typedValue.error.message`

== See Also

* xref:connectors::introduction/anypoint-connector-authentication.adoc[Anypoint Connector Authentication]
* https://help.mulesoft.com[MuleSoft Help Center]
