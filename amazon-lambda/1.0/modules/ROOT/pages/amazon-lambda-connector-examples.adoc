= Amazon Lambda Connector 1.0 Examples - Mule 4

The following examples shows how to use the Amazon Lambda Connector.

Before you try the example, access Anypoint Studio (Studio) and verify that the *Mule Palette* view displays entries for Lambda. If not, follow the instructions in xref:amazon-lambda-connector-studio.adoc#add-connector-to-project[Add the Connector to Your Project].

== Synchronous Invocation

This example shows a simple lambda function call invoked using an HTTP listener.

image::amazon-lambda-simple-invoke-example.png[Simple invoke example]

Upon requesting the url http://localhost:8081/invoke the Lambda Invoke operation is performed, and the result is directly returned to the user.

The configuration of the Invoke Operation looks like this:

image::amazon-lambda-simple-invoke-example-properties.png[Simple invoke properties]

The function name is supplied from a static configuration file called [environment.properties]

for explanation of the individual fields you can check out the xref:amazon-lambda-connector-reference.adoc[Amazon Lambda Connector Reference]

In short, we're passing the payload from the HTTP Listener directly into the body of the invoke. We told AWS Lambda
that we don't require any logs to be stored regarding this operation and we also said, that this invokation is of type
REQUEST_RESPONSE. This effectively makes this a Synchronous call that will wait until the lambda function has finished processing
and returns its results. Alternatively we could've set the Invocation Type to "EVENT" which would act like an asynchronous call
and return an empty response immediatelly, while lambda performs its action in the background.

The example flow can simply look like this:


[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:amazon-lambda="http://www.mulesoft.org/schema/mule/amazon-lambda" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/amazon-lambda http://www.mulesoft.org/schema/mule/amazon-lambda/current/mule-amazon-lambda.xsd">
	<flow name="amazon-lambda-invoke-example">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config" path="/invoke"/>
		<amazon-lambda:create20150331-functions-invocations-by-function-name doc:name="Invoke" config-ref="Test_Aws_Config" functionName="${config.functionName}" xAmzInvocationType="REQUEST_RESPONSE">
		</amazon-lambda:create20150331-functions-invocations-by-function-name>
	</flow>
</mule>
----

Depending on your lambda function, when you run this flow you might need to send in a request body. For this example you
may create a python3.8 lambda function like this:

[source,python,linenums]
----
def lambda_handler(event, context):
    message = 'Hello {} {}!'.format(event['first_name'], event['last_name'])

	return {'message' : message}
----

Consult the AWS official documentation if you don't know how to create a new lambda function.

This function will simply take the fields "first_name" and "last_name" from our input in JSON format and greet us using our name.

now if we call our endpoint at http://localhost:8081/invoke with a JSON body like this:
----
{
    "first_name":"Tyler",
    "last_name":"Durden"
}
----

our flow should respond with a code 200 message:
----
{
    "message": "Hello Tyler Durden!"
}
----


=== See Also

* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
