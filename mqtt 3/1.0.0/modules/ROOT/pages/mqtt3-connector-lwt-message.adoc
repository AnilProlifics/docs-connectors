= Configure the Last Will And Testament Messages for MQTT 3 Connector

In this example, you set a last will and testament (LWT) message for the Anypoint Connector for MQTT 3 (MQTT 3 Connector) to ensure that if the client disconnects temporarily or permanently from the broker, a message is sent to a specific LWT topic, notifying all its subscribers of the clientâ€™s disconnection. The LWT message is set at the time the connection to the broker is established.

Configure the LWT message in the configuration element and specify whether or not you want the broker to retain that message.
If an MQTT message is set for retention, the broker stores the last message marked as retained that arrived at a specific topic. If no listeners are subscribed to a matching topic at the time the message is sent, the broker stores the message until a listener connects to that topic. Then, the broker delivers the listener to the last message retained for that topic.

. In Studio, navigate to the *Global Elements* tab.
. Click *Create*.
. In the filter box, type `mqtt` and select *MQTT3 Config*.
. Click *OK*.
. In the *MQTT3 Config* window, for *Connection*, select *MQTT3 Form Connection*.
. For *Client id generator*, select *Client id random suffix generator*.
. Set the following fields:
+
* *Client ID*: `smart-bentley-123`
* *Username*: `usertest`
* *Password*: `passtest`
* *URL*: `tcp://127.0.0.1:1883`
[start=8]
. Click *LWT* tab.
. Set the following fields:
+
* *Topic*: `LWT`
* *Body*: `Testing body message`
* *Is retained*: *True*.
[start=10]
. Click *OK*.

image::mqtt3-lwt-configuration.png[MQTT3 Config window with Last Will and Testament configuration window selected]

In the Configuration XML editor, the `<mqtt3:last-will-and-testament>` configuration looks like this:

[source,xml,linenums]
----
<mqtt3:config name="MQTT_LWT_Config">
    <mqtt3:connection username="usertest" password="passtest" url="tcp://127.0.0.1:1883" >
        <mqtt3:client-id-generator>
            <mqtt3:client-id-random-suffix-generator clientId="smart-bentley-123" />
        </mqtt3:client-id-generator>
        <mqtt3:last-will-and-testament topic="LWT" body="Testing body message" isRetained="true"/>
    </mqtt3:connection>
</mqtt3:config>
----

== See Also

* xref:mqtt3-connector-examples.adoc[MQTT 3 Connector Examples]
* https://help.mulesoft.com[MuleSoft Help Center]
