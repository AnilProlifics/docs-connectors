= AS2 Connector - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

Support Category: Premium

Version 5.0.0

The Mule Runtime supports the AS2 protocol through the AS2 Connector. The AS2 connector enables trading partners transmit and receive AS2 messages with EDI-X12, EDIFACT, XML or binary payloads.
This connector leverages the AS2 protocol, allowing Mule applications to:
* Send messages, signed or unsigned, over HTTP or HTTPS, following the AS2 protocol.
* Receive messages, also over HTTP or HTTPS, following the AS2 protocol.
* Receive Asynchronous MDN for the message sent.


== About Connectors

Anypoint connectors are Mule runtime engine extensions that enable you to connect to APIs and resources on external systems, such as X12 and RosettaNet.

== Prerequisites

Familiarity with AS2, Mule, Anypoint Connectors, and Anypoint Studio.

== Add a POM File Dependency
The \`pom.xml\` Maven file generated by Anypoint Studio contains dependencies for
a Mule app. When you code a Mule app manually, include this XML snippet in
your \`pom.xml\` file to enable access to the connector. The Mule runtime engine
translates the \`RELEASE\` dependency keyword to the current version.
[source,xml,linenums]
----
<dependency>
   <groupId>com.mulesoft.connectors</groupId>
   <artifactId>mule-as2-connector</artifactId>
   <version>5.0.0</version>
   <classifier>mule-plugin</classifier>
</dependency>
----
To obtain the most up-to-date \`pom.xml\` file information, access the
connector in https://www.mulesoft.com/exchange/[Anypoint Exchange]
and click *Dependency Snippets*.

== Add a Namespace for the Connector

Paste the following code inside the \`mule\` tag of the header
of your configuration XML:
[source,xml,linenums]
----
http://www.mulesoft.org/schema/mule/as2-mule4
http://www.mulesoft.org/schema/mule/as2/current/mule-as2-mule4.xsd
----

[source,xml,linenums]
<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
xmlns:as2="http://www.mulesoft.org/schema/mule/as2-mule4"
xmlns="http://www.mulesoft.org/schema/mule/core"
xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	    xsi:schemaLocation="http://www.springframework.org/schema/beans
	    http://www.springframework.org/schema/beans/spring-beans-current.xsd
        http://www.mulesoft.org/schema/mule/core
	http://www.mulesoft.org/schema/mule/core/current/mule.xsd
        http://www.mulesoft.org/schema/mule/as2-mule4
	http://www.mulesoft.org/schema/mule/as2/current/mule-as2-mule4.xsd">
      <!-- put your global configuration elements and flows here -->

</mule>

Note: Use current in the schema path. Studio interprets this to the current Mule version.


== Operations

. Send with sync MDN: Sends a message through HTTP or HTTPS using the AS2 protocol requesting the partner for a synchronous MDN/receipt.
. Send with async MDN: Sends a message through HTTP or HTTPS using the AS2 protocol requesting the partner for an asynchronous MDN/receipt.
. Listener: Source that receives messages via HTTP or HTTPS using the AS2 protocol.
. MDN Listener: Source that receives asynchronous MDN receipts via HTTP or HTTPS using the AS2 protocol.

== Example: Configure a Send AS2 Message

. Place the connector in your flow as applicable for your use case.
. To send an AS2 message with request for MDN in your Mule application, create a global “AS2 Connector Send config” element for use by the AS2 send operations. The “AS2 Connector Send config”  provides the following global configuration parameters:

[%header%autowidth.spread]
|===
|Key| Description
|Self config - AS2 Partner Name| Sender’s AS2 system identifier. Used for AS2-From and AS2-To headers.
|Self config - x509 alias| Sender’s Certificate and/or private key alias in the keystore. Required if using signing or encryption.
|Self config - Email| Sender partner’s email.
|Partner config - AS2 ID| Receiver’s AS2 system identifier. Used for AS2-From and AS2-To headers.
|Partner config - x509 alias| Receiver’s Certificate and/or private key alias in the keystore. Required if using signing or encryption.
|Partner config - Email| Receiver partner’s email.
|Requester config - Subject| Free form text for MIME Subject header. Can include references to self / partner `simpleName` values along with the message `fileName`, for example, Sending file example.txt to partner via AS2.
|Requester config - MDN MIC Signature Algorithm| The algorithm with which MIC is calculated for the MDN/receipt signature. `UNSIGNED` by default, that is, message is not signed.
|Requester config - Request a receipt| Option to request a receipt from the partner. `SIGNED_OPTIONAL` by default.
|Requester config - Request delivery URL| Asynchronous receipt delivery URL.
|Requester config - Encryption Algorithm| The encryption algorithm for encrypting the message. `UNENCRYPTED` by default.
|Requester config - MIC Signature Algorithm| The algorithm with which MIC is calculated for the message signature. `UNSIGNED` by default, that is, message is not signed.
|Requester config - Content transfer encoding| The content transfer encoding. `BINARY` by default.
|Requester config - Compression type| The compression type. ZLIB is the only supported compression/decompression. `NONE` by default.
|Keystore config - Keystore Path| The path of the keystore where certificates and keys are provided.
|Keystore config - Keystore Password| The password for the keystore.
|Keystore config - Private key Password| If private key requires a password.
|===

. Configure a connection to the partner AS2 endpoint by providing the `Partner Base URL`.
. If you want to configure other connection details such as TLS, proxy, timeouts you can do that now.
. Choose to send the file/message by either using `Send with sync mdn` or `Send with async mdn`:
** The payload is the message content to be sent.
** Filename is the file name of the message being sent.
** Boolean to configure if the process should fail or if the receipt status is not processed.

NOTE: If you choose to request an asynchronous receipt, you need to configure `MDN Listener`.

=== Configure a MDN Listener

Place the connector’s `MDN Listener` as a source in your flow as applicable for your use case and reference the global config defined here.

[%header%autowidth.spread]
|===
|Key| Description
|Self config - AS2 OID| Sender partner’s OID.
|Self config - x509 alias| Sender’s Certificate and/or private key alias in the keystore.
|Self config - Email| Sender partner’s email.
|Partner config - AS2 ID| Receiver partner’s OID.
|Partner config - x509 alias| Receiver’s Certificate and/or private key alias in the keystore.
|Partner config - Email| Receiver partner’s email.
|HTTP Listener config| Reference to HTTP Listener global config.
|Keystore config - Keystore Path| The path of the keystore where certificates and keys are provided.
|Keystore config - Keystore Password| The password for the keystore.
|Keystore config - Private key Password| If the private key requires a password.
|===

=== Configure an AS2 Listener for receiving a message

. Place the connector’s `AS2 Listener` as a source in your flow as applicable for your use case and reference the global config as defined here.

[%header%autowidth.spread]
|===
|Key| Description
|Self config - AS2 OID| Receiver partner’s OID.
|Self config - x509 alias| Receiver alias as defined in the keystore file.
|Self config - Email| Receiver partner’s email.
|Partner config - AS2 ID| Sender partner’s OID.
|Partner config - x509 alias| Sender alias as defined in the keystore.
|Partner config - Email| Sender partner’s email.
|HTTP Listener config| Reference to HTTP Listener global config.
|Keystore config - Keystore Path| The path of the keystore where certificates and keys are provided.
|Keystore config - Keystore Password| The password for the keystore.
|Keystore config - Private key Password| If the private key requires a password.
|===

. Configure a connection to the partner if the MDN request is to be sent asynchronously.
. If you want to configure other connection details such as TLS, proxy, timeouts do that now.

== Runtime Configuration

The AS2 Connector reads data using repeatable streams. Data is read into memory until a configurable threshold is reached, at which point the data will be written to disk.
The default threshold for writing to disk is 64KB. This can be changed through the System property `com.mulesoft.connectors.as2.CachedOutputStream.Threshold`. This property requires an Integer value:
** A positive value defines the maximum amount of data to read into memory in KB.
** A zero value means that all data is written directly to disk.
** A value of -1 means that the data is never written to disk, and will be stored into memory.

By default, the data is written to temporary files in the directory set by `java.io.tmpdir`.
To change the directory, set the System property: `com.mulesoft.connectors.as2.CachedOutputStream.OutputDirectory`

== Migrating from the AS2 connector Version 4.x

The AS2 version 5 connector requires the `Async MDN` to be handled as a separate flow unlike v4.x . As you can see in “Example flow for Async MDN”, the AsyncMDN flow starts with an `MDN Listener` as a source.
In version 5.0.0, the retry of AS2 Message Send is not automatic. The application has to handle the retry upon failure in MDN or failure to receive MDN.

Version 5 allows you to reuse the application HTTP listener configuration.




== Configure the Connector Global Element

Place the connector in your flow as applicable for your use case.

To use the AS2 connector in your Mule application, create a global AS2 element for use by the AS2 connector. The AS2 connector provides the following global configuration parameters:

[%header%autowidth.spread]
|===
|Key| Description
|Partner From - Name| Sender partner's name.
|Partner From - AS2 id| Sender partner's ID.
|Partner From - x509 alias| Sender alias as defined in the certificate file.
|Partner From - Email| Sender partner's email.
|Partner To - Name| Receiver partner's name.
|Partner To - AS2 id| Receiver partner's ID.
|Partner To - x509 alias| Receiver alias as defined in the certificate.
|Partner To - Email| Receiver partner's email.
|Partnership - Sender| The sender's name.
|Partnership - Receiver| The receiver's name.
|Partnership - Subject| The text used in email subject line.
|Partnership - AS2 URL| The partners AS2 server's URL.
|Partnership - AS2 Receipt Option| The URL that the partner sends the MDN.
|Partnership - Encrypt| The encryption algorithm for email header.
|Partnership - Sign|The sign encryption of the message. None by default (message is not signed).
|Partnership - Content transfer encoding|The content transfer encoding. *Binary* by default.
|Partnership - Compression type|The compression type. ZLIB is the only supported compression/decompression. Disabled by default.
|Partnership - Remove CMS algorithm protection attrib|Disable the OID from being sent.
|AS2 Keystore - Keystore Path|The path of the keystore.
|AS2 Keystore - Keystore Password|The password of the keystore.
|Receive Module Ports - Receiver Port|The port used by the receive source.
|Receive Module Ports - Secure Receiver Port|The secure port (SSL) used by the receive source.
|Receive Module Ports - Secure Receiver Keystore Path|The path of the keystore with the SSL certificate for the receiver source.
|Receive Module Ports - Secure Receiver Keystore Password|The password of the keystore.
|MDN Receiver Module Ports - Receiver Port|The port for the MDN receiver.
|MDN Receiver Module Ports - Secure Receiver Port|The secure port (SSL) for the MDN receiver.
|MDN Receiver Module Ports - Secure Receiver Keystore Path|The path of the keystore with the SSL certificate for the MDN receiver.
|MDN Receiver Module Ports - Secure Receiver Keystore Password|The password of the keystore.
|===






== See Also

* Access the xref:release-notes::connector/as2-connector-release-notes.adoc[AS2 Connector Release Notes]
* See https://forums.mulesoft.com/search.html?q=AS2+connector[MuleSoft Forum for this connector]
