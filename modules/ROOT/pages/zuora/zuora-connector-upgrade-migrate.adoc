= Zuora - Upgrade and Migrate - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../../assets/images/

Upgrade Anypoint Connector for Zuora (Zuora Connector) to version 5.0.  

== Supported Upgrade Paths

[%header,cols="50a,50a"]
|===
|From Version | To Version
|4.2.x |5.0.0
|===

== Changes in This Release

== Changes in Operations Parameters

[cols="5%,17%,15%,15%,17%,15%,15%"]
|===
4+|Existing in Zuora 4.x 3+| Modified in Zuora 5.x
|Nr |Operation Name	| Input Params	|Output Params	| Opration Name	                         |Input Params	                                    |Output Params

|1| Get Account Crud
|
Fields (String)

Id (String)

| N/A
| CRUD: Get account
|
id (String) (Modified)

fields (String) (Modified)

| Attributes Type (HttpResponseAttributes) (New)

|2| Get Payment Crud
| Id (String)
| N/A
| CRUD: Get payment
| id (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)

|3| Get Payment Method Crud
|
Fields (String)

Id (String)

| N/A
| CRUD: Get payment method
|
id (String) (Modified)

fields (String)

| Attributes Type (HttpResponseAttributes) (New)

|4| Get Payment Method Snapshot Crud
|
Fields (String)

Id (String)

| N/A
| CRUD: Get payment method snapshot
|
id (String) (Modified)

fields (String) (Modified)

| Attributes Type (HttpResponseAttributes) (New)

|5| Get Payment Transaction Log Crud
| Id (String)
| N/A
| CRUD: Get payment transaction log
| id (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)

|6| Get Refund Crud
|
Fields (String)

Id (String)

| N/A
| CRUD: Get refund
|
id (String) (Modified)

fields (String) (Modified)

| Attributes Type (HttpResponseAttributes) (New)

|7| Get A Notification Definition
| Id (String)
| N/A
| Get a notification definition
| id (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)

|8| Get Account
| Account Key (String)
| N/A
| Get account
| Account key (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)

|9| Get Account Summary
| Account Key (String)
| N/A
| Get account summary
| Account key (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)

|10| Get Accounting Period
| Account Id (String)
| N/A
| Get accounting period
| Ap id (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)

| 11	|
Create Account|
Create Accounting Request Data(Any) |N/A|Create account|

Create Accounting Request Data (Any) (Removed);

Content(Binary); | Type (HttpResponseAttributes) (New)

|12	|
Create accounting period|
Create Accounting Period Request Data (Any)
|N/A
|No changes
|
Create Accounting Period Request Data (Any) (Removed);

Content(Binary); | Type (HttpResponseAttributes) (New)


| 13	|Create Account Crud|
Create Account Crud Request Data (Any)
|N/A
|CRUD: Create account|
Create Accounting Period Request Data (Any) (Removed);

Content(Binary); | Type (HttpResponseAttributes) (New)


| 14	|Create Accounting Code|
Create Accounting Code Request Data (Any)
|N/A| No changes
|
Create Accounting Code Request Data (Any) (Removed);

Content(Binary); | Type (HttpResponseAttributes) (New)


|15| Create An Email Template	|
Create An Email Template Request Data (Any)
|	N/A	|
No changes	|
Create An Email Template Request Data (Any) (Removed);

Content(Binary); | Type (HttpResponseAttributes) (New)

|16| Update Credit Balance Adjustment Crud
|
Update Credit Balance Adjustment Crud Request Data (Any);

Id (String)
| N/A
| CRUD: Update CreditBalanceAdjustment
|
Update Credit Balance Adjustment Crud Request Data (Any) (Removed);

Content (Binary) (New);

id (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)


|17| Update Invoice Adjustment Crud
|
Update Invoice Adjustment Crud Request Data (Any)

Id (String)
| N/A
| CRUD:	Update InvoiceAdjustment
|
Update Invoice Adjustment Crud Request Data (Any) (Removed);

Content (Binary) (New);

id (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)

|18| Update Invoice Payment Crud
|
Update Invoice Payment Crud Request Data (Any);

Id (String)
| N/A
| CRUD:	Update InvoicePayment
|
Update Invoice Payment Crud Request Data (Any);

Content (Binary) (New);

id (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)

|19| Update Product Crud
|
Update Product Crud Request Data (Any);

Id (String)
| N/A
| CRUD:	Update Product
|
Update Product Crud Request Data (Any) (Removed);

Content (Binary) (New);

id (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)

|20| Update Product Rate Plan Crud
|
Update Product Rate Plan Crud Request Data (Any);

Id (String)
| N/A
| CRUD:	Update ProductRatePlan
|
Update Product Rate Plan Crud Request Data (Any) (Removed);

Content (Binary) (New);

id (String) (Modified)
| Attributes Type (HttpResponseAttributes) (New)

|===

== Changes in Operations Metadata

[cols="5%,17%,15%,15%,17%,15%,15%"]
|===
4+|Metadata Existing in Zuora 4.x 3+| Metadata in Zuora 5.x
|Nr |Operation Name	| Input Metadata	|Output Metadata	| Operation Name	                         |Input Metadata	                                    |Output Metadata

|1| Submit data query
| N/A
| N/A
| POST Data Query Job
|
useIndexJoin (Boolean) (New);

columnSeparator (String) (New)

| N/A

|2| Create account
|
endingUnit (String);

    price (String);

    startingUnit (String);

    includedUnits (String);

    discountAmmount (String);

    discountPercentage (String);

    overagePrice (String);

    unusedUnitsCreditRates (String);

    quantity (String);

    priceIncreasePercentage (string);
| N/A
| Create account
|
    endingUnit (Number) (Modified);

    price (Number) (Modified);

    startingUnit (Number) (Modified);

    includedUnits (Number) (Modified);

    discountAmmount (Number) (Modified);

    discountPercentage (Number) (Modified);

    overagePrice (Number) (Modified);

    unusedUnitsCreditRates (Number) (Modified);

    quantity (Number) (Modified);

    priceIncreasePercentage (Number) (Modified);

| N/A

|3| Amend
| N/A
| N/A
| Amend
|
ResumeDate (date) (New);

SuspendDate (Date) (New)

| N/A

|===

== New Operations in Zuora Connector 5.0.0

[cols="5%,25%,70%"]
|===
3+|New in Zuora 5.x
| Nr | Name	| Description

|1| Create custom object definition	| Post custom object definition with the given type
|2| Create custom object records | Create custom object records with the given type
|3| Create usage records | Create usage records
|4| DELETE Data Query Job | Cancels a [data query](https://knowledgecenter.zuora.com/DC_Developers/BA_Data_Query) job, which prevents Zuora from performing the query
|5| Delete a workflow by ID | Deletes a specific workflow by its ID
|6| Export a workflow | Export a Workflow in a JSON document
|7| Get a workflow by ID | Retrieves information about a specific workflow by its ID
|8| Get workflows | Retrieves a list of workflows available in your Zuora tenant
|9| Import a workflow | Creates a copy of a workflow using the exported JSON document of the original workflow
|10| Run a workflow | Run a specified workflow
|11|Delete schema of Usage custom field definition | Delete schema of Usage custom field definition
|12|Delete usage record | Delete usage record
|13|Download usage file template | Download usage file template
|14|Download usage import failure file | Download usage import failure file
|15|Download usage import file | Download usage import file
|16|Get Usage custom field definition | Get Usage custom field definition
|17|Get details of usage import | Get details of usage import
|18|Get rated usage by account | Get rated usage by account
|19|Get rated usage by charge | Get rated usage by charge
|20|Get rated usage by subscription | Get rated usage by subscription
|===

== AQuA API Changes
Four operations were removed from the connector and were added separately in the new Anypoint Connector for AQuA (AQuA Connector).

[cols="15%,35%,15%,35%"]
|===
2+|Removed in Zuora 5.x 2+| Available in Zuora AQuA 1.x as
|Name	| Description	|Name	|Description

| Aqua_  Delete A Running Job	| Delete the current job, if it is not complete, else an error is thrown. |	Delete a Running Job	|No changes
| Aqua_  Get Job Results | Retrieves an aggregate query using the Job ID. | Get Job Results | No changes
| Aqua_  Get Last Job Completed | Returns the details of the last completed job. | Get Last Job Completed | No changes
| Aqua_  Post Query Or Export Deleted Data | Post query. | Post Query or Export Deleted Data | No changes
|===

== Limitations

AQuA operations are removed from Zuora Connector. To use AQuA operations, install Zuora AQuA Connector.  

After you upgrade to Zuora Connector 5.0.0, the following operations are no longer available in Zuora Connector and must be replaced with the corresponding Zuora AQuA Connector operations.

=== CRUD Operations

All of the CRUD operations were changed so that CRUD is prepended to operation names. A few examples are: 

|===
|4.2.x|5.0.0

|Create import crud operation
|CRUD: Create Import operation

|Delete bill run crud
|CRUD: Delete bill run

|Get account crud
|CRUD: Get account

|Update product crud
|CRUD: Update Product
|===

=== Changes to Operations Names

Some of the operations' names are updated:

|===
|4.2.x|5.0.0

|Create revenue schedule for invoice item adjustment distribute by date range
|Create revenue schedule for invoice item adjustment (distribute by date range)

|Remove an event trigger
|DELETE Event Trigger

|Delete usage crud
|Delete usage record
|===

=== Changes in Fields and Values

Some fields and their corresponding values have changed: 

* The credit memo items operation and the taxation items created in the `write-off` operation are now applied to the corresponding invoice items and invoice taxation items, respectively.
* The values of the following fields are also changed to the taxation items of credit memo items operation:
  ** taxRate +
  The value of this field is now set to `0`.
  ** exemptAmount +
  The value of this field is now set to `0`.
  ** taxRateType + 
  The value of this field is now set to `null`.

== Upgrade Prerequisites

Before you perform the upgrade, you must:

. Create a backup of your files, data, and configuration in case you need to restore to the previous version. 
. Install Zuora AQuA Connector to replace the AQuA operations that were previously included in Zuora Connector 4.2.x:
.. In Studio, create a Mule project.
.. In the Mule Palette view, click *Search in Exchange*.
.. In Add Modules to Project, type 'Zuora AQuA' in the search field.
.. In Available modules, select *Zuora AQuA Connector*, and then click *Add*.
.. Click *Finish*.	
.. Verify that the `zuora-aqua-connector` dependency version is `1.0.0` in the pom.xml. +
Anypoint Studio upgrades the connector automatically.

== Upgrade Steps

Follow these steps to perform the upgrade to Zuora Connector 5.0.0:

.. In Studio, create a Mule project.
.. In the Mule Palette view, click *Search in Exchange*.
.. In Add Modules to Project, type 'Zuora AQuA' in the search field.
.. In Available modules, select *Zuora AQuA Connector*, and then click *Add*.
.. Click *Finish*.
.. Verify that the `zuora-connector` dependency version is `5.0.0` in the pom.xml. 

Anypoint Studio upgrades the connector automatically. 


== Verify the Upgrade

After you install the latest version of the connector, follow these steps to verify the upgrade:

. In Anypoint Studio, verify that there are no errors in the *Problems* or *Console* views.
. Check the project pom.xml and verify that there are no problems.
. Test the connection and verify that the operations work.  

== Troubleshooting

If there are problems with caching the parameters and caching the metadata, try restarting Anypoint Studio.  

== Reverting the Upgrade

If it is necessary to revert to the previous version of Zuora Connector, change the `zuora-connector` dependency version `5.0.0` in the project's pom.xml to the previous version.  

You must update the project's pom.xml in Anypoint Studio. 


== See Also

https://help.mulesoft.com[MuleSoft Help Center]
