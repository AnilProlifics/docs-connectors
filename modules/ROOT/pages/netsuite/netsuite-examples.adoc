= NetSuite Connector Examples - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../../assets/images/

NetSuite Connector Version 9.2

xxx

== Account Basic Search Filtering by an Integer Field

This example shows how to use the Search operation to obtain the Account Basic items with internal IDs that are less than the value of the `query` parameter.

//Is "Account Basic" the right term or should it be "basic account"?

For this example to work, there must be at least one basic account that meets the search condition in the NetSuite instance.

. In Studio, click *HTTP* and drag the *Listener* operation to the canvas.
. Change the name of  the *Listener* to `/account`.
. In the Listener properties window, click *+* next to the Connector configuration field to add a global element.
. Accept the defaults.
. In the Listener properties window, set the *Path* field to `/account`.
. From the *Mule Palette* view, select *NetSuite* and drag the *Search* operation to the right of *Listener*.
. Change the display name of the *Search* operation to `Search Account`.
. Select an existing global element or create a new one for the *Search* operation.
. On the properties window:
**  In the *Key* field, select `ACCOUNT_BASIC`.
**  Set the *Page Size* field to an integer value between `10` and `1000`.
. From the *Mule Palette* view, drag a *Transform Message* component to the left of *Search*.
. Change the name of the *Transform Message* component to `Search Criteria`.
. Click the *Output* column to display the metadata of the *AccountSearchBasic* object.
. Under the *internalid* object in the metadata:
** Double-click the *operator* field and set its value to `"LESS_THAN"`.
** Double-click the *searchValue* field and set its value to `attributes.queryParams["internalId"]`.
+
Setting the *searchValue* field to  `attributes.queryParams["internalId"]` directs the connector to use the value of the `internalId` query parameter as the search criteria.

The DataWeave code should look like this:

[source,dataweave,linenums]
----
%dw 2.0
output application/java
---
{
	internalIdNumber: {
		operator: "LESS_THAN",
		searchValue: attributes.queryParams["internalId"]
	}
} as Object {
	class : "org.mule.module.netsuite.extension.api.AccountSearchBasic"
}
----
+
. From the *Mule Palette* view, drag a *Transform Message* component to the right of *Search*.
. Change the name of the *Transform Message* component to `Response to JSON`.
. Click *Transform Message* and set the output to `application/json`.
+
[source,dataweave,linenums]
----
%dw 2.0
output application/json
---
payload
----
+
. Start the Mule app.
. Call \`http://localhost:8081/account?internalId=5`

=== Account Basic Search Flow in Studio

The following screenshot shows the Studio app flow for the account basic search example:

image::netsuite/netsuite-examples-search-account.png[Account Basic search flow in Studio]

=== XML for Account Basic Search Flow

The following code shows the XML for the account basic search:

[source]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:netsuite="http://www.mulesoft.org/schema/mule/netsuite"
	xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/netsuite http://www.mulesoft.org/schema/mule/netsuite/current/mule-netsuite.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">

    <http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config">
        <http:listener-connection host="0.0.0.0" port="8081"/>
    </http:listener-config>

    <netsuite:config name="NetSuite_Config" doc:name="NetSuite Config">
        <netsuite:login-authentication-connection
    		email="${email}" password="${password}" account="${account}"
    		roleId="${roleId}" applicationId="${applicationId}" />
    </netsuite:config>

    <flow name="netsuite-search-account">
	    <http:listener doc:name="/account" config-ref="HTTP_Listener_config" path="/account"/>
	    <ee:transform doc:name="Search Criteria">
		    <ee:message >
			    <ee:set-payload ><![CDATA[%dw 2.0
output application/java
---
{
	internalIdNumber: {
		operator: "LESS_THAN",
		searchValue: attributes.queryParams["internalId"]
	}
} as Object {
	class : "org.mule.module.netsuite.extension.api.AccountSearchBasic"
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<netsuite:search key="ACCOUNT_BASIC" doc:name="Search Account" config-ref="NetSuite_Config" pageSize="10"/>
		<ee:transform doc:name="Response to Json">
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</flow>
</mule>
----

== Employee Basic Search Filtering by Boolean and String Fields

This example shows how to use the `Search` operation to obtain the inactive Employee Basic items that have last names beginning with `A`.

For this example to work, there must be at least one employee in the NetSuite instance that meets the search conditions.

. In Studio, click *HTTP* and drag the *Listener* operation to the canvas.
. Change the name of the *Listener* to `/employee`.
. Create the HTTP Listener global element and keep the defaults.
. In the Listener properties window, set the *Path* field value to `/employee`.
. From the *Mule Palette* view, select *NetSuite* and drag the *Search* operation to the right of *HTTP Listener*.
. Select an existing global element or create a new one for the *Search* operation.
. On the Search operation properties window:
**  In the *Key* field, select `Employee_BASIC`.
**  Set the *Page Size* field to an integer value between `10` and `1000`.
. From the  view, drag the *Transform Message* component to the left of *Search*.
. Click the *Output* column to display the metadata of the *EmployeeSearchBasic* object.
. Under the *isInactive* object:
** Double-click the *searchValue* field and set its value to `attributes.queryParams["isInactive"]`.
+
Setting the *searchValue* field  to `attributes.queryParams["isInactive"]` directs the connector to search for inactive employee accounts.
+
** Double-click the *operator* field and set its value to `STARTS_WITH`.
** Double-click on the *searchValue* field and set its value to `attributes.queryParams["lastName"]`.
+
The DataWeave code should look like this:
+
[source,dataweave,linenums]
----
%dw 2.0
output application/java
---
{
	isInactive: {
		searchValue: attributes.queryParams["isInactive"]
	},
	lastName: {
		operator: "STARTS_WITH",
		searchValue: attributes.queryParams["lastName"]
	}
} as Object {
	class : "org.mule.module.netsuite.extension.api.EmployeeSearchBasic"
}
----
+
. From the *Mule Palette* view, drag a *Transform Message* to the right of *Search*.
. Click *Transform Message* and set the output to `application/json`:
+
[source,dataweave,linenums]
----
%dw 2.0
output application/json
---
payload
----
+
. Start the mule app.
. Call /`http://localhost:8081/employee?isInactive=false&lastName=A`

=== Employee Basic Search Flow in Studio

The following screenshot shows the Studio app flow for the employee basic search example:

image::netsuite/netsuite-examples-search-employee.png[Employee search flow in Studio]

=== XML for Employee Basic Search Flow

The following code shows the XML for the employee basic search:

[source]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:netsuite="http://www.mulesoft.org/schema/mule/netsuite"
	xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/netsuite http://www.mulesoft.org/schema/mule/netsuite/current/mule-netsuite.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">

    <http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config">
        <http:listener-connection host="0.0.0.0" port="8081"/>
    </http:listener-config>

    <netsuite:config name="NetSuite_Config" doc:name="NetSuite Config">
        <netsuite:login-authentication-connection
    		email="${email}" password="${password}" account="${account}"
    		roleId="${roleId}" applicationId="${applicationId}" />
    </netsuite:config>

    <flow name="netsuite-search-employee">
    		<http:listener doc:name="/employee" config-ref="HTTP_Listener_config"
    			path="/employee" />
    		<ee:transform doc:name="Search Criteria">
    			<ee:message >
    				<ee:set-payload ><![CDATA[%dw 2.0
    output application/java
    ---
    {
    	isInactive: {
    		searchValue: attributes.queryParams["isInactive"]
    	},
    	lastName: {
    		operator: "STARTS_WITH",
    		searchValue: attributes.queryParams["lastName"]
    	}
    } as Object {
    	class : "org.mule.module.netsuite.extension.api.EmployeeSearchBasic"
    }]]></ee:set-payload>
    			</ee:message>
    		</ee:transform>
    		<netsuite:search doc:name="Search Employee"config-ref="NetSuite_Config" key="EMPLOYEE_BASIC" pageSize="10" />
    		<ee:transform doc:name="Response to Json">
    			<ee:message >
    				<ee:set-payload ><![CDATA[%dw 2.0
    output application/json
    ---
    payload]]></ee:set-payload>
    			</ee:message>
    		</ee:transform>
    	</flow>
</mule>
----

== Performing Customer Advanced Search Filtering by the Date and Array fields

This example shows how to use the `Search` operation to obtain the Customer items that were created after 2015 and that are in the "LEAD" stage. Each item is iterated to log in??? The example filters out unnecessary fields.

For this example to work, there must be at least one customer that meets the search conditions in the NetSuite instance.

. In Studio, click *HTTP* and drag the *Listener* operation to the canvas.
. Change the name of the *Listener* to `/customer`.
. Select an existing global element or create a new one for the *Listener* operation.
. On the Listener properties window, set the *path* field to `/customer`.
. From the *Mule Palette* view, select *NetSuite* and drag the *Search* operation to the right of *Listener*.
. Change the display name of the *Search* operation to `Search Customer Advanced`.
. Select an existing global element or create a new one for the *Search* operation.
. On the properties window:
** In the *Key* field, select `CUSTOMER_ADVANCED`.
** Set the *Page Size* field to an integer value between `10` and `1000`.
. From the *Mule Palette* view, drag the *Transform Message* component to the left of *Search*.
. Change the name of the *Transform Message* component to `Search Criteria`.
. Click the *Output* column to display the metadata of the *CustomerSearchAdvanced* object.
. To configure the fields in the search results:
.. Within *CustomerSearchAdvanced*, expand *columns* -> *basic* -> *dateCreated*.
.. Double-click on the *customLabel* field and set its value to `"Created"`.
.. Scroll down and expand *entityId*.
.. Double-click the *customLabel* field and set its value to `EntityId`.
.. Scroll down and expand *stage*.
.. Double-click the *customLabel* field and set its value to `Stage`.
. To configure the search criteria:
.. Within *CustomerSearchAdvanced*, expand *criteria* -> *basic* -> *dateCreated*.
.. Double-click on the *operator* field and set its value to `"AFTER"`.
.. Double-click the *searchValue* field and set its value to`attributes.queryParams["dateCreated"] as LocalDateTime {format: "yyyy-MM-dd HH:mm:ss.SSS"}`.
+
This setting converts the value of the `dateCreated` query parameter to `LocalDateTime`.
+
.. Scroll down and expand *stage*.
.. Double click on the *operator* field and set its value in `"ANY_OF"`.
.. Double-click on the *searchValue* field and set its value to `[attributes.queryParams["stage"]]`.
+
This setting converts value from the `stage` query parameter to an array item.
.The DataWeave code should look like this:
+
[source,dataweave,linenums]
----
%dw 2.0
output application/java
---
{
	columns: {
		basic: {
			dateCreated: [{
				customLabel: "Created"
			}],
			entityId: [{
				customLabel: "Entity Id"
			}],
			stage: [{
				customLabel: "Stage"
			}]
		}
	},
	criteria: {
		basic: {
			dateCreated: {
				operator: "AFTER",
				searchValue: attributes.queryParams["dateCreated"] as LocalDateTime {format: "yyyy-MM-dd HH:mm:ss.SSS"}
			},
			stage: {
				operator: "ANY_OF",
				searchValue: [attributes.queryParams["stage"]]
			}
		}
	}
} as Object {
	class : "org.mule.module.netsuite.extension.api.CustomerSearchAdvanced"
}
----
+
. The following steps process each item on the list returned by the Search operation individually, to display them on the console.
.. From the *Mule Palette* view, drag a *For Each* component to the right of *Search*.
.. Drag a *Transform Message* component inside the For Each* box and replace the DataWeave code in the Transform Message *Output* column with this code:
+
[source,dataweave,linenums]
----
%dw 2.0
output application/json
---
{
	entityId: payload.entityId,
	dateCreated: payload.dateCreated,
	stage: payload.stage
}
----
.. Drag a *Logger* component from the *Mule Palette* view to the right of *Transform*, inside the *For Each* box.
.. On the Logger properties window, set the *Message* field to `#[payload]`.
. From the *Mule Palette* view, drag another *Transform Message* component to the end of the flow, outside the *For Each* box.
. Click *Transform Message* and set the output to `application/json`:
+
[source,dataweave,linenums]
----
%dw 2.0
output application/json
---
payload
----
+
. Start the Mule app and make a call to \`http://localhost:8081/customer?dateCreated=2015-02-02%2000:00:00.000&stage=LEAD`

=== Customer Advanced Search Flow in Studio

image::netsuite/netsuite-examples-search-customer.png[Customer search flow in Studio]


=== XML for the Customer Advanced Search Flow

[source]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:netsuite="http://www.mulesoft.org/schema/mule/netsuite"
	xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/netsuite http://www.mulesoft.org/schema/mule/netsuite/current/mule-netsuite.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">

    <http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config">
        <http:listener-connection host="0.0.0.0" port="8081"/>
    </http:listener-config>

    <netsuite:config name="NetSuite_Config" doc:name="NetSuite Config">
        <netsuite:login-authentication-connection
    		email="${email}" password="${password}" account="${account}"
    		roleId="${roleId}" applicationId="${applicationId}" />
    </netsuite:config>

    <flow name="netsuite-search-customer-advanced">
    		<http:listener doc:name="/customer" config-ref="HTTP_Listener_config" path="/customer"/>
    		<ee:transform doc:name="Search Criteria">
    			<ee:message>
    				<ee:set-payload><![CDATA[%dw 2.0
    output application/java
    ---
    {
    	columns: {
    		basic: {
    			dateCreated: [{
    				customLabel: "Created"
    			}],
    			entityId: [{
    				customLabel: "Entity Id"
    			}],
    			stage: [{
    				customLabel: "Stage"
    			}]
    		}
    	},
    	criteria: {
    		basic: {
    			dateCreated: {
    				operator: "AFTER",
    				searchValue: attributes.queryParams["dateCreated"] as LocalDateTime {format: "yyyy-MM-dd HH:mm:ss.SSS"}
    			},
    			stage: {
    				operator: "ANY_OF",
    				searchValue: [attributes.queryParams["stage"]]
    			}
    		}
    	}
    } as Object {
    	class : "org.mule.module.netsuite.extension.api.CustomerSearchAdvanced"
    }]]></ee:set-payload>
    			</ee:message>
    		</ee:transform>
    		<netsuite:search key="CUSTOMER_ADVANCED" doc:name="Search Customer Advanced" config-ref="NetSuite_Config" pageSize="10"/>
    		<foreach doc:name="For Each">
    			<ee:transform doc:name="Transform Customer">
    				<ee:message >
    					<ee:set-payload ><![CDATA[%dw 2.0
    output application/json
    ---
    {
    	entityId: payload.entityId,
    	dateCreated: payload.dateCreated,
    	stage: payload.stage
    }]]></ee:set-payload>
    				</ee:message>
    			</ee:transform>
    			<logger level="INFO" doc:name="Logger Customer" message="#[payload]"/>
    		</foreach>
    		<ee:transform doc:name="Response to Json">
    			<ee:message >
    				<ee:set-payload ><![CDATA[%dw 2.0
    output application/json
    ---
    payload]]></ee:set-payload>
    			</ee:message>
    		</ee:transform>
    	</flow>
</mule>
----


== See Also

*  xref:introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
