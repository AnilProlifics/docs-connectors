= Amazon DynamoDB Examples - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

The following are common use cases for the Amazon DynamoDB connector:

* Creating an Amazon DynamoDB table
* Deleting am Amazon DynamoDB table
* Performing an Amazon DynamoDB table scan

[[create-table]]
== Create an Amazon DynamoDB Table

This example shows how to use Amazon DynamoDB connector to create an Amazon DynamoDB table.

=== Flow for Creating an Amazon DynamoDB Table

The following screenshot shows the Anypoint Studio flow for creating an Amazon DynamoDB table:

image::amazon/amazon-dynamodb-create-table-flow.png[Create using Amazon DynamoDB Connector]

=== Steps for Creating an Amazon DynamoDB Table

Follow these steps to create an Amazon DynamoDB table:

. Create a new Mule project in Studio.
. Add the following properties to the `mule-artifact.properties` file to store your Amazon DynamoDB credentials:
+
[source,text,linenums]
----
config.accesskey=<Access Key>
config.secretkey=<Secret Key>
----
+
. Place the `mule-artifact.properties` file in the project's `src/main/resources` directory.

[[configure-http-listener]]
=== Configure HTTP Listener

Configure `HTTP Listener` to listen for HTTP requests on the `/createtable` path:

. In the *Mule Palette* view, search for `http` and select the *Listener* operation.
. Drag the *Listener* operation onto the canvas.
. In the Listener properties window, click the plus sign (+) next to the *Connector configuration* field access the global element configuration fields for `HTTP Listener`.
. In the *Host* field, enter `localhost` and click *OK*.
. In the *Path* field, enter `/createtable`:
+
image::amazon/amazon-dynamodb-http-props.png[DynamoDB HTTP configuration properties]

=== Configure the Create Table Operation

Configure the `Create Table` operation to create a table named `StudentData`.

. In the *Mule Palette* view, search for `amazon dynamodb` and select the *Create Table* operation.
. Drag the *Create Table* operation to the right of *Listener* on the Studio canvas.
. Click the plus sign (+) to the right of the *Connector configuration* field to access the global element configuration fields for Amazon DynamoDB Connector.
. Complete the following fields:
+
[%header,cols="30s,40a,30a"]
|===
|Parameter |Description |Value
|Name |Configuration name |`create-table-flow`
|Access Key |Alphanumeric text string that uniquely identifies the user who owns the account |`${config.accesskey}`
|Secret Key |Key that acts as a password |`${config.secretkey}`
|Region Endpoint |Region for the Amazon DynamoDB client |By default, `USEAST1`
|===
+
The corresponding XML configuration should be as follows:
+
[source,xml,linenums]
----
<dynamodb:config name="Amazon_DynamoDB_Configuration1" doc:name="Amazon DynamoDB Configuration" >
  <dynamodb:basic-connection
  	accessKey="${config.accesskey}"
	  secretKey="${config.secretkey}"
  />
</dynamodb:config>
----
+
. Click *Test Connection* to confirm that Mule can connect with the DynamoDB instance:
* If the connection is successful, click *OK* to save the configurations.
* If the connection is unsuccessful, review or correct any incorrect parameters, and then test again.
. Click *OK*.
. In the properties editor configure the following fields:
+
[%header,cols="25,35,40a"]
|===
|Field |Description | Value
|Table name | The name of the table | Enter `StudentData`.
|Attribute definitions | An array of attributes that describe the key schema for the table and its indexes. | Select `Edit inline`, click the green plus sign (+), and do the following:

* Enter `StudentId` in the `Attribute Name` field.
* Select `NUMBER` in the `Attribute type` field.
|Key schemas | The attributes that make up the primary key for the table or one of its indexes | Select `Edit inline`, click the green plus sign (+), and do the following:

* Enter `studentID` in the `Attribute Name` field.
* Select `HASH` in the `Key type` field.
|Read capacity units | The maximum number of strongly consistent reads per second. | Enter `5`.
|Write capacity units | The maximum number of writes consumed per second.| Enter `5`.
|Global secondary indexes | | Optionally add a global secondary index to the `StudentData` table. For information, see xxxx.

|===
+
For example:
+
image::amazon/amazon-dynamodb-create-table-info.png[Create table info properties]

[[configure-logger]]
=== Configure a Logger

Configure a `Logger` component to print to the Mule console the response generated by the `Create Table` operation.

. Drag a *Logger* component to the right of *Create Table* on the Studio canvas.
. Configure the *Logger* as follows :
+
[%header,cols="30s,70a"]
|===
|Parameter |Value
|Message |`#[payload]`
|===
+
image::amazon/amazon-dynamodb-create-table-logger-props.png[dynamodb create table logger]

=== XML Flow

The XML flow for the Create Table example should look like this:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http"
xmlns:dynamodb="http://www.mulesoft.org/schema/mule/dynamodb"
xmlns="http://www.mulesoft.org/schema/mule/core"
xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core
http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/dynamodb
http://www.mulesoft.org/schema/mule/dynamodb/current/mule-dynamodb.xsd
http://www.mulesoft.org/schema/mule/http
http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
    <configuration-properties file="mule-artifact.properties" />
	<dynamodb:config
		name="Amazon_DynamoDB_Configuration"
		doc:name="Amazon DynamoDB Configuration">
		<dynamodb:basic-connection
			accessKey="${config.accesskey}"
			secretKey="${config.secretkey}" />
	</dynamodb:config>
	<http:listener-config
		name="HTTP_Listener_config"
		doc:name="HTTP Listener config">
		<http:listener-connection host="localhost"
		port="8081" />
	</http:listener-config>
	<flow name="create-table-flow">
		<http:listener
			doc:name="Listener"
			config-ref="HTTP_Listener_config"
			path="/createtable"/>
		<dynamodb:create-table doc:name="Create table"
		config-ref="Amazon_DynamoDB_Configuration"
		tableName="StudentData"
		readCapacityUnits="5" writeCapacityUnits="5">
			<dynamodb:attribute-definitions >
				<dynamodb:attribute-definition
					attributeName="Student ID"
					attributeType="NUMBER" />
			</dynamodb:attribute-definitions>
			<dynamodb:key-schemas >
				<dynamodb:key-schema-element
					attributeName="studentId"
					keyType="HASH" />
			</dynamodb:key-schemas>
		</dynamodb:create-table>
		<logger level="INFO" doc:name="Logger" message="#[payload]"/>
	</flow>
	</mule>
----

=== Add a Secondary Index to the tableName



=== Run the Project

Save and run the project as a Mule app:

. In *Package Explorer*, right-click the project and click *Run As* > *Mule Application*.
. Open a browser and check the response after you enter the `+http://localhost:8081/createtable+` URL.
+
You should see the generated response from the *Create Table* operation in the Mule console.

[[delete-table]]
== Delete an Amazon DynamoDB Table

This example shows how to use Amazon DynamoDB connector to delete an Amazon DynamoDB table.

=== Flow for Deleting a DynamoDB Table

The following screenshot shows the Anypoint Studio flow for creating an amazon DynamoDB table:

image::amazon/amazon-dynamodb-delete-table-flow.png[Delete a table using Amazon DynamoDB Connector]

=== Steps for Deleting an Amazon DynamoDB Table

Follow these steps to delete an Amazon DynamoDB table:

. Create a new Mule project in Studio.
. Add the following properties to the `mule-artifact.properties` file to hold your Amazon DynamoDB credentials:
+
[source,text,linenums]
----
config.accesskey=<Access Key>
config.secretkey=<Secret Key>
----
+
. Place the `mule-artifact.properties` file in the project's `src/main/resources` directory.

=== Configure HTTP Listener

Configure `HTTP Listener` to listen for HTTP requests on the `/deletetable` path:

. In the *Mule Palette* view, search for `http` and select the *Listener* operation.
. Drag the *Listener* operation onto the canvas.
. In the Listener properties window, click the plus sign (+) next to the Connector configuration field to create a global element for `HTTP Listener`.
. In the *Host* field, enter `localhost` and click *OK*.
. In the *Path* field, enter `/deletetable`.
+
image::amazon/amazon-dynamodb-http-props.png[DynamoDB HTTP configuration properties]

=== Configure the Delete Table Operation

Configure the `Delete table` operation to delete the `StudentData` table.

. In the *Mule Palette* view, search for `amazon dynamodb` and select the *Delete Table* operation.
. Drag the *delete Table* operation to the right of *Listener* on the Studio canvas.
. Click the plus sign (+) to the right of the *Connector configuration* field to create a global element for Amazon DynamoDB Connector.
. Complete the following fields:
+
[%header,cols="25,35,40a"]
|===
|Parameter |Description |Value
|Name |Configuration name |`delete-table-flow`
|Access Key |Alphanumeric text string that uniquely identifies the user who owns the account |`${config.accesskey}`
|Secret Key |Key that acts as a password |`${config.secretkey}`
|Region Endpoint |Region for the Amazon DynamoDB client |By default, `USEAST1`
|===
+
The corresponding XML configuration should be as follows:
+
[source,xml,linenums]
----
<dynamodb:config name="Amazon_DynamoDB_Configuration1" doc:name="Amazon DynamoDB Configuration" >
  <dynamodb:basic-connection
  	accessKey="${config.accesskey}"
	  secretKey="${config.secretkey}"
  />
</dynamodb:config>
----
+
. Click *Test Connection* to confirm that Mule can connect with the DynamoDB instance:
* If the connection is successful, click *OK* to save the configurations.
* If the connection is unsuccessful, review or correct any incorrect parameters, and then test again.
. Click *OK*.
. In the properties editor, set the value of `Table name` to `StudentData`:
+
image::amazon/amazon-dynamodb-delete-table-info.png[Delete table info properties]

[[configure-logger]]
=== Configure a Logger

Configure a `Logger` component to print to the Mule console the response generated by the `Delete table` operation.

. Drag a *Logger* component to the right of *Delete Table* on the Studio canvas.
. Configure the *Logger* as follows :
+
[%header,cols="30s,70a"]
|===
|Parameter |Value
|Message |`#[payload]`
|===
+
image::amazon/amazon-dynamodb-delete-table-logger-props.png[dynamodb delete table logger]

=== XML Flow

The XML flow for the Create Table example should look like this:

[source,xml,linenums]
----
xxx
----

[[scan-operation]]
== Scan an Amazon DynamoDB Table

This example shows how to use Amazon DynamoDB connector to scan an Amazon DynamoDB table.

The DynamoDB AWS SDK paginates results by dividing them into specific pages. The 1MB limit applies to returned results. When this limit is exceeded, you must perform another scan to gather the rest of the data.

=== Flow for Scanning a Table

The following screenshot shows the Studio flow for scanning a table:

image::amazon/amazon-dynamodb-scan-operation.png[Creating a table in Amazon DynamoDB]

=== Steps for Performing a Scan

Follow these steps to perform a scan:

. Create a new Mule project or add this flow to an existing project.
. Add `HTTP Listener` to the Studio canvas and configure it to listen for HTTP requests on a specific path.
. In the *Mule Palette*, search for `amazon dynamodb` and select the *Scan* operation.
. Drag the *Scan* operation to the right of *Listener* on the Studio canvas.
. Configure the global properties for the *Scan* operation or select an existing global configuration for Amazon DynamoDB connector.
. Configure the *Scan* operation by entering the name of the  table to scan in the *Table name* field.
. Add the *Transform Message* component to the right of the *Scan* operation on the Studio canvas.
. In the *Output* section of *Transform Message*, change `output application/java` to `output application/json` to transform the *Scan* operation response to JSON format.
. Add a *Logger* component to the right of the *Transform Message* operation on the Studio canvas.
. In the *Logger* component, enter xxx in the *Message* field
to print to the Mule console the response generated by the Scan operation.

=== Response to the Scan Table Example

The response to a *Scan* operation might look like this (with other sections of the response omitted for brevity):

[source,xml,linenums]
----
{
  "scannedCount": 2,
  "lastEvaluatedKey": null,
  "count": 2,
  "consumedCapacity": null,
  "items": [
    {
      "studentID": {
        "ss": null,
        "nullvalue": null,
        "b": null,
        "bool": null,
        "ns": null,
        "l": null,
        "m": null,
        "n": null,
        "bs": null,
        "s": "102"
      },
      ...
  ]
}
----

=== Considerations for Performing Scan

The following considerations apply to performing a scan using Amazon DynamoDB Connector:

* The DynamoDB AWS SDK paginates results by dividing them into specific pages. A 1MB limit applies to returned results. When this limit is exceeded, you must perform another scan to receive the rest of the data.
* To perform subsequent scans, apply the value of the *LastEvaluatedKey* field in the JSON reponse to the *Exclusive start keys* field in the Studio configuration of the *Scan* operation. When the `LastEvaluatedKey` value is in the JSON response is null, the operation has returned all pages of data.

== See Also

* https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/Welcome.html[Amazon API documentation]
* xref:introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
