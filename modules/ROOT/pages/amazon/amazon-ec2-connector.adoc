= Amazon EC2 Connector - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../../assets/images/

Support Category: https://www.mulesoft.com/legal/versioning-back-support-policy#anypoint-connectors[Select]

Anypoint Connector for Amazon EC2 provides connectivity to the Amazon Elastic Compute Cloud (Amazon EC2) API,
enabling you to interface with Amazon EC2 to launch as many virtual servers as you need, configure security and networking, and manage storage.

Release Notes: xref:release-notes::connector/amazon-ec2-connector-release-notes-mule-4.adoc[Amazon EC2 Connector Release Notes] +
Exchange: https://www.mulesoft.com/exchange/com.mulesoft.connectors/mule-amazon-ec2-connector/[Amazon EC2 Connector - Mule 4]

[[prerequisites]]
== Prerequisites

To use Amazon EC2 Connector, you must have the following:

* Access to Amazon Web Services - EC2
* AWS Identity and Access Management (IAM) user account credentials
* Anypoint Studio version 7 or Anypoint Design Center

[[compatibility]]
=== Compatibility

Amazon EC2 connector is compatible with:

[%header,cols="20a,80a",width=70%]
|===
|Application/Service |Version
|Mule |4.1.0 or later
|AWS SDK for Java |1.11.611
|Java |1.8.0_x
|Anypoint Studio |7.0 or higher
|===

== Add the Connector to Your Project

Anypoint Studio provides two ways to add the connector to your Studio project: from the Exchange button in the Studio taskbar or from the Mule Palette view.

=== Add the Connector Using Exchange

. In Studio, create a Mule project.
. Click the Exchange icon *(X)* in the upper-left of the Studio task bar.
. In Exchange, click *Login* and supply your Anypoint Platform username and password.
. In Exchange, search for "ec2".
. Select the connector and click *Add to project*.
. Follow the prompts to install the connector.

=== Add the Connector in Studio

. In Studio, create a Mule project.
. In the Mule Palette view, click *(X) Search in Exchange*.
. In *Add Modules to Project*, type "ec2" in the search field.
. Click this connector's name in *Available modules*.
. Click *Add*.
. Click *Finish*.

[[config]]
== Configure a Global Element

To use the Amazon EC2 connector in your Mule application, configure a global Amazon EC2 element that can be used by all the Amazon EC2 connectors in your project.

. Click the *Global Elements* tab at the base of the canvas.
. In the Global Mule Configuration Elements screen, click *Create*.
. In the Choose Global Type wizard, expand Connector Configuration, select *Amazon EC2: Configuration*, and click *OK*.
+
image::amazon/amazon-ec2-config-global-wizard.png[Global Element Configuration Wizard]
+
. Configure the parameters:
+
[%header,cols="30s,70a"]
|===
|Parameter |Description
|Name |Enter a name for the configuration to reference it.
|Access Key |Alphanumeric text string that uniquely identifies the user who owns the account.
|Secret Key |Key that plays the role of a password.
|Try Default AWS Credentials Provider Chain |Checkbox that controls whether temporary credentials should be used.
|===
+
. Set the placeholder values in the `mule-artifact.properties` configuration file in the
`src/main/resources` folder of your project.
+
You can either enter your credentials into the global configuration properties, or reference a configuration file that contains these values. For simpler maintenance and better re-usability of your project, Mule recommends that you use a configuration file. Keeping these values in a separate file is useful if you need to deploy to different environments, such as production, development, and QA, where your access credentials differ.
+
. Leave the *Advanced* tab with its default values.
. Click *Test Connection* to confirm that the parameters of your global configuration are accurate, and that Mule is able to successfully connect to your instance of Amazon EC2.
. Click *OK* to save the global connector configuration.

== Configure With the XML Editor or Standalone

In Studio, when you drag the connector from the Mule Palette view to the canvas, Studio automatically populates the XML code and POM file for the connector namespace and schema location. 

Alternatively, if you wish to code the connector manually:

. Include the Amazon EC2 namespace and schema location in your configuration file.
+
Namespace: `+http://www.mulesoft.org/schema/mule/ec2+` +
Schema Location: `+http://www.mulesoft.org/schema/mule/ec2/current/mule-ec2.xsd+`
+
[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ec2="http://www.mulesoft.org/schema/mule/ec2"
	xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
	http://www.mulesoft.org/schema/mule/ee/dw
	http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
	http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-current.xsd
	http://www.mulesoft.org/schema/mule/core
	http://www.mulesoft.org/schema/mule/core/current/mule.xsd
	http://www.mulesoft.org/schema/mule/http
	http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
	http://www.mulesoft.org/schema/mule/ee/core
	http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
	http://www.mulesoft.org/schema/mule/ec2
	http://www.mulesoft.org/schema/mule/ec2/current/mule-ec2.xsd">
	<!-- Put your flows and configuration elements here -->
</mule>
----
+
. Create a global Amazon EC2 configuration outside your flows, using the following global configuration code:
+
[source,xml,linenums]
----
<ec2:config name="Amazon_EC2_configuration" doc:name="Amazon EC2 Configuration" >
	<ec2:basic-connection 
		accessKey="${amazon.accesskey}" 
		secretKey="${amazon.secretkey}"
		region="${amazon.region}" />
</ec2:config>
----
+
. Include this XML snippet in your pom.xml file.
+
[source,xml,linenums]
----
<dependency>
    <groupId>com.mulesoft.connectors</groupId>
    <artifactId>mule-amazon-ec2-connector</artifactId>
    <version>RELEASE</version>
    <classifier>mule-plugin</classifier>
</dependency>
----
+
Mule converts the `RELEASE` value to the latest release. 

== EC2 Connector Operations

The Amazon EC2 connector supports the following list of operations:

=== AMIs

* CreateImage
* DeregisterImage
* DescribeImageAttribute
* DescribeImages
* ModifyImageAttribute
* ResetImageAttribute

=== Elastic IP Addresses

* AllocateAddress
* AssociateAddress
* DescribeAddresses
* DescribeMovingAddresses
* DisassociateAddress
* MoveAddressToVpc
* ReleaseAddress
* RestoreAddressToClassic

=== Elastic Network Interfaces (Amazon VPC)

* AssignIpv6Addresses
* AssignPrivateIpAddresses
* AttachNetworkInterface
* CreateNetworkInterface
* DeleteNetworkInterface
* DescribeNetworkInterfaceAttribute
* DescribeNetworkInterfaces
* DetachNetworkInterface
* ModifyNetworkInterfaceAttribute
* ResetNetworkInterfaceAttribute
* UnassignIpv6Addresses
* UnassignPrivateIpAddresses

=== Instances

* AssociateIamInstanceProfile
* DescribeIamInstanceProfileAssociations
* DescribeInstanceAttribute
* DescribeInstances
* DescribeInstanceStatus
* DisassociateIamInstanceProfile
* GetConsoleOutput
* GetConsoleScreenshot
* GetPasswordData
* ModifyInstanceAttribute
* MonitorInstances
* RebootInstances
* ReplaceIamInstanceProfileAssociation
* ReportInstanceStatus
* ResetInstanceAttribute
* RunInstances
* StartInstances
* StopInstances
* TerminateInstances
* UnmonitorInstances

=== Key Pairs

* CreateKeyPair
* DeleteKeyPair
* DescribeKeyPairs
* ImportKeyPair

=== Regions and Availability Zones

* DescribeAvailabilityZones
* DescribeRegions

=== Security Groups

* AuthorizeSecurityGroupEgress
* AuthorizeSecurityGroupIngress
* CreateSecurityGroup
* DeleteSecurityGroup
* DescribeSecurityGroupReferences
* DescribeSecurityGroups
* DescribeStaleSecurityGroups
* RevokeSecurityGroupEgress
* RevokeSecurityGroupIngress

=== Tags

* CreateTags
* DeleteTags
* DescribeTags

=== Volumes and Snapshots (Amazon EBS)

* AttachVolume
* CopySnapshot
* CreateSnapshot
* CreateVolume
* DeleteSnapshot
* DeleteVolume
* DescribeSnapshotAttribute
* DescribeSnapshots
* DescribeVolumeAttribute
* DescribeVolumes
* DescribeVolumesModifications
* DescribeVolumeStatus
* DetachVolume
* EnableVolumeIO
* ModifySnapshotAttribute
* ModifyVolume
* ModifyVolumeAttribute
* ResetSnapshotAttribute

[[use-cases-and-demos]]
== Use Cases and Demos

Common use cases for the connector:

* Create an EBS volume to attach to an instance in the same availability zone
* Attach an EBS volume to a running or stopped Amazon EC2 instance
* Restart an Amazon EBS-backed AMI that you've previously stopped
* Stop an Amazon EC2 instance

[[example-use-case]]
=== Create an EBS Volume

This demo creates an EBS volume that you can attach to an EC2 instance in the same availability zone.

image::amazon/amazon-ec2-create-volume-usecase-flow.png[Creating an EBS volume]

. Create a new Mule project in Anypoint Studio.
. Add the following properties to the `mule-artifact.properties` file to hold your Amazon EC2 credentials and place it in the project's `src/main/resources` directory.
+
[source,text,linenums]
----
amazon.accesskey=<Access Key>
amazon.secretkey=<Secret Key>
amazon.region=<Region>
----
+
. Drag the HTTP Listener component to the canvas, and set *Host* to `localhost` and *Port* to the `8081` value.
. Drag the Amazon EC2 Connector *Create volume* operation next to the HTTP Listener component.
. Configure the EC2 connector by adding a new Amazon EC2 Global Element. Click the plus sign next to the Connector Configuration field.
. Configure the global element:
+
[%header,cols="30s,40a,30a"]
|===
|Parameter |Description |Value
|Name |Enter a name for the configuration to reference it. |<Configuration_Name>
|Access Key |Alphanumeric text string that uniquely identifies the user who owns the account. |`${amazon.accesskey}`
|Secret Key |Key that plays the role of a password. |`${amazon.secretkey}`
|Region Endpoint |Region to be select from drop down for the Amazon EC2 Client. |USEAST1
|===
+
Your configuration should look like this:
+
image::amazon/amazon-ec2-use-case-config.png[ec2 use case config]
+
The corresponding XML configuration should be as follows:
+
[source,xml]
----
<ec2:config name="Amazon_EC2_configuration" doc:name="Amazon EC2 Configuration" >
<ec2:basic-connection 
	accessKey="${amazon.accesskey}" 
	secretKey="${amazon.secretkey}" 
	region="${amazon.region}" />
</ec2:config>
----
+
. Click *Test Connection* to confirm that Mule can connect with the EC2 instance. If the connection is successful, click *OK* to save the configurations. Otherwise, review or correct any incorrect parameters, then test again.
. In the properties editor, configure the remaining parameters:
+
[%header,cols="30s,70a"]
|===
|Parameter |Value
|Display Name |Create Volume (or any other name you prefer)
2+|Basic Settings
|Extension Configuration |Amazon_EC2_Configuration (the reference name to the global element you have created)
2+|General
|Availability Zone |us-east-1a (or any other availability zone to which you have access)
|Size |5 (The size of the volume, in GiBs)
|Volume Type |Standard (the default Volume Type)
|===
+
image::amazon/amazon-ec2-create-volume-props.png[publish message connector props]
+
. Check that your XML looks like this:
+
[source,xml,linenums]
----
<ec2:create-volume 
	config-ref="Amazon_EC2_configuration" 
	availabilityZone="us-east-1a" 
	doc:name="Create volume" 
	size="5"/>
----
+
. Add Set Payload after the Amazon EC2 Create Volume operation to send the response to the client in the browser.
. Set *Value* to `#[payload.volume.volumeId]` to print the volume ID of the EBS volume.
+
image::amazon/amazon-ec2-create-volume-payload.png[ec2 create volume payload transformer]
+
. Add a Logger component after Set Payload to display the Volume ID that is being transformed by the Set Payload transformer from the Create Volume operation in the Mule Console. 
. Set the Logger *Message* to `#[payload]` and *Level* to INFO:
+
image::amazon/amazon-ec2-create-volume-logger-props.png[ec2 create volume logger]
+
. Right-click the project in Package Explorer and click *Run As* > *Mule Application*.
. Browse to `+http://localhost:8081/createVolume+`. 
You should see the generated Volume ID in the browser and the console:

[[example-code]]
=== Example Mule App XML Code

Paste this code into your XML Editor to quickly load the flow for this example use case into your Mule app.

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ec2="http://www.mulesoft.org/schema/mule/ec2"
xmlns:http="http://www.mulesoft.org/schema/mule/http"
xmlns="http://www.mulesoft.org/schema/mule/core"
xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core
http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http
http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ec2
http://www.mulesoft.org/schema/mule/ec2/current/mule-ec2.xsd">
	<http:listener-config 
		name="HTTP_Listener_config" 
		doc:name="HTTP Listener config" >
		<http:listener-connection host="localhost" port="8081" />
	</http:listener-config>
	<ec2:config 
		name="Amazon_EC2_configuration" 
		doc:name="Amazon EC2 Configuration" >
		<ec2:basic-connection 
			accessKey="${amazon.accesskey}" 
			secretKey="${amazon.secretkey}"
			region="USEAST1" />
	</ec2:config>
	<flow name="create-ebs-volume" >
		<http:listener 
			config-ref="HTTP_Listener_config" 
			path="/createVolume" 
			doc:name="Listener" />
		<ec2:create-volume 
			config-ref="Amazon_EC2_configuration" 
			availabilityZone="us-east-1a"
			doc:name="Create volume" 
			size="5"/>
		<set-payload 
			value="#[payload.volume.volumeId]" 
			doc:name="Set Payload"  />
		<logger 
			level="INFO" 
			doc:name="Logger" 
			message="#[payload]"/>
	</flow>
</mule>
----

[[see-also]]
== See Also

* There may be operations not supported by the connector that are provided for AWS http://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_Operations.html[AWS EC2 Actions]. If you require  additional operations to be supported, see the https://support.mulesoft.com/s/ideas[Support Portal].
* https://help.mulesoft.com[MuleSoft Help Center]
