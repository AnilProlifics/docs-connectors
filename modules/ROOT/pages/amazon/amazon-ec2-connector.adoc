= Amazon EC2 Connector - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

Support Category: Select

Amazon EC2 Connector v2.2

Anypoint Connector for Amazon EC2 provides connectivity to the Amazon Elastic Compute Cloud (Amazon EC2) API,
enabling you to interface with Amazon EC2 to launch as many or as few virtual servers as you need, configure security and networking, and manage storage. Amazon EC2 provides scalable computing capacity in the Amazon Web Services (AWS) cloud.

[[prerequisites]]
== Prerequisites

To use Amazon EC2 Connector, you must have the following:

* AWS Identity and Access Management (IAM) user account credentials.
* Access to EC2 via the AWS cloud.
* Anypoint Studio 7.0 or later.
* If lost, a new secret access key to IAM.

[[compatibility]]
=== Compatibility

Amazon EC2 connector is compatible with:

[%header,cols="20s,80a",width=70%]
|===
|Application/Service |Version
|Mule runtime engine |4.0.0 and later
|AWS SDK for Java |1.11.611
|Java |1.8.0_x
|Anypoint Studio |7.0 and later
|===

[[install]]
== Add the Connector to Your Project

Anypoint Studio provides two ways to add the connector to your Studio project: from the Exchange button in the taskbar or from the Mule Palette.

=== Add the Connector Using Exchange

. In Studio, create a Mule project.
. Click the Exchange icon *(X)* in the upper-left of the Studio task bar.
. In Exchange, click *Login* and supply your Anypoint Platform username and password.
. In Exchange, search for "ec2".
. Select the EC2 connector and click *Add to project*.
. Follow the prompts to install the connector.

=== Add the Connector in Studio

. In Studio, create a Mule project.
. In the Mule Palette view, click *(X) Search in Exchange*.
. In *Add Modules to Project*, type "ec2" in the search field.
. Click this connector's name in *Available modules*.
. Click *Add*.
. Click *Finish*.


[[config]]
== Configure the Connector Global Element

To use the Amazon EC2 Connector in your Mule application, configure a global Amazon EC2 element that can be used by all uses of the Amazon EC2 Connector in your project. You can configure using Anypoint Studio's visual editor, an XML editor, or a standalone editor.

=== Configure with Studio's Visual Editor

. Click *Global Elements* at the base of the Studio canvas.
. In *Global Configuration Elements*, click *Create*.
. In *Choose Global Type*, expand *Connector Configuration* and select *Amazon EC2 EC2 configuration*.
. Click *OK*.
+
image::amazon/amazon-ec2-config-global-wizard.png[Global Element Configuration Wizard]
+
. For simpler maintenance and better reusability of your project, create a configuration file `mule-artifact.properties` in the `src/main/resources` folder, using the following values:
+
[%header,cols="30s,70a",width=80%]
|===
|Studio Field |Description
|Name |Enter a name for other instances of this connector to refer to this configuration.
|Access Key |Alphanumeric text string that uniquely identifies the user who owns the account.
|Secret Key |Key acts as a password.
|Try Default AWS Credentials Provider Chain |Checkbox that controls whether temporary credentials should be used.
|===
+
Although you could enter your credentials into the global configuration properties, use a configuration file in case you need to deploy to different environments, such as production, development, and QA, where your access credentials differ.
+
. In *Advanced*, make no changes to the default values in *Reconnection strategy*.
. Click *Test Connection* to confirm that the parameters of your global configuration are accurate, and that Mule is able to successfully connect to your instance of Amazon EC2.
. Click *OK*.

=== Configure with the XML Editor or a Standalone Editor

If you are configuring the connector with Studio's XML editor or working standalone without Studio, you can use this information to configure the connector:

. Ensure that you have included the Amazon EC2 namespaces in your configuration file:
+
[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ec2="http://www.mulesoft.org/schema/mule/ec2"
	xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
	http://www.mulesoft.org/schema/mule/ee/dw
	http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
	http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-current.xsd
	http://www.mulesoft.org/schema/mule/core
	http://www.mulesoft.org/schema/mule/core/current/mule.xsd
	http://www.mulesoft.org/schema/mule/http
	http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
	http://www.mulesoft.org/schema/mule/ee/core
	http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
	http://www.mulesoft.org/schema/mule/ec2
	http://www.mulesoft.org/schema/mule/ec2/current/mule-ec2.xsd">
<!-- Put your flows and configuration elements here -->

</mule>
----
+
. Create a global Amazon EC2 configuration outside and above your flows, using the following global configuration code:
+
[source,xml,linenums]
----
<ec2:config name="Amazon_EC2_configuration" doc:name="Amazon EC2 Configuration" >
	<ec2:basic-connection accessKey="${amazon.accesskey}" secretKey="${amazon.secretkey}"
	region="${amazon.region}" />
</ec2:config>
----

== EC2 Connector Operations

The Amazon EC2 Connector supports the following Anypoint Studio operations.

=== AMIs

[%header,cols="30a,30a",width="70%"]
|===
|Studio Operation Name |XML Operation Name
|
* Create image
* Deregister image
* Describe image attribute
* Describe images
* Modify image attribute
* Reset image attribute
|
* CreateImage
* DeregisterImage
* DescribeImageAttribute
* DescribeImages
* ModifyImageAttribute
* ResetImageAttribute
|===


=== Elastic IP Addresses

[%header,cols="30a,30a",width="70%"]
|===
|Studio Operation Name |XML Operation Name
|
* Allocate address
* Associate address
* Describe addresses
* Describe moving addresses
* Disassociate address
* Move address to vpc
* Release address
* Restore address to classic
|
* AllocateAddress
* AssociateAddress
* DescribeAddresses
* DescribeMovingAddresses
* DisassociateAddress
* MoveAddressToVpc
* ReleaseAddress
* RestoreAddressToClassic
|===

=== Elastic Network Interfaces (Amazon VPC)

[%header,cols="50a,50a"]
|===
|Studio Operation Name |XML Operation Name
|
* Assign ipv 6 addresses
* Assign private ip addresses
* Attach network interface
* Create network interface
* Delete network interface
* Describe network interface attribute
* Describe network interfaces
* Detach network interface
* Modify network interface attribute
* Reset network interface attribute
* Unassign ipv 6 addresses
* Unassign private ip addresses
|
* AssignIpv6Addresses
* AssignPrivateIpAddresses
* AttachNetworkInterface
* CreateNetworkInterface
* DeleteNetworkInterface
* DescribeNetworkInterfaceAttribute
* DescribeNetworkInterfaces
* DetachNetworkInterface
* ModifyNetworkInterfaceAttribute
* ResetNetworkInterfaceAttribute
* UnassignIpv6Addresses
* UnassignPrivateIpAddresses
|===

=== Instances

[%header,cols="50a,50a"]
|===
|Studio Operation Name |XML Operation Name
|
* Associate iam instance profile
* Describe iam instance profile associations
* Describe instance attribute
* Describe instances
* Describe instance Status
* Disassociate iam Instance profile
* Get console output
* Get console screenshot
* Get password data
* Modify instance attribute
* Monitor instances
* Reboot instances
* Replace iam instance profile association
* Report instance status
* Reset instance attribute
* Run instances
* Start instances
* Stop instances
* Terminate instances
* Unmonitor instances
|
* AssociateIamInstanceProfile
* DescribeIamInstanceProfileAssociations
* DescribeInstanceAttribute
* DescribeInstances
* DescribeInstanceStatus
* DisassociateIamInstanceProfile
* GetConsoleOutput
* GetConsoleScreenshot
* GetPasswordData
* ModifyInstanceAttribute
* MonitorInstances
* RebootInstances
* ReplaceIamInstanceProfileAssociation
* ReportInstanceStatus
* ResetInstanceAttribute
* RunInstances
* StartInstances
* StopInstances
* TerminateInstances
* UnmonitorInstances
|===

=== Key Pairs

[%header,cols="30a,30a",width="70%"]
|===
|Studio Operation Name |XML Operation Name
|
* Create key pair
* Delete key pair
* Describe key pairs
* Import key pair
|
* CreateKeyPair
* DeleteKeyPair
* DescribeKeyPairs
* ImportKeyPair
|===

=== Regions and Availability Zones

[%header,cols="50a,50a"]
|===
|Studio Operation Name |XML Operation Name
|
* Describe availability zones
* Describe regions
|
* DescribeAvailabilityZones
* DescribeRegions
|===

=== Security Groups

[%header,cols="50a,50a"]
|===
|Studio Operation Name |XML Operation Name
|
* Authorize security group egress
* Authorize security group ingress
* Create security group
* Delete security group
* Describe security group references
* Describe security groups
* Describe stale security groups
* Revoke security group egress
* Revoke security group ingress
|
* AuthorizeSecurityGroupEgress
* AuthorizeSecurityGroupIngress
* CreateSecurityGroup
* DeleteSecurityGroup
* DescribeSecurityGroupReferences
* DescribeSecurityGroups
* DescribeStaleSecurityGroups
* RevokeSecurityGroupEgress
* RevokeSecurityGroupIngress
|===

=== Tags

[%header,cols="30a,30a",width="70%"]
|===
|Studio Operation Name |XML Operation Name
|
* Create tags
* Delete tags
* Describe tags
|
* CreateTags
* DeleteTags
* DescribeTags
|===

=== Volumes and Snapshots (Amazon EBS)

[%header,cols="30a,30a",width="70%"]
|===
|Studio Operation Name |XML Operation Name
|
* Attach volume
* Copy snapshot
* Create snapshot
* Create volume
* Delete snapshot
* Delete volume
* Describe snapshot attribute
* Describe snapshots
* Describe volume attribute
* Describe volumes
* Describe volumes modifications
* Describe volume status
* Detach volume
* Enable volume io
* Modify snapshot attribute
* Modify volume
* Modify volume attribute
* Reset snapshot attribute
|
* AttachVolume
* CopySnapshot
* CreateSnapshot
* CreateVolume
* DeleteSnapshot
* DeleteVolume
* DescribeSnapshotAttribute
* DescribeSnapshots
* DescribeVolumeAttribute
* DescribeVolumes
* DescribeVolumesModifications
* DescribeVolumeStatus
* DetachVolume
* EnableVolumeIO
* ModifySnapshotAttribute
* ModifyVolume
* ModifyVolumeAttribute
* ResetSnapshotAttribute
|===


== Connector Namespace and Schema

When designing your application in Anypoint Studio, when you drag the connector from the palette onto the canvas automatically populates the XML code with the connector namespace and schema location:

Namespace: `+http://www.mulesoft.org/schema/mule/ec2+`

Schema Location: `+http://www.mulesoft.org/schema/mule/ec2/current/mule-ec2.xsd+`

If you are manually coding the Mule application in Studio's XML editor or another text editor, paste these lines into the header of your configuration's XML, inside the `<mule>` tag:

[source,xml,linenums]
----
<mule xmlns:ec2="http://www.mulesoft.org/schema/mule/ec2"
	xmlns:dw="http://www.mulesoft.org/schema/mule/ee/dw"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
	http://www.mulesoft.org/schema/mule/ee/dw
	http://www.mulesoft.org/schema/mule/ee/dw/current/dw.xsd
	http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-current.xsd
	http://www.mulesoft.org/schema/mule/core
	http://www.mulesoft.org/schema/mule/core/current/mule.xsd
	http://www.mulesoft.org/schema/mule/http
	http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
	http://www.mulesoft.org/schema/mule/ee/core
	http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
	http://www.mulesoft.org/schema/mule/ec2
	http://www.mulesoft.org/schema/mule/ec2/current/mule-ec2.xsd">

       <!-- Put your global configuration elements and flows here -->

</mule>
----

== Using the Connector in a Mule App in Anypoint Studio 7.0 or Later

If you are coding a Mavenized Mule application, include this snippet in your `pom.xml` file:

[source,xml,linenums]
----
<dependency>
    <groupId>com.mulesoft.connectors</groupId>
    <artifactId>mule-amazon-ec2-connector</artifactId>
    <version>RELEASE</version>
    <classifier>mule-plugin</classifier>
</dependency>
----

Mule runtime engine translates the `RELEASE` dependency keyword to the current version.

To obtain the most up-to-date `pom.xml` file information, access the connector in https://www.mulesoft.com/exchange/[Anypoint Exchange] and click *Dependency Snippets*.

[[use-cases-and-demos]]
== Use Cases and Demos

Following are a few common use cases for the connector:

* Start an Amazon EC2 instance - When you use Amazon EC2, you can restart an Amazon EBS-backed AMI that you've previously stopped.
* Stop an Amazon EC2 instance - When you use Amazon EC2, you can stop an Amazon EBS-backed instance.
* Create an EBS volume - When you use Amazon EC2, you can create an EBS volume that can be attached to an instance in the same availability zone.
* Attach an EBS volume to an Amazon EC2 instance - When you use Amazon EC2, you can attach an EBS volume to a running or stopped Amazon EC2 instance.


[[example-use-case]]
=== Demo Mule App Using the Connector

This demo creates an EBS volume that can be attached to an EC2 instance in the same Availability Zone.

image::amazon/amazon-ec2-create-volume-usecase-flow.png[Creating an EBS volume]

. Create a new Mule project in Anypoint Studio.
. To create a separate credentials file, add the following properties to the `mule-artifact.properties` and place it in the project's `src/main/resources` directory.
+
[source,text,linenums]
----
amazon.accesskey=<Access Key>
amazon.secretkey=<Secret Key>
amazon.region=<Region>
----
+
. Drag an HTTP Listener operation onto the canvas and configure the following parameters:
+
image::amazon/amazon-ec2-http-props.png[ec2 HTTP configure properties]
+
[%header,cols="30s,70a"]
|===
|Studio Field |Value
|Display Name |Listener
|Extension Configuration | If no HTTP Listener configuration exists, click the plus sign (+) to add a new HTTP Listener configuration, providing the values `localhost` and `8081` for the Host and Port, and click *OK*.
|Path |/createVolume
|===
+
. Drag the Amazon EC2 Connector *Create volume* operation next to the HTTP Listener component.
. Configure the EC2 connector by adding a new Amazon EC2 global element and click *+* next to the *Connector Configuration* field.
.. Configure the global element according as follows:
+
[%header,cols="30s,40a,30a"]
|===
|Studio Field |Description |Value
|Name |Enter a name for other instances of the connector to reference it |`<Configuration_Name>`
|Access Key |Alphanumeric text string that uniquely identifies the user who owns the account |`${amazon.accesskey}`
|Secret Key |Key that plays acts as a password |`${amazon.secretkey}`
|Region Endpoint |Region to select from the drop-down menu for the Amazon EC2 client |`USEAST1`
|===
+
.. Your configuration should look like this:
+
image::amazon/amazon-ec2-use-case-config.png[ec2 use case config]
+
.. The corresponding XML configuration should be as follows:
+
[source,xml,linenums]
----
<ec2:config 
	name="Amazon_EC2_configuration" 
	doc:name="Amazon EC2 Configuration" >
<ec2:basic-connection 
	accessKey="${amazon.accesskey}" 
	secretKey="${amazon.secretkey}" 
	region="${amazon.region}" />
</ec2:config>
----
+
. Click *Test Connection*.
. If the connection is successful, click *OK* to save the configurations. Otherwise, review or correct any incorrect parameters, then test again.
. Back in the properties editor of the Amazon EC2 Create volume operation, configure the remaining parameters:
+
[%header,cols="30s,70a"]
|===
|Studio Field |Value
|Display Name |Create Volume (or any other name you prefer)
2+|Basic Settings
|Extension Configuration |Amazon_EC2_Configuration (the name you created for the global element)
2+|General
|Availability Zone |`us-east-1a` (or any other availability zone to which you have access)
|Size |5 (the size of the volume, in gibibytes GiBs)
|Volume Type |Standard (the default volume type)
|===
+
image::amazon/amazon-ec2-create-volume-props.png[publish message connector props]
+
. Verify that your XML looks like this:
+
[source,xml,linenums]
----
<ec2:create-volume 
	config-ref="Amazon_EC2_configuration" 
	availabilityZone="us-east-1a" 
	doc:name="Create volume" 
	size="5"/>
----
+
. Add a Set Payload transformer, configured as follows, after the Amazon EC2 Create Volume operation to send the response to the client in the browser:
+
[%header,cols="30s,70a"]
|===
|Studio Field |Value
|Display Name |Set Payload (or any other name you prefer)
|Value |`#[payload.volume.volumeId]` (to print the volume ID of the EBS volume you created)
|===
+
image::amazon/amazon-ec2-create-volume-payload.png[ec2 create volume payload transformer]
+
. Add a Logger component, configured as follows, after the Set Payload transformer to print the volume ID that is being transformed by the Set Payload transformer from the Create Volume operation in the Mule console:
+
[%header,cols="30s,70a"]
|===
|Studio Field |Value
|Display Name |Logger (or any other name you prefer)
|Message |`#[payload]`
|Level |INFO
|===
+
image::amazon/amazon-ec2-create-volume-logger-props.png[ec2 create volume logger]
+
. Save and run the project as a Mule app by right-clicking the project in Package Explorer and clicking *Run As* > *Mule Application*.
. Enter `+http://localhost:8081/createVolume+` in a browser and confirm that you see the generated Volume ID in the browser and the console.

[[example-code]]
=== Demo Mule Application XML Code

Paste this code into your XML editor to quickly load the flow for this example use case into your Mule app.

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ec2="http://www.mulesoft.org/schema/mule/ec2"
xmlns:http="http://www.mulesoft.org/schema/mule/http"
xmlns="http://www.mulesoft.org/schema/mule/core"
xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core
http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http
http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ec2
http://www.mulesoft.org/schema/mule/ec2/current/mule-ec2.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" >
		<http:listener-connection host="localhost" port="8081" />
	</http:listener-config>
	<ec2:config name="Amazon_EC2_configuration" doc:name="Amazon EC2 Configuration" >
		<ec2:basic-connection accessKey="${amazon.accesskey}" secretKey="${amazon.secretkey}"
		region="USEAST1" />
	</ec2:config>
	<flow name="create-ebs-volume" >
		<http:listener config-ref="HTTP_Listener_config" path="/createVolume" doc:name="Listener" />
		<ec2:create-volume config-ref="Amazon_EC2_configuration" availabilityZone="us-east-1a"
		doc:name="Create volume" size="5"/>
		<set-payload value="#[payload.volume.volumeId]" doc:name="Set Payload"  />
		<logger level="INFO" doc:name="Logger" message="#[payload]"/>
	</flow>
</mule>
----

[[see-also]]
== See Also

* https://help.mulesoft.com[MuleSoft Help Center]
