= Example: To Create an Instance of a Class
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: Java, create instance

== Calling Java Constructors

The examples on this page will be based on the following Java class `Person` which
belongs to the `com.foo` package:

[source,java,linenums]
----
package com.foo;

public class Person {

    private String name;
    private Integer age;

    public Person() {
        this.name = "Max Mule";
        this.age = 10;
    }

    public Person(String name, Integer age) {
        this.name = name;
        this.age = age;
    }
}
----

IMPORTANT: The classes used with the Java Module must be exported (unless they belong to the default package).
If not exported, the execution will fail with a JAVA:CLASS_NOT_FOUND error.
See xref:4.1@mule-runtime::how-to-export-resources.adoc[how to export resources].

The constructors for this class can be called using the `new` operation of the Java Module.
This example shows how to create an instance of Person using the constructor that does not require parameters:

[source,xml,linenums]
----
<java:new class="com.foo.Person" constructor="Person()"/>
----

To create a Person object using the constructor that does require parameters:

[source,xml,linenums]
----
<java:new class="com.foo.Person" constructor="Person(String, Integer)">
    <java:args>#[{
      name: 'Jhon Doe',
      age: 30
    }]</java:args>
</java:new>
----

For the constructor parameters, the full package name can be specified, for example
`constructor="Person(java.lang.String, java.lang.Integer)"`. Of course, this is not needed, but it can
be useful to add more clarity in the code or if there are clashing class names in the Java code.


[IMPORTANT]
===============================
When configuring the constructor arguments in the `args` parameter,
the keys of the map will determine how the parameters will be passed to the constructor. *In
order to reference the parameters by name* (`firstName`, `age`, etc.),
the java class containing the Method or Constructor has to be compiled
using https://docs.oracle.com/javase/tutorial/reflect/member/methodparameterreflection.html[the `-parameters` compiler flag].
If the class was not compiled with this flag, then the same parameters
must be referenced in the declared order and with the canonical names
(`arg0`, `arg1`, etc.). In this case:
[source,xml,linenums]
----
<java:args>#[{
  arg0: 'Jhon Doe',
  arg1: 30
}]</java:args>
----

If the Java classes are defined in a Studio Project, the Maven Compiler plugin must be
configured in the `pom.xml` in order to compile Java classes with the `-parameters` flag:

[source,xml,linenums]
----
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-compiler-plugin</artifactId>
    <version>3.8.1</version>
    <configuration>
        <compilerArgs>
            <arg>-parameters</arg>
        </compilerArgs>
    </configuration>
</plugin>
----
===============================

== DataSense Support in Studio

One of the advantages of using the Java Module is the https://docs.mulesoft.com/studio/7.3/datasense-concept[DataSense] support,
which can help build the `args` map, which serves as input for the `new` operation.

Continuing the previous example, where the `new` operation calls the `Person(String, Integer)`
constructor of the `com.foo.Person` class, clicking the Show Graphical View icon image:../../assets/images/java/graphical-view.png[30, 30]
will show a view to match fields. Assuming that the previous component in the flow outputs a map
with `name` and `age` keys (like the
https://docs.mulesoft.com/mule-runtime/4.1/set-payload-transformer-reference[Set Payload]
component can do), the view will look like this:

image::../../assets/images/java/matching-input.png[]

Here the fields can be matched by dragging and dropping from the left to the right. Doing so will produce:

image::../../assets/images/java/matched-input.png[]

Now the `new` operation is configured and ready.

DataSense will also provide Metadata for the operation's output. The `new` operation
will place the `Person` object in the payload of the output Message, as can be observed:

image::../../assets/images/java/output-metadata.png[]

== Target Parameters

Instead of placing the output object in the payload, it is possible to
save the output object to a variable as the `new` operation supports
https://docs.mulesoft.com/mule-runtime/4.2/target-variables[target parameters].
For example:

[source,xml,linenums]
----
<java:new class="com.foo.Person" constructor="Person(String, Integer)" target="john">
    <java:args>#[{
      name: 'Jhon Doe',
      age: 30
    }]</java:args>
</java:new>
----

The output object is saved in a variable and can be accessed later as `"#[vars.john]"`.

== Further Reading

xref:java/java-invoke-method.adoc[Example: To Invoke Methods]

xref:java/java-instanceof.adoc[Example: To Test for an Instance of a Class]

xref:java/java-throwable.adoc[Example: Working With Throwables]