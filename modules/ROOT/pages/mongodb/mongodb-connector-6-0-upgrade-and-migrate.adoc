= MongoDB - Upgrade and Migrate - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

Upgrade Anypoint Connector for MongoDB (MongoDB Connector) to version 6.0.0.

== Supported Upgrade Paths

[%header,cols="50a,50a"]
|===
|From Version | To Version
|5.3.x |6.0.0
|===

== Changes in This Release

This release contains the following changes:

* Changed operation names, metadata, fields, and values
* Changed input sources
* Changed connection types

=== Changed Operation Names

The following operation names changed in MongoDB 6.0.0:

[%header]
|===
|5.3.x|6.0.0
|Map reduce objects |Map reduce
|Exists collection |Collection exists
|List indices |List indexes
|===

== Changed Operations Parameters

[%header,cols="19%,15%,15%,19%,15%,15%"]
|===
3+|Existing in MongoDB 5.x 3+| Modified in MongoDB 6.x
|Operation Name | Input Params  |Output Params  | Operation Name                             |Input Params                                      |Output Params
| Drop database
| N/A
| N/A
| No changes
a|* Database name (String)
| N/A
| Dump
a|* Id (String)
* OutputDirectory (String)
* OutputName (String)
* Zip (Boolean)
* Oplog (Boolean)
* Threads(Int)
| N/A
| No changes
a|* OutputDirectory (String)
* OutputNamePrefix (String)
* Oplog (No Change)
* OperationTimeout (Integer)
* OperationTimeoutUnits (Java TimeUnit)
| N/A
| Add user
a| * Username (String)
* Password (String)
| N/A
| No changes
a| * Username (String)
* Password (String)
| N/A
| Create Collection
a| * Collection name (String)
* Capped (Boolean)
* Max objects (Number)
* Collection size (Number)
| N/A
| No changes
a| * Collection name (String)
* Capped options (Object)
* Max objects (Number: as part of CappedOptions)
* Collection size (Number: as part of CappedOptions)
* Collection size data unit (Number: as part of CappedOptions)
| N/A
| Drop collection
a|* Collection name (String)
| N/A
| No changes
a|* Collection name (String)
|N/A
| Exists collection
a|* Collection name (String)
| N/A
| Collection exists
a|* Collection name (String)
| N/A
| List collections
| N/A
| N/A
| No changes
| N/A
| N/A
| Map reduce objects
a|* Collection name (String)
* Mapping function (String)
* Reduce function (String)
* Output collection (String)
| N/A
| Map reduce
a|* Collection name (String)
* Mapping function (String)
* Reduce function (String)
* Output collection (String)
| N/A
| Create index
a|* Collection name (String)
* Field name (String)
* Order (Enum: ASC or DESC)
| N/A
| No changes
a|* Collection name (String)
* Field name (String)
* Sort order (Enum: ASC or DESC)
| N/A
| Drop index
a|* Collection name (String)
* Index name (String)
| N/A
| No changes
a|* Collection name (String)
* Index name (String)
| N/A
| List indices
a|* Collection name (String)
| N/A
| List indexes
a|* Collection name (String)
| N/A
| Insert document
a|* Collection name (String)
* Document (InputStream)
| N/A
| No changes
a|* Collection name (String)
* Document (InputStream)
| N/A
| Insert documents
a|* Collection name (String)
* Documents (InputStream)
* Write ordered (Boolean)
| N/A
| No changes
a|* Collection name (String)
* Documents (InputStream)
* Write ordered (Boolean)
| N/A
| Update documents
a|* Collection name (String)
* Find query (InputStream)
* Content to update (InputStream)
* Multiple update (Boolean)
| N/A
| No changes
a|* Collection name (String)
* Query (InputStream)
* Content to update (InputStream)
* Multiple update (Boolean)
* Upsert (Boolean)
| N/A
| Remove documents
a|* Collection name (String)
* Find query (InputStream)
| N/A
| No changes
a|* Collection name (String)
* Query (InputStream)
| N/A
| Count documents
a|* Collection name (String)
* Condition query (InputStream)
| N/A
| No changes
a|* Collection name (String)
* Query (InputStream)
| N/A
| Find documents
a|* Collection name (String)
* Condition query (InputStream)
* Fields (Array of String)
* Num to skip (Number)
* Result limit (Number)
* Sort by (InputStream)
* Return id (Boolean)
| N/A
| No changes
a|* Collection name (String)
* Query (InputStream)
* Fields (String)
* Sort by (InputStream)
* Page size (Number)
* Limit (Number)
| N/A
| Execute command
a|* Command name (String)
* Command value (String)
| N/A
| No changes
a|* Command (InputStream)
| N/A
| Create file from payload
a|* Content (InputStream)
* Filename (String)
* Metadata (InputStream)
| N/A
| Create file
a|* Content (InputStream)
* Filename (String)
* Metadata (InputStream)
| N/A
| Find files
a|* Find query (InputStream)
| N/A
| No changes
a|* Query (InputStream)
* Sort by (Object)
| N/A
| Get file content
a|* File id (Object)
| N/A
| No changes
a|* File id (InputStream)
| N/A
| Remove files
a|* File id (Object)
| N/A
| No changes
a|* File id (InputStream)
| N/A
|===

== Changed Operations Metadata

MongoDB 5.x generated operations metadata when the user provided a set of documents per collection from which to take the attributes. MongoDB 6.0 generates metadata automatically, based on the latest document in each collection.

=== Metadata in MongoDB v6.0

[%header,cols="34%,33%,33%"]
|===
|Operation Name	| Input Metadata	|Output Metadata

| Insert Document
|Document
| Resolved dynamically based on the selected value of the collection parameter. The connector adds the latest document of the given collection and uses the document's structures structure as input/output metadata.

| Insert Documents
|Document
|Resolved dynamically based on the selected value of the collection parameter. The connector adds the latest document of the given collection and uses the document's structures structure as input/output metadata.

| Update Documents
| N/A
| JSON that contains the following structure: { "matched" : int, "modified" : int, upsertedId: JSON }

| Remove Documents
| Query: JSON Object
| N/A

| Count Documents
| Query: JSON Object
| N/A

| Find Documents
| Query: JSON Object
| Resolved dynamically based on the selected value of the collection parameter. The connector uses the structure of the first document in the given collection.
*Reviwers, in the last sentence, what does the connector use the structure of the first document for?*

| Create File
| N/A
a|** A GridFS JSON object with the following structure:
* JSON Id
* String fileName
* Long Length
* Int ChunkSize
* Datetime uploadDate
* JSON Metadata

| Find Files
| N/A
a|** List<InputStream>
+
+ Each InputStream is a GridFS JSON object with the following attributes:
* JSON Id
* String fileName
* Long Length
* Int ChunkSize
* Datetime uploadDate
* JSON Metadata

|===

== Removed Operations

The following operations were removed from the MongoDB connector:

[%header,cols="15%,35%,15%,35%"]
|===
2+|Removed from MongoDB 5.x 2+| Can be reproduced in MongoDB 6.0.0 through
|Name	| Description	|Name	|Description
|Incremental dump | Executes an incremental dump of the database. | Dump | Use the Dump operation.
|Restore | Takes the output from the dump and restores it | Restore from file or Restore from directory | These operations take the output from the dump file or directory and restore it.
|Update documents by function | Update documents using a Mongo function | N/A | N/A
|Update documents by functions | Update documents using one or more Mongo functions | N/A | N/A
|Find one and update document | Finds and updates the first document that matches a given query | N/A | This operation's functionality can be reproduced by combining other operations
*Reviewers, can you provide examples*
|Save document | Inserts or updates a document based on its object ID | N/A | N/A
|Find one document | Finds the first document that matches a given query | Find documents | Set the Limit=1 to return one document.
|Execute generic command | Executes a generic command on the database | Execute command | Executes a command on the database
|List files | Lists all files that match the given query and sorts them by filename | N/A | N/A
|Find one file | Returns the first file that matches the given query | Find files | Giving a specific file to the query
|===

== Changes in Input Sources
MongoDB 6.0.0 has one input source only, Object Listener, which retrieves all of the created documents that belong to a specific collection.

The Delete Sources and Update Sources input sources were removed.
*Reviewers, I don't see these sources. The only sources I see in the Reference Guide are Deleted Object, Modified Object, and New Object. Do you mean that these sources were removed?*

=== Metadata in Object Listener

[%header,cols="50%,50%"]
|===
|Input Metadata	|Output Metadata

| N/A
| The connector resolves output metadata dynamically based on the selected value of the Collection Name parameter. The connector reads the last document of the given collection and uses the document's structure as output metadata.
|===

== Changes in Connection types
The Connection String type was removed in this version, which leaves only one Generic Connection.

== See Also

*  xref:introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
