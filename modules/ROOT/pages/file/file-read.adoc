= Read a File Using the File Connector
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../../assets/images/

The File connector can read a file at any point in the flow, unlike in Mule 3, where the
transport could only read files as a result of inbound endpoint polling.

The only required parameter for the `Read` operation is `path`, which is the relative path of the file
you wish to read. This path is relative to the `working directory` defined in the configuration
referenced by the `config-ref` parameter. To see an example of creating a configuration check
xref:file/file-connector.adoc#connection_settings[this page]. If no configuration is referenced,
the working directory defaults to the value of the `user.home` system property. If the system
property is not set, the connector fails to initialize.

Here is an example for reading a file:

[source,xml]
----
<file:read config-ref="File_Config" path="filePath"/>
----

The `Read` operation returns a `MuleMessage` with the following attributes:

* The file's content as the payload.
* The file's metadata in the message attributes.
* If the file does not exist, you receive a `FILE:ILLEGAL_PATH` error. Note that the operation does not read directories.

[NOTE]
===========
The `Read` operation (as other operations that return non-void values) supports target parameters.
To learn more about them see xref:4.2@mule-runtime::target-variables.adoc[Mule Runtime Target Variables].
===========

== Configure a Relative Path

Suppose that you have numerous `Read` operations (or any other file operations) in your app and they
share part of their path, you can extract that base path into a
xref:file/file-connector.adoc#connection_settings[file configuration]. For example, to access
two files whose full paths are: `/Users/Documents/Examples/manual.txt` and `/Users/Documents/Examples/readme.txt`,
define the following configuration:

[source,xml,linenums]
----
<file:config name="File_Config" >
    <file:connection workingDir="/Users/Documents/Examples" />
</file:config>
----

Then define the `Read` operations referencing that configuration like this:

[source,xml,linenums]
----
<file:read config-ref="File_Config" path="manual.txt" />
...
<file:read config-ref="File_Config" path="readme.txt" />
----

// == INCLUDE SHARED READ OP CONTENT FOR FILE, FTP, AND SFTP CONNECTORS
include::partial$common-read-operation.adoc[]

== Access Files Defined in a Studio Project

If you are developing your application in Studio, you can save your folders and files in the
`resources` folder. Later on, when the app is deployed, those folders and files you defined are
copied to the directory defined by the `${app.home}` property. Suppose we have defined a folder named
`MyFiles` in the `resources` folder and a file named `Example.txt` inside of it.
In Studio, we would see this in our project structure:

image::file/project-resources.png[]

In runtime, the path to access this file would be `${app.home}/MyFiles/Example.txt`.
To read this file we can first define the following config:

[source,xml,linenums]
----
<file:config name="File_Config" >
    <file:connection workingDir="${app.home}" />
</file:config>
----

Configure the `Read` operation like this:

[source,xml]
----
<file:read config-ref="File_Config" path="MyFiles/Example.txt" />
----

[WARNING]
As stated before, each time the application is deployed the contents from
`src/main/resources` folder are copied to the `${app.home}` directory. This means that changes made
to those files during runtime are lost once the application is stopped or redeployed. This is why we
recommend putting files in the resource folder that you only need to read during your application's
execution.

== File Locking

You can set a file system lock on the file when it is being read by setting the `lock` parameter
to `true` (defaults to `false`). When enabled, this feature asks the operating system to lock
the file, which prevents any other process from accessing that file while the
lock is held. Because the lock is actually provided by the host file system, its behavior might
change depending on the mounted drive and the operation system on which mule is running. Take
that into consideration before blindly relying on this lock. The lock is automatically released
when one of the following things occurs:

* The Mule flow that locked the file ends.
* The file's content has been fully read.

Note that if the file is already locked by someone else, the connector will not be able to lock
it, and you will receive a `FILE:FILE_LOCK` error.

An example of locking:
[source,xml]
----
<file:read config-ref="File_Config" path="filePath" lock="true" />
----

== Modify the Output MIME Type and Encoding

If you want to change the MIME type or the encoding of the payload that the `Read` operation outputs,
you can use the `outputEncoding` and `outputMimeType` parameters. For example:

[source,xml,linenums]
----
<file:read config-ref="File_Config" 
    path="filePath" 
    outputEncoding="UTF-8" 
    outputMimeType="application/csv; headers=false" />
----

== Wait for a File

If you want to read a file, but you are not sure if the file is still being written or not, you can use
the `TimeBetweenSizeChecks` parameter (which works alongside the `TimeBetweenSizeCheckUnit` parameter).
When enabled, Mule performs two size checks: one when the flow reaches a point where the stream is about to be
consumed (not in the `Read` operation) and another check after the wait time set by the
aforementioned parameters. If the file's size is the same at both checks, then the stream is consumed
successfully. Otherwise, it means that the file is still being written, so the stream is not consumed and the
operation fails with an error. The time check is not done in the `read` operation because `read` returns a
*lazy* stream, so it makes sense to do the size check only when the stream is about to be consumed.

Let's see an example where we first use the `Read` operation with size check parameters and then
consume the output stream in a xref:4.2@mule-runtime::logger-component-reference.adoc[`logger` component].

[source,xml,linenums]
----
<file:read config-ref="File_Config" 
    path="filePath" 
    timeBetweenSizeCheck="15" 
    timeBetweenSizeCheckUnit="SECONDS">
<logger level="INFO" message="#[payload]"/>
----

Note that the 15 seconds check happens when the `logger` component executes, not at the Read operation.

//== STREAMING INCLUDE in File, FTP, and SFTP Connector docs
include::partial$common-streaming.adoc[]
