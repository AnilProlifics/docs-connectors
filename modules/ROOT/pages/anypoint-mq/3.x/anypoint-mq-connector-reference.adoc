= Anypoint MQ Connector Reference - 3.x
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

Support Version: Select

Anypoint MQ Connector Version 3.x

Anypoint MQ is a multitenant, cloud messaging service that enables customers to perform advanced asynchronous messaging  among their applications.


== Configurations
---
[[config]]
=== Config


==== Parameters
[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
|Name | String | Specifies the name for this configuration. Connectors refer to the configuration by using this name. | | x
| Connection a| <<config_connection, Connection>>
 | Specifies the connection types to provide to this configuration. | | x
| Expiration Policy a| <<ExpirationPolicy>> | Configures the minimum amount of time that a dynamic configuration instance can remain idle before the runtime considers it eligible for purging. The platform expires purges expired instances as needed to free resources.  |  |
|===

==== Connection Types
[[config_connection]]
===== Connection


====== Parameters
[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| URL a| String |  The region URL where the Queue resides. This URL can be obtained and configured from the Anypoint Platform &gt; MQ console. Copy/paste the region URL into this field." |  https://mq-us-east-1.anypoint.mulesoft.com/api/v1 |
| Client App ID a| String |  In Anypoint Platform &gt; MQ &gt; Client Apps, click an app name (or create a new app) and click Copy for the Client App ID field. Paste this value in the Studio Client App ID field |  | x
| Client Secret a| String |  In Anypoint Platform > MQ > Client Apps, click an app name (or create a new app) and click Copy for the Client Secret field. Paste this value in the Studio Client Secret field. |  | x
| TLS Context a| <<Tls>> |  |  |
| Host a| String |  Host where the proxy requests is sent. |  |
| Port a| Number |  Port where the proxy requests is sent. |  |
| Username a| String |  The username to authenticate against the proxy. |  |
| Password a| String |  The password to authenticate against the proxy. |  |
| Send Buffer Size a| Number |  The size of the buffer (in bytes) used when sending data, set on the socket itself. |  |
| Receive Buffer Size a| Number |  The size of the buffer (in bytes) used when receiving data |  |
| Client Timeout a| Number |  This sets the SO_TIMEOUT value on sockets. Indicates the amount of time (in milliseconds) that the socket will wait in a blocking operation before failing.  A value of 0 (the default) means waiting indefinitely. |  |
| Send TCP With No Delay a| Boolean |  If set, transmitted data is not collected together for greater efficiency but sent immediately.  Defaults to true even though Socket default is false because optimizing to reduce amount of network traffic over latency is hardly ever a concern today. |  true |
| Linger a| Number |  This sets the SO_LINGER value. This is related to how long (in milliseconds) the socket will take to close so that any remaining data is transmitted correctly. |  |
| Keep Alive a| Boolean |  Enables SO_KEEPALIVE behavior on open sockets. This automatically checks socket connections that are open but unused for long periods and closes them if the connection becomes unavailable.  This is a property on the socket itself and is used by a server socket to control whether connections to the server are kept alive before they are recycled. |  false |
| Connection Timeout a| Number |  Number of milliseconds to wait until an outbound connection to a remote server is successfully created, before failing with a timeout. Defaults to 30 seconds. |  30000 |
| Reconnection a| <<Reconnection>> |  When the application is deployed, a connectivity test is performed on all connectors. If set to true, deployment fails if the test doesn't pass after exhausting the associated reconnection strategy. |  |
|===

== Supported Operations
* <<ack>>
* <<consume>>
* <<nack>>
* <<publish>>

==== Associated Sources
* <<subscriber>>


== Operations

[[ack]]
=== Ack
`<anypoint-mq:ack>`


Executes an Acknowledgment indicating that the message has been consumed correctly and deletes the message from In Flight status.


==== Parameters
[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| Configuration | String | Name of the configuration to use. | | x
| Ack Token a| String |  The `ackToken` of the message, which was received when message was consumed. `ackToken` will only be created when acknowledgmentMode="MANUAL" is used. |  | x
| Reconnection Strategy a| * <<reconnect>>
* <<reconnect-forever>> |  A retry strategy in case of connectivity errors |  |
|===


==== For Configurations
* <<config>>

==== Throws
* ANYPOINT-MQ:ACKING
* ANYPOINT-MQ:CONNECTIVITY
* ANYPOINT-MQ:DESTINATION_NOT_FOUND
* ANYPOINT-MQ:RETRY_EXHAUSTED


[[consume]]
=== Consume
`<anypoint-mq:consume>`


==== Parameters
[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| Configuration | String | Name of the configuration to use. | | x
| Queue a| String |  Queue or Exchange name from which to fetch a Message |  | x
| Acknowledgment Mode a| Enumeration, one of:

** IMMEDIATE
** MANUAL |  Acknowledgment mode to use for the messages retrieved. |  IMMEDIATE |
| Acknowledgment Timeout a| Number |  Duration that a message is held by a consumer waiting for an Acknowledgment or Not Acknowledgment. After that duration elapses, the message is again available to any consumer. |  0 |
| Acknowledgment Timeout Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  Time unit to use in the acknowledgmentTimeout configuration |  MILLISECONDS |
| Polling Time a| Number |  How much time to be waited if the requested messages are not ready to be consumed. |  10000 |
| Polling Time Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  Time unit to use in the pollingTime configuration |  MILLISECONDS |
| Output Mime Type a| String |  The mime type of the operation output. |  |
| Output Encoding a| String |  The encoding of the operation output. |  |
| Streaming Strategy a| * <<repeatable-in-memory-stream>>
* <<repeatable-file-store-stream>>
* non-repeatable-stream |  Specifies to use repeatable streams. |  |
| Target Variable a| String |  Name of a variable to store the operation's output. |  |
| Target Value a| String |  An expression to evaluate against the operation's output and store the expression outcome in the target variable |  #[payload] |
| Reconnection Strategy a| * <<reconnect>>
* <<reconnect-forever>> |  A retry strategy in case of connectivity errors |  |
|===

==== Output
[%autowidth.spread]
|===
|Type |Binary
| Attributes Type a| <<AnypointMQMessageAttributes>>
|===

==== For Configurations
* <<config>>

==== Throws
* ANYPOINT-MQ:ACKING
* ANYPOINT-MQ:CONSUMING
* ANYPOINT-MQ:CONNECTIVITY
* ANYPOINT-MQ:TIMEOUT
* ANYPOINT-MQ:DESTINATION_NOT_FOUND
* ANYPOINT-MQ:RETRY_EXHAUSTED


[[nack]]
=== Nack
`<anypoint-mq:nack>`


Executes an Not Acknowledgment and change the status of the message from In Flight to In Queue to be consumed again for a subscriber


==== Parameters
[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| Configuration | String | Name of the configuration to use. | | x
| Ack Token a| String |  The `ackToken` of the message, which was received when message was consumed. `ackToken` will only be created when acknowledgmentMode="MANUAL" is used. |  | x
| Reconnection Strategy a| * <<reconnect>>
* <<reconnect-forever>> |  A retry strategy in case of connectivity errors |  |
|===


==== For Configurations
* <<config>>

==== Throws
* ANYPOINT-MQ:NACKING
* ANYPOINT-MQ:CONNECTIVITY
* ANYPOINT-MQ:DESTINATION_NOT_FOUND
* ANYPOINT-MQ:RETRY_EXHAUSTED


[[publish]]
=== Publish
`<anypoint-mq:publish>`


==== Parameters
[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| Configuration | String | Name of the configuration to use. | | x
| Destination a| String |  Queue or Exchange name from which to fetch a Message |  | x
| Output Mime Type a| String |  The mime type of the operation output. |  |
| Output Encoding a| String |  The encoding of the operation output. |  |
| Streaming Strategy a| * <<repeatable-in-memory-stream>>
* <<repeatable-file-store-stream>>
* non-repeatable-stream |  Specifies to use repeatable streams. |  |
| Body a| Binary |  The body of the outgoing MQ Message, sent as a String as part of a JSON message. Any content that is published needs to be serializable to a String format that can be later deserialized from. One way to do so is to serialize the published Object to its JSON representation, which can be serialized/deserialized from a String easily. Sending Objects that don't have a proper string serialization will cause the message to be unreadable on the receiving end. |  #[payload] |
| User Properties a| Object |  The custom user properties that should be set to this Anypoint MQ Message |  |
| Message Id a| String |  A custom ID for the outgoing Anypoint MQ Message. This value must be a proper UID for the message to avoid delivery problems. If absent, the broker will create one UUID for each message. |  |
| Send Content-Type a| Boolean |  Set to true if the body type should be sent as a Anypoint MQ Message property |  true |
| Target Variable a| String |  Name of a variable to store the operation's output. |  |
| Target Value a| String |  An expression to evaluate against the operation's output and store the expression outcome in the target variable |  #[payload] |
| Reconnection Strategy a| * <<reconnect>>
* <<reconnect-forever>> |  A retry strategy in case of connectivity errors |  |
|===

==== Output
[%autowidth.spread]
|===
|Type |Binary
| Attributes Type a| <<AnypointMQMessagePublishAttributes>>
|===

==== For Configurations
* <<config>>

==== Throws
* ANYPOINT-MQ:PUBLISHING
* ANYPOINT-MQ:CONNECTIVITY
* ANYPOINT-MQ:ILLEGAL_BODY
* ANYPOINT-MQ:DESTINATION_NOT_FOUND
* ANYPOINT-MQ:RETRY_EXHAUSTED


== Sources

[[subscriber]]
=== Subscriber
`<anypoint-mq:subscriber>`


Anypoint MQ Subscriber Message Source retrieves messages from the given destination name.


==== Parameters
[%header%autowidth.spread]
|===
| Name | Type | Description | Default Value | Required
| Configuration | String | Name of the configuration to use. | | x
| Queue a| String |  Name of the Queue from which messages will be retrieved. |  | x
| Subscriber Type a| One of:

* <<polling>>
* <<prefetch>> |  The strategy to use when subscribing for messages from the service |  |
| Acknowledgment Mode a| Enumeration, one of:

** IMMEDIATE
** AUTO
** MANUAL |  Acknowledgment mode to use for the messages retrieved. |  AUTO |
| Acknowledgment Timeout a| Number |  The default acknowledgmentTimeout for all the subscribers, unless it is overridden. Duration that a message is held by a broker waiting for an Acknowledgment or Not Acknowledgment. After that duration elapses, the message is again available to any subscriber. |  0 |
| Acknowledgment Timeout Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS |  Time unit to use in the acknowledgmentTimeout configuration |  MILLISECONDS |
| Circuit Breaker a| <<circuitBreaker>> |  |  |
| Output Mime Type a| String |  The mime type of the operation output. |  |
| Output Encoding a| String |  The encoding of the operation output. |  |
| Primary Node Only a| Boolean |  Whether this source should only be executed on the primary node when running in Cluster |  |
| Streaming Strategy a| * <<repeatable-in-memory-stream>>
* <<repeatable-file-store-stream>>
* non-repeatable-stream |  Specifies to use repeatable streams. |  |
| Redelivery Policy a| <<RedeliveryPolicy>> |  Defines a policy for processing redelivery of the message. |  |
| Reconnection Strategy a| * <<reconnect>>
* <<reconnect-forever>> |  A retry strategy in case of connectivity errors |  |
|===

==== Output
[%autowidth.spread]
|===
|Type |Binary
| Attributes Type a| <<AnypointMQMessageAttributes>>
|===

==== For Configurations
* <<config>>



== Types
[[Tls]]
=== Tls

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Enabled Protocols a| String | A comma-separated list of protocols enabled for this context. |  |
| Enabled Cipher Suites a| String | A comma-separated list of cipher suites enabled for this context. |  |
| Trust Store a| <<TrustStore>> |  |  |
| Key Store a| <<KeyStore>> |  |  |
| Revocation Check a| * <<standard-revocation-check>>
* <<custom-ocsp-responder>>
* <<crl-file>> |  |  |
|===

[[TrustStore]]
=== Trust Store

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Path a| String | The location (which will be resolved relative to the current classpath and file system, if possible) of the trust store. |  |
| Password a| String | The password used to protect the trust store. |  |
| Type a| String | The type of store used. |  |
| Algorithm a| String | The algorithm used by the trust store. |  |
| Insecure a| Boolean | If true, no certificate validations will be performed, rendering connections vulnerable to attacks. Use at your own risk. |  |
|===

[[KeyStore]]
=== Key Store

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Path a| String | The location (which will be resolved relative to the current classpath and file system, if possible) of the key store. |  |
| Type a| String | The type of store used. |  |
| Alias a| String | When the key store contains many private keys, this attribute indicates the alias of the key that should be used. If not defined, the first key in the file will be used by default. |  |
| Key Password a| String | The password used to protect the private key. |  |
| Password a| String | The password used to protect the key store. |  |
| Algorithm a| String | The algorithm used by the key store. |  |
|===

[[standard-revocation-check]]
=== Standard Revocation Check

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Only End Entities a| Boolean | Only verify the last element of the certificate chain. |  |
| Prefer Crls a| Boolean | Try CRL instead of OCSP first. |  |
| No Fallback a| Boolean | Do not use the secondary checking method (the one not selected before). |  |
| Soft Fail a| Boolean | Avoid verification failure when the revocation server can not be reached or is busy. |  |
|===

[[custom-ocsp-responder]]
=== Custom Ocsp Responder

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Url a| String | The URL of the OCSP responder. |  |
| Cert Alias a| String | Alias of the signing certificate for the OCSP response (must be in the trust store), if present. |  |
|===

[[crl-file]]
=== Crl File

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Path a| String | The path to the CRL file. |  |
|===

[[Reconnection]]
=== Reconnection

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Fails Deployment a| Boolean | When the application is deployed, a connectivity test is performed on all connectors. If set to true, deployment fails if the test doesn't pass after exhausting the associated reconnection strategy. |  |
| Reconnection Strategy a| * <<reconnect>>
* <<reconnect-forever>> | The reconnection strategy to use. |  |
|===

[[reconnect]]
=== Reconnect

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Frequency a| Number | How often in milliseconds to reconnect. | |
| Count a| Number | How many reconnection attempts to make. | |
| blocking |Boolean |If false, the reconnection strategy runs in a separate, non-blocking thread. |true |
|===

[[reconnect-forever]]
=== Reconnect Forever

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Frequency a| Number | How often in milliseconds to reconnect. | |
| blocking |Boolean |If false, the reconnection strategy runs in a separate, non-blocking thread. |true |
|===

[[ExpirationPolicy]]
=== Expiration Policy

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Max Idle Time a| Number | A scalar time value for the maximum amount of time a dynamic configuration instance should be allowed to be idle before it's considered eligible for expiration |  |
| Time Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS | A time unit that qualifies the maxIdleTime attribute |  |
|===

[[AnypointMQMessageAttributes]]
=== Anypoint MQ Message Attributes

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Destination a| String | The destination the message belongs to. |  | x
| Headers a| Object | The headers of the message. |  | x
| Properties a| Object | The properties of the message. |  | x
| Message Id a| String | The ID of the message. |  | x
| Delivery Count a| Number | The number of times the message was delivered. |  | x
| Content Type a| String | The content type of the message body |  |
| Ack Token a| String | The acknowledgment token of the message, passed to Ack/Nack operations to perform ack/nack manually.
 This token will be present only when MANUAL ACK mode is used. |  |
|===

[[circuitBreaker]]
=== Circuit Breaker

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| On Error Types a| String | The error types whose occurrence during the flow execution will count as a failure in the circuit.
 Error counts only when the flow finishes with an error propagation.
 By default all the errors will count as a failure. |  |
| Errors Threshold a| Number | How many errors, of those considered by this circuit, have to occur for the circuit to be opened. |  | x
| Trip Timeout a| Number | How long will the circuit remain open once the errorsThreshold is reached |  | x
| Trip Timeout Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS | The time unit bound to the tripTimeout | MILLISECONDS |
|===

[[repeatable-in-memory-stream]]
=== Repeatable In Memory Stream

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Initial Buffer Size a| Number | The amount of memory that will be allocated to consume the stream and provide random access to it. If the stream contains more data than can be fit into this buffer, then the buffer expands according to the bufferSizeIncrement attribute, with an upper limit of maxInMemorySize. |  |
| Buffer Size Increment a| Number | This is by how much the buffer size expands if it exceeds its initial size. Setting a value of zero or lower means that the buffer should not expand, meaning that a STREAM_MAXIMUM_SIZE_EXCEEDED error is raised when the buffer gets full. |  |
| Max Buffer Size a| Number | The maximum amount of memory to use. If more than that is used then a STREAM_MAXIMUM_SIZE_EXCEEDED error is raised. A value lower than or equal to zero means no limit. |  |
| Buffer Unit a| Enumeration, one of:

** BYTE
** KB
** MB
** GB | The unit in which all these attributes are expressed |  |
|===

[[repeatable-file-store-stream]]
=== Repeatable File Store Stream

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Max In Memory Size a| Number | Defines the maximum memory that the stream should use to keep data in memory. If more than that is consumed then it will start to buffer the content on disk. |  |
| Buffer Unit a| Enumeration, one of:

** BYTE
** KB
** MB
** GB | The unit in which maxInMemorySize is expressed |  |
|===

[[RedeliveryPolicy]]
=== Redelivery Policy

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Max Redelivery Count a| Number | The maximum number of times a message can be redelivered and processed unsuccessfully before triggering process-failed-message |  |
| Use Secure Hash a| Boolean | Whether to use a secure hash algorithm to identify a redelivered message. |  |
| Message Digest Algorithm a| String | The secure hashing algorithm to use. If not set, the default is SHA-256. |  |
| Id Expression a| String | Defines one or more expressions to use to determine when a message has been redelivered. This property may only be set if useSecureHash is false. |  |
| Object Store a| Object Store | The object store where the redelivery counter for each message is going to be stored. |  |
|===

[[AnypointMQMessagePublishAttributes]]
=== Anypoint MQ Message Publish Attributes

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Message Id a| String | The ID of the message that was published. |  | x
|===

[[polling]]
=== Polling

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Scheduling Strategy a| scheduling-strategy | The scheduling strategy to use for triggering the message fetch from the service. |  | x
|===

[[prefetch]]
=== Prefetch

[%header%autowidth.spread]
|===
| Field | Type | Description | Default Value | Required
| Max Buffer Size a| Number | The maximum number of messages to be pre-fetched from the service and kept locally before dispatching to the flow. | 30 |
|===
