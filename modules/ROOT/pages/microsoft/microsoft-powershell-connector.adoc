= Microsoft Windows PowerShell Connector - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]

Support Category: https://www.mulesoft.com/legal/versioning-back-support-policy#anypoint-connectors[Select]

Microsoft PowerShell Connector Version 2.0

Anypoint Connector for Microsoft Windows PowerShell (PowerShell Connector) enables you to integrate Windows administration tasks into Mule applications. PowerShell Connector enables you to connect to any machine, local or remote, to execute script files and commands on those machines. You can use SSH to execute PowerShell scripts on a remote Windows or Linux (Ubuntu) machine and have the result processed within Mule runtime engine (Mule).

NOTE: The connector does not support executing a PowerShell script on a MacOS computer. 

For information about compatibility and fixed issues, see xref:release-notes::connector/microsoft-powershell-connector-release-notes-mule-4.adoc[Microsoft Powershell Connector Release Notes].

== Prerequisites

To use this connector, you must be familiar with:

* Anypoint Connectors
* Mule runtime engine (Mule)
* Elements in a Mule flow
* Global elements
* How to create a Mule app using Design Center or Anypoint Studio

To work with PowerShell Connector, you must first install an SSH server on a Windows or Linux (Ubuntu) remote machine:

* Windows +
. Download https://github.com/PowerShell/Win32-OpenSSH/releases[OpenSSH for Win32 or Win64].
. Follow the https://github.com/PowerShell/Win32-OpenSSH/wiki/Install-Win32-OpenSSH[OpenSSH installation steps].
* Linux (Ubuntu) +
. Follow the https://help.ubuntu.com/lts/serverguide/openssh-server.html[SSH installation steps]. 
. Follow https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell-core-on-linux?view=powershell-6[install PowerShell on Linux] from Microsoft.

== Add a POM File Dependency

[source,xml,linenums]
----
<dependency>
  <groupId>com.mulesoft.connectors</groupId>
  <artifactId>mule-powershell-connector</artifactId>
  <version>x.x.x</version>
  <classifier>mule-plugin</classifier>
</dependency>
----

Verify that the connector `version` corresponds to the one you are using. 

To obtain the most up-to-date `pom.xml` file information:

. Go to https://www.mulesoft.com/exchange/[Anypoint Exchange].
. In Exchange, click *Login* and supply your Anypoint Platform username and password.
. In Exchange, search for `hdfs`.
. Click *Dependency Snippets*.

=== Connect in Anypoint Design Center

. Click a trigger. 
+
You can use an HTTP Listener to receive input from HTTP, or use another component, such as a Scheduler when you want an action to be triggered at a specified time.
. Select the connector as a component:
+
image::microsoft/microsoft-powershell-find-connector.png[PowerShell Connector find the connector]
+
. Select an operation:
+
image::microsoft/microsoft-powershell-choose-operation.png[PowerShell Connector choose operation]
+
. Set up a Windows or Linux PowerShell configuration:
+
image::microsoft/microsoft-powershell-choose-configuration.png[PowerShell Connector choose configuration]
+
.. Set up PowerShell Linux configuration:
+
image::microsoft/microsoft-powershell-linux-configuration.png[PowerShell Connector Linux configuration]
+
.. Set up PowerShell Windows configuration:
+
image::microsoft/microsoft-powershell-windows-configuration.png[PowerShell Connector Windows configuration]
+
[%header,cols="30s,70a"]
|===
|Fields|Description
|Configuration|PowerShell
2+|Connection
|Connection Type|Choose Windows or Linux
|IPAddress| IP address of the computer to which you want to connect
|User Name| User name required to authenticate through SSH
|Password | Password associated with the user name
|===
+
To make a simple flow, select these operations:
+
* *Execute command* operation:
+
image::microsoft/microsoft-powershell-execute-command-dc.png[PowerShell Connector Execute Command]
+
. PowerShell *Execute command* operation configuration:
+
image::microsoft/microsoft-powershell-execute-command-config.png[PowerShell Connector action Execute Command]
+
[%header,cols="30s,70a"]
|===
|Fields |Description
|Command |Command that can execute on the client machine.
|===

== Add the Connector in Studio

Add PowerShell Connector to a Mule project to automatically populate the XML code with the connector's namespace and schema location, as well as add the required dependencies to the project's `pom.xml` file.

. In Anypoint Studio, from the main menu, select *File > New > Mule Project*.
. Enter a name for your Mule project, and click *Finish*.
. In the *Mule Palette* view, click *(X) Search in Exchange*.
. In *Add Modules to Project*, type `powershell` in the search field.
. Click the name of the connector in *Available modules*.
. Click *Add*.
. Click *Finish*.

Adding a connector to a Mule project in Studio does not make that same connector available to other projects in your Studio workspace.

=== Configure a Global Element in Studio

. In Studio, click the *Global Elements* tab at the bottom of the canvas.
. In the *Global Configuration Elements* screen, click *Create*:
+
image::microsoft/microsoft-powershell-config-global-wizard.png[Global Configuration Elements Wizard]
+
. In the *Choose Global Type* wizard, expand *Connector Configuration*, select either *Windows Configuration* or *Linux Configuration*, and click *OK*.
+
This selection enables you to connect remotely to the type of operating system that you choose.
+
. Configure the parameters as follows:
+
[%header,cols="30s,70a"]
|===
|Parameter|Description
|Connection | Connection type: Windows or Linux
|IP Address | IP address of the machine on which you want to execute the script file or command
|Username | User associated with the Windows or Linux machine
|Password | Password associated with the user name
|===
+
In the previous image, the placeholder values refer to a configuration file `mule-artifact.properties` placed in the `src/main/resources` folder of your project. +
You can enter your credentials in the global configuration properties, or you can reference a configuration file that contains those values. 
+
To simplify maintenance and improve project reusability, of your project, use a configuration file. Keeping these values in a separate file is useful if you need to deploy to different environments, such as production, development, and QA, where your access credentials differ.
+
See xref:introduction/intro-connector-configuration-overview.adoc[Anypoint Connector Configuration] for more information.
+
. Keep the *Advanced* tab default values.
. Click *Test Connection*.
. Click *OK*.
. Your configuration should look like this:
+
image::microsoft/microsoft-powershell-config.png[powershell use case config]


== Use Case: Execute Command

This Mule flow executes a command on a remote Windows machine.

image::microsoft/microsoft-powershell-execute-command.png[Executing a command]

. Create a new Mule project in Anypoint Studio.
. Add the following properties to the mule-artifact.properties file to hold your PowerShell credentials and place the properties file in the project's src/main/resources directory.
+
[source,text,linenums]
----
config.host=<IpAddress>
config.username=<UserName>
config.password=<Password>
----
+
. Drag an HTTP Listener component onto the canvas and configure the following parameters:
+
image::microsoft/microsoft-powershell-http-props.png[PowerShell HTTP configuration values]
+
[%header,cols="30s,70a"]
|===
|Parameter |Value
|Display Name |Listener
|Extension Configuration | Required if no previous HTTP Listener configuration was created:

. Click the image::microsoft/add-icon.png[] plus sign (+) to add a new HTTP Listener configuration.
. Set Host to `localhost` and Port to `8081`. 
. Click *OK*.
|Path |`/executecommand`
|===
+
. Drag the PowerShell Connector *Execute command* next to the HTTP Listener component.
. Add a new PowerShell global element to configure the PowerShell Connector.
.. Click the plus sign (+) next to the Connector Configuration field.
.. Configure the global element according to following table:
+
[%header,cols="30s,50a,20a"]
|===
|Parameter |Description|Value
|Name | Name by which to reference the configuration |<Configuration_Name>
|IP Address | IP address of the machine that you want to execute your script file or command |
|Username | User associated with the Windows or Linux machine |
|Password | Password associated with the user name |
|===
+
Your configuration should look like this:
+
image::microsoft/microsoft-powershell-config.png[PowerShell use case config]
+
The corresponding XML configuration is:
+
[source,xml,linenums]
----
<powershell:config name="Powershell_Configuration"
  doc:name="PowerShell Configuration">
<powershell:windows-connection 
	host="${config.host}"
	username="${config.username}" 
	password="${config.password}" />
</powershell:config>
----
+
. Click *Test Connection*.
. If the test is successful, click *OK*; if not, review and correct any incorrect parameters and test the connection again.
. Drag the *Execute command* operation of the PowerShell Connector next to the HTTP Listener component. 
. In the *General* properties editor of the PowerShell *Execute command* operation, configure the remaining parameters:
+
[%header,cols="30s,70a"]
|===
|Parameter |Value
|Display Name |Execute Command (or any other name you prefer)
|Command | Command you want to execute on the remote or local machine
|===
+
image::microsoft/microsoft-powershell-execute-command-props.png[Publish message connector props]
+
. Verify that your XML looks like this:
+
[source,xml,linenums]
----
<powershell:execute-command 
	doc:name="Execute command"
	config-ref="Powershell_Configuration" 
	command="ipconfig"/>
----
+
. Add a *Logger* component after the Execute Command operation to display the output in the Mule console. 
. Configure the *Logger* according to the following table:
+
[%header,cols="30s,70a"]
|===
|Parameter |Value
|Display Name |Logger (or any other name you prefer)
|Message |`#[payload]`
|Level |INFO
|===
+
image::microsoft/microsoft-powershell-logger-props.png[PowerShell logger]
+
. Click *File > Save*.
. Right-click the project in Package Explorer and click *Run As > Mule Application*.
. Open a browser and check the response after entering the URL `+http://localhost:8081/executescriptfile+`. 
+
You should see output of the Execute Command operation in the browser and the console.

== Use Case: Execute Script File

image::microsoft/microsoft-powershell-execute-script-file-flow.png[Execute Script File Studio icons]

To create:

. Drag an HTTP Listener component onto the canvas and configure the following parameters:
+
image::microsoft/microsoft-powershell-http-execute-script-file.png[PowerShell HTTP config props]
+
[%header,cols="30s,70a"]
|===
|Parameter | Value
|Display Name | Listener
|Extension Configuration | Required if no previous HTTP Listener configuration was created:

. Click the plus sign (+) to add a new HTTP Listener configuration.
. Set Host to `localhost` and Port to `8081`. 
. Click *OK*.
|Path | /executescriptfile
|===
+
. Drag a Parse Template component next to the HTTP Listener.
. Configure the following parameters:
+
image::microsoft/microsoft-powershell-parse-template-props.png[PowerShell HTTP config props]
+
[%header,cols="30s,70a"]
|===
|Parameter | Value
|Display Name | Parse Template
|Location | The location of the file that you want to execute
|===
+
. Drag the *Execute script file* operation of the PowerShell Connector next to the Parse Template component. 
. In the *General* properties editor of the PowerShell *Execute script file* operation, configure the remaining parameters:
+
[%header,cols="30s,70a"]
|===
|Parameter |Value
|Display Name |Execute script file (or any other name you prefer)
|File content |`#[payload]` - The file content comes from payload
|Parameters | If your script needs parameters, add parameters for each key and value pair
|===
+
image::microsoft/microsoft-powershell-execute-script-file.png[Publish message connector properties]
+
. Verify that your XML looks like this:
+
[source,xml]
----
<powershell:execute-script-file doc:name="Execute script file"
 config-ref="Powershell_Configuration">
	<powershell:parameters >
		<powershell:parameter key="a" value="5" />
		<powershell:parameter key="b" value="10" />
		<powershell:parameter key="c" value="15" />
	</powershell:parameters>
</powershell:execute-script-file>
----
+
. Add a Logger component after *Execute script file* operation to display output in the Studio console. 
. Configure the Logger as follows:
+
[%header,cols="30s,70a"]
|===
|Parameter |Value
|Display Name |Logger (or any other name you prefer)
|Message |`#[payload]`
|Level |INFO
|===
+
image::microsoft/microsoft-powershell-logger-props.png[PowerShell logger]
+
. Click *File > Save*. 
. In *Package Explorer*, right-click the project and then click *Run As > Mule Application*.
. Open a browser and check the response after entering the URL `+http://localhost:8081/executescriptfile+`. +
You should see the operation's output in the browser and the console.

== Use Case: XML

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:powershell="http://www.mulesoft.org/schema/mule/powershell"
xmlns:http="http://www.mulesoft.org/schema/mule/http"
xmlns="http://www.mulesoft.org/schema/mule/core"
xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core
http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http
http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/powershell
http://www.mulesoft.org/schema/mule/powershell/current/mule-powershell.xsd">

    <configuration-properties file="mule-artifact.properties"/>

	<powershell:config name="PowerShell_Configuration" doc:name="PowerShell Configuration">
		<powershell:windows-connection 
			host="${config.host}" 
			username="${config.username}" 
			password="${config.password}" />
	</powershell:config>
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config"\>
		<http:listener-connection host="localhost" port="8081" />
	</http:listener-config>
	<flow name="Execute-Command-Flow" />
		<http:listener doc:name="Listener" 
			config-ref="HTTP_Listener_config"
			path="/executecommand"/>
		<powershell:execute-command doc:name="Execute command"
		  config-ref="PowerShell_Configuration" command="ipconfig"/>
		<logger level="INFO" doc:name="Logger" message="#[payload]"/>
	</flow>
	<flow name="Execute-Script-File-Flow">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config"
		path="/executescriptfile"/>
		<parse-template doc:name="Parse Template"
		location="/home/me/get-en-param.ps1"/>
		<powershell:execute-script-file doc:name="Execute script file"
		 config-ref="Powershell_Configuration">
			<powershell:parameters >
				<powershell:parameter key="a" value="5" />
				<powershell:parameter key="b" value="10" />
				<powershell:parameter key="c" value="15" />
			</powershell:parameters>
		</powershell:execute-script-file>
		<logger level="INFO" doc:name="Logger" message="#[payload]"/>
	</flow>
</mule>
----

== See Also

* xref:introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* xref:introduction/intro-connector-configuration-overview.adoc[Anypoint Connector Configuration]
* xref:introduction/intro-config-use-studio.adoc[Use Studio to Configure a Connector]
* xref:introduction/intro-config-use-fd.adoc[Use Flow Designer to Configure a Connector]
* https://www.mulesoft.com/exchange/com.mulesoft.connectors/mule-powershell-connector/[Microsoft Windows PowerShell Connector]
* https://github.com/PowerShell/Win32-OpenSSH/releases#[OpenSSH for Windows]
* https://github.com/PowerShell/Win32-OpenSSH/wiki/Install-Win32-OpenSSH[OpenSSH installation steps]
* https://help.ubuntu.com/lts/serverguide/openssh-server.html[Linux install SSH]
* https://help.mulesoft.com[MuleSoft Help Center]
