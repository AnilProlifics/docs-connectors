= Slack Connector 1.0 Examples - Mule 4

== Example: Find User By Email

This example retrieves a single user by looking them up by their registered email address. Requires scope `users:read.email` both on the connection configuration and on the Slack application.

== Find User By Email Studio Flow

* Listener (HTTP) - Accepts data from HTTP requests.
* Slack Connector - Connects with Slack and executes a query to retrieve user details for the specified email address.
* Transform message - Outputs the results of the `Find User By Email` operation in JSON format.
* Logger - Logs the result to the console.
+
image::slack-1-find-user-by-email-studio-use-case.png[studio_use_case]

== Example: Send Message To Channel

This example posts a message to a public channel, private channel, or direct message/IM channel. Requires scopes `chat:write` `chat:write:user` `chat:write:bot` both on the connection configuration and on the Slack application.

== Find User By Email Studio Flow

* Listener (HTTP) - Accepts data from HTTP requests.
* Transform message - Provides content (message details) for the `Send Message` operation.
* Slack Connector - Connects with Slack and posts a message to an existing channel.
* Transform message - Outputs the results of the `Send Message` operation in JSON format.
* Logger - Logs the result to the console.
+
image::slack-1-send-message-studio-use-case.png[studio_use_case]

== XML Flows

Paste this XML code into Anypoint Studio to experiment with the flows described in the previous section.

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:slack="http://www.mulesoft.org/schema/mule/slack"
	xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/slack http://www.mulesoft.org/schema/mule/slack/current/mule-slack.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	<slack:config name="Slack_Connector_Config" doc:name="Slack Connector Config" doc:id="bf65753c-6e76-4ddc-888e-a2032e64613b" >
		<slack:slack-auth-connection >
			<slack:oauth-authorization-code consumerKey="${consumer.key}" consumerSecret="${consumer.secret}" scopes="channels:write groups:write im:write mpim:write users:read.email "/>
			<slack:oauth-callback-config listenerConfig="HTTP_Listener_config" callbackPath="/callback" authorizePath="/authorize" externalCallbackUrl="http://localhost:8081/callback"/>
		</slack:slack-auth-connection>
	</slack:config>
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="739b6c08-0e6b-416a-9888-7a8ad4918d2e" >
		<http:listener-connection host="0.0.0.0" port="8081" />
	</http:listener-config>
	<configuration-properties doc:name="Configuration properties" doc:id="0252219a-f797-482f-8c04-440115b82bc4" file="application.properties" />
	<flow name="find-user-by-email-flow" doc:id="6f85a088-7469-4b0c-9453-307238ab1eea" >
		<http:listener doc:name="Listener" doc:id="f88ae414-05a0-47c4-8a9a-a63918eb4be9" config-ref="HTTP_Listener_config" path="find-by-email"/>
		<slack:get-userslookup-by-email doc:name="Find User by Email" doc:id="4b7dc5a2-316d-49ba-9bb9-c746182faf0d" config-ref="Slack_Connector_Config" email="example@emailaddress.com"/>
		<ee:transform doc:name="Payload as Json" doc:id="925f7a13-520e-4043-bf97-b825c9f87e6d" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Lookup Result" doc:id="c532fa79-ef7e-4ae3-88cc-d0d769e478ff" message="#[payload]"/>
	</flow>
  <flow name="send-message-to-channel-flow" doc:id="5c2354c1-16df-4b56-9248-d43e541217d2" >
		<http:listener doc:name="Listener" doc:id="c5ae59fd-0c68-4ac7-9a32-2d590955038e" config-ref="HTTP_Listener_config" path="/send-message"/>
		<ee:transform doc:name="Message Details" doc:id="2ca18e59-5484-4997-bbe7-62f1f6c2d640" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	channel: "your-existing-channel",
	text: "Your text goes here"
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<slack:create-chatpost-message doc:name="Send Message" doc:id="e09a0f1e-3082-4263-be94-3d01d6460043" config-ref="Slack_Connector_Config"/>
		<ee:transform doc:name="Payload as Json" doc:id="7c490195-89b3-4da8-a7ea-672f54563c6f">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Result" doc:id="7236a860-530e-48da-9c15-e8d112e19399" message="#[payload]"/>
	</flow>
</mule>

----

== See Also

* xref:connectors::introduction/introduction-to-anypoint-connectors.adoc[Introduction to Anypoint Connectors]
* https://help.mulesoft.com[MuleSoft Help Center]
