= Microsoft Outlook 365 1.0 Examples - Mule 4

The following examples show how to perform operations that interact with messages,
events, and attachment resources in Microsoft Outlook 365 Connector:

* <<create-message>>
*
..

== Prerequisites

* Java 8 or 11
* Anypoint Studio 7.5 and later
* Mule runtime engine (Mule) 4.3.0 and later
* DataWeave

[NOTE]
Some operations need prerequisite data, for example, to get a message or
an event based on its ID, you must create a message or an event first.

[[create-message]]
== Create Message

This Mule flow creates a message to send later. The message is saved in the
Drafts folder.

Here is what each operation is doing:

* *HTTP Listener* +
Accepts data from HTTP requests
* *Transform Message* +
Transforms the HTTP input used to create a message
* *Create message* +
Creates a draft of the message
* *Transform Message* +
Outputs the results of the *Create message* operation in JSON format
* *Logger* +
Shows the HTTP response from the *Create message* operation

image::create-message.png[Studio Flow for Create Message]

=== XML for This Example

Paste this code into the Studio XML editor to quickly load the flow for this example into your Mule app:

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:tableau-specialist="http://www.mulesoft.org/schema/mule/tableau-specialist" xmlns:email="http://www.mulesoft.org/schema/mule/email"
	  xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	  xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:outlook365="http://www.mulesoft.org/schema/mule/outlook365" xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce" xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/outlook365 http://www.mulesoft.org/schema/mule/outlook365/current/mule-outlook365.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/email http://www.mulesoft.org/schema/mule/email/current/mule-email.xsd
http://www.mulesoft.org/schema/mule/tableau-specialist http://www.mulesoft.org/schema/mule/tableau-specialist/current/mule-tableau-specialist.xsd">
	<http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="7ca945b4-7657-4688-90bf-5b9b8aa9b78b" >
		<http:listener-connection host="0.0.0.0" port="8083" />
	</http:listener-config>

	<outlook365:outlook365-config name="outlook365_client_credentials" doc:name="Outlook365 Outlook365 Config" doc:id="1ae40dd0-f924-457e-b702-946d5e896ec2" >
		<outlook365:oauth-client-credentials-connection >
			<outlook365:oauth-client-credentials clientId="${oauth-client-credentials.clientId}" clientSecret="${oauth-client-credentials.clientSecret}" tokenUrl="${oauth-client-credentials.tokenUrl}" scopes="${oauth-client-credentials.scopes}" />
		</outlook365:oauth-client-credentials-connection>
	</outlook365:outlook365-config>

	<flow name="create-message" doc:id="e5a15ff1-0ded-45ae-9c20-bf71b3367edd" >
		<http:listener doc:name="Listener" doc:id="493d0ed4-3f5a-4777-ba2c-454e6e640461" path="/create-msg" config-ref="HTTP_Listener_config"/>
		<ee:transform doc:name="Transform Message" doc:id="47b52140-9bb6-4d15-9e4d-d480ebb3dcd8" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
 "subject":"Last night game - Test - Ignore please",
"importance":"Low",
"body":{
"contentType":"HTML",
"content":"They were <b>awesome</b>!"
},
"toRecipients":[
{
    "emailAddress":{
        "address":"muletest@mulesoft.com"
     }
},
{
    "emailAddress":{
        "address":"muletest@mulesoft.com"
     }
}
    ]
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<outlook365:create-message doc:name="Create message" doc:id="4723c105-b33b-40b7-a480-118e7b486f97" config-ref="outlook365_client_credentials" userId="88f176b2-84ca-4cfe-828c-954db0096efa">
		</outlook365:create-message>
		<ee:transform doc:name="Transform Message" doc:id="e23d752c-1c63-4c9b-b664-e94fa2f274fc" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Logger" doc:id="88008b17-7027-4142-a8e4-a2a59f949756" message="#[payload]"/>
	</flow>
</mule>
----

=== Steps for Running This Example

. Verify that your connector is configured.
. Save the project.
. From a web browser, test the application by entering `http://localhost:8083/create-msg`.
