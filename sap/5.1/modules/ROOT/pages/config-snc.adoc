= Configure an SNC Connection

== Prerequisites

* SAP GUI application, which you can download from the MuleSoft SAP Resource Center
* SAPCAR and SAP Cryptographic Libraries
+
If you are an S-User, download these libraries from the SAP Support Portal.
* Access to an SAP ECC instance that can use SNC system variables
* Access to the following transactions:
** STRUST (Trust Manager)
** SM30 (View Maintenance)

== Configure the Client Environment

Configure the system variables that depend on the operating system you are using, and generate the PSE (personal security environment):

. Enter the following command to open your cmd or terminal and unpack the SAP Cryptographic Library using the SAPCAR utility:
+
`SAPCAR –xvf <name_of_the_file.SAR>
+
. Configure the following environment variables: *(Do the variables vary by OS or are they the same and just configured differently?)*
** SNC_LIB
** SECUDIR = `<Path_to_library>`
** LD_LIBRARY_PATH = `<Path_to_library>\sapcrypto.dll`
** SSF_LIBRARY_PATH = `<Path_to_library>\sapcrypto.dll`
+
For Windows, the `sapcrypto.dll` 64bit version must be in another path and added to a new variable called SNC_LIB_64.
+
In your cmd or terminal, use the following command to create the PSE:
+
`sapgenpse gen_pse -v -p RFC.pse`
+
When you run this command, you must enter a password or PIN to use later and a distinguished name, which must be unique. You can check STRUST to see names that are already used.
+
. Enter this command to create the `cred_v2` file, which stores the credentials for the user who will access the PSE:
+
`sapgenpse seclogin -p RFC -O <user-credentials>`+
+
where `<user-credentials>` are the *username only?*
+
. Enter this command to export the client’s certificate from the PSE:
+
`sapgenpse export_own_cert –v –p RFC –o RFC_MULE.crt`
+
== Configure the SAP Server

Configure the import and export of certificates and the maintenance of tables that will authorize you to use SNC with your distinguished name.

=== Check Distinguished Names at STRUST

View the SAP distinguished name and list of added certificates:

. Log in to SAP and enter the `STRUST` transaction.
. Select the `SNC SAPCryptolib` folder.

=== Import and Export Certificates

After you generate your own certificate, you need to download the SAP instance certificate to link the certificate together.

. From the previous screenshot, click the glasses (first button on the left of the screen) to enable the edition mode, and then double click  `CN=SL-ABAP-IDP`.
. Click the download button at the bottom of the screen and Center file path.
. Click the import button to upload your certificate.
. Click *Add to Certificate  List *and save.
. Open a cmd or terminal and execute the following command:
+
sapgenpse maintain_pk -v -a name_of_SAP_Server_Certificate.crt -p name_of_your_PSE.pse'

=== Authorize the SNC Client in SAP

Add a new entry to the `VSNCSYSACL` table view, to enable your distinguished name to use SNC:

. Navigate to the *SM30* transaction and enter the view name.
. Select `E` as the work area.
. Add a new entry that associates your system ID and the SNC name with `p:<your-distinguished-name>.`
. Select all of the checkboxes to activate the entries.
. Click Save.
+
* If the server accepts the SNC name, it displays a `Canonical Name Determined` message on the SNC data box.
* If the server does not accept the SNC name, it displays a `Canonical Name Not Determined` message on the SNC data box.
+
To address this issue:
+
.. Navigate to the *SM30* transaction, specify the `VUSREXTID` view, and click Maintain*.
