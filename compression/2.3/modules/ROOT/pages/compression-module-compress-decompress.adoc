= Compressing and Decompressing a File



=== Content Compression

Given an input stream, the module compresses the stream and returns a new
compressed stream of bits so it can be stored in a file system or transferred
to another system.

==== Compressor Strategies

A Compressor strategy can compress a file or a single-entry archive.

===== GZip Compressor Strategy

When used in an operation, this strategy declares that the content should be
compressed with the `gzip` format.

[source, xml]
----
<compression:gzip-compressor/>
----

===== Zip Compressor Strategy

When used in an operation, this strategy declares that the content should be
compressed with the `zip` format.

[source, xml]
----
<compression:zip-compressor/>
----

==== Compress Operation

[source, xml]
----
<compression:compress>
   <compression:content>#[payload.data]</compression:content> // <1>
   <compression:compressor>
       <compression:zip-compressor/> // <2>
   </compression:compressor>
</compression:compress>
----

<1> The `InputStream` to be compressed. Defaults to `#[payload]`.
<2> Compressor strategy to be used.

==== Configure ZIP64 Compressor

The following example shows how to configure the *Force ZIP64* field to compress files and byte arrays greater than 4 GBs:

. In Studio, select the Compression module *Compress* operation from your flow.
. Set *Compressor* to *Zip compressor*.
. Select *Force ZIP64*.

image::compression-zip64-compressor.png[Force ZIP64 field selected]

In the *Configuration XML* editor, the `forceZip64` parameter looks like this:


[source, xml]
----
<compression:compress doc:name="Compress">
       <compression:compressor >
	<compression:zip-compressor forceZip64="true"/>
     </compression:compressor>
</compression:compress>
----

==== Compression Errors

If an error occurs while compressing the content, a
`COMPRESSION:COULD_NOT_COMPRESS` error is thrown.

== Content Decompression

Decompresses single-entry compressed content, which is assumed to be an archive
in the specified compression format.

=== Decompressor Strategies

A Decompressor strategy knows how to decompress a file or a single-entry archive.

==== GZip Decompressor Strategy

When used in an operation, this strategy declares that the content should be
decompressed with the `gzip` format.

[source, xml]
----
<compression:gzip-decompressor/>
----

==== Zip Decompressor Strategy

When used in an operation, this strategy declares that the content should be
decompressed with the `zip` format.

[source, xml]
----
<compression:zip-decompressor/>
----

=== Decompress Operation

[source, xml, linenums]
----
<compression:decompress>
   <compression:content>#[payload]</compression:content> // <1>
   <compression:decompressor>
       <compression:gzip-decompressor/> // <2>
   </compression:decompressor>
</compression:decompress>
----

<1> The `InputStream` to be decompressed. Defaults to `#[payload]`.
<2> Decompressor strategy to be used.

==== Decompression Errors

If the given content does not match the format of the configured strategy, a
`COMPRESSION:INVALID_ARCHIVE` error will be thrown.

If the archive to be decompressed has more than one entry, this operation will
fail with a `COMPRESSION:TOO_MANY_ENTRIES` error, because it will not be able
to choose only one entry to return. For these cases, you should use the
Extract operation.