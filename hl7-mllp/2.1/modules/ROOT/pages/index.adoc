= HL7 MLLP Connector 2.1 - Mule 4
:page-aliases: connectors::hl7/hl7-mllp-connector.adoc

Support Category: https://www.mulesoft.com/legal/versioning-back-support-policy#anypoint-connectors[Premium]

Anypoint Connector HL7 Minimal Lower Layer Protocol (MLLP) Connector (HL7 MLLP) provides connectivity and parsing functionality for HL7 MLLP messages.

For compatibility information and fixed issues, see the HL7 MLLP Connector Release Notes.

== Prerequisites

To use this connector, you must be familiar with:

* Anypoint Connectors

* Mule runtime engine (Mule)

* Elements and global elements in a Mule flow

* Creating a Mule app using Anypoint Studio (Studio)

* HL7 MLLP Connector

To use HL7 MLLP Connector, you must have:

* Purchased a MuleSoft license for Anypoint B2B

* Anypoint Studio 7.0 or later

* Java 8

== To Connect in Studio

. click a trigger such as an HTTP Listener or Scheduler and configure the trigger.
+
Because the connector has only two operations to listen (source) and to send, you can choose which one to use.
+
. For the Listener (Source), click the trigger and select Mule HL7 MLLP.
+
You also can create a TLS configuration, you can set the timeout configuration and the buffer configuration.

NOTE: If your app is running at mllp-rnnf.us-e1.cloudhub.io, you can send HL7 messages over MLLP to your Mule app to mule-worker-mllp-rnnf.us-e1.cloudhub.io


=== Send Operation Configuration

The Send operation the procedure is identical, except that you can set the Local Address Settings tab within the connector config with a different host, port, and delimiter that specifies the character used to separate messages.

You can also set the send or receive buffer size.

=== Configure in Studio

+
** Delimiter: The standard HL7 delimiter value that separates
MLLP messages. It is a hexadecimal 0x1C character also known as FS. Applications in some clinics use a different delimiter value, that can be set this field. The standard value in the
HL7 MLLP connector is shown as `001C`.
+
** Host: Sets the socket host address.
** Port: Sets the socket port.
+
For an advanced connection, complete these fields:
+
** Reuse address: Whether to reuse the configured socket or fail when trying to bind to the socket.
** Send TCP With No Delay: Whether or not to transmit data immediately, or collect data for greater efficiency before sending.
** Linger: How long in milliseconds that the socket takes to close so any remaining data transmits correctly.
** Keep alive: Whether to close open socket connections that are unused for a long period and with an unavailable connection.
** Fail on unresolved host: Whether the socket should fail during its creation if the host set on the endpoint cannot be resolved.

In the TLS tab you can configure a new TLS configuration, its presence implies the use of SSLServerSocket instead of plain TCP.

You can also set the send or receive buffer size.

== Example - Read and Write Message

image::hl7-mllp-demo-flow-1.png[MLLP Demo Flow in Studio 7]

image:hl7-mllp-demo-flow-2.png[MLLP Demo Flow in Studio 7]

image::hl7-mllp-demo-flow-3.png[MLLP Demo Flow in Studio 7]

This example workflow sequentially invokes read and write HL7 messages over the MLLP protocol:

* writer-flow: Sends the given message through the socket to be received by the reader-flow.

* reader-flow: Receive a MLLP message, and log the message.

* The app, index, styles, app-config, rest-service, order-controller, and write-order are used to load static resources related to the user interface.

=== Example Use Case XML - read and write HL7 messages over the MLLP protocol

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
xmlns:mllp="http://www.mulesoft.org/schema/mule/mllp"
xmlns="http://www.mulesoft.org/schema/mule/core"
xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core
http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/mllp
http://www.mulesoft.org/schema/mule/mllp/current/mule-mllp.xsd
http://www.mulesoft.org/schema/mule/http
http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core
http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<mllp:mllp-listener-config name="Mule_HL7_MLLP_Listener_config"
	doc:name="Mule HL7 MLLP Listener config">
		<mllp:mllp-listener-connection host="localhost" port="40000" />
	</mllp:mllp-listener-config>
	<mllp:request-config name="Mule_HL7_MLLP_Request_config"
	doc:name="Mule HL7 MLLP Request config">
		<mllp:mllp-requester-connection host="localhost" port="40000" >
			<mllp:local-address-settings port="49999" host="localhost" />
		</mllp:mllp-requester-connection>
	</mllp:request-config>
	<http:listener-config name="HTTP_Listener_config"
	doc:name="HTTP Listener config">
		<http:listener-connection host="localhost" port="8081" />
	</http:listener-config>
	<flow name="reader-flow">
		<mllp:mllp-listener doc:name="Mllp listener"
		config-ref="Mule_HL7_MLLP_Mllp_listener_config"/>
		<logger level="INFO" doc:name="Logger" message="#[payload]"/>
	</flow>
	<flow name="writer-flow">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config"
		path="/send"/>
		<mllp:send doc:name="Send" config-ref="Mule_HL7_MLLP_Request_config">
		</mllp:send>
	</flow>
	<flow name="index">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config"
		path="/"/>
		<parse-template doc:name="Parse Template"
		 location="ui-demo/index.html"/>
	</flow>
	<flow name="styles">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config"
		path="/styles"/>
		<parse-template doc:name="Parse Template"
		location="ui-demo/styles/styles.css"/>
	</flow>
	<flow name="app-config">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config" path="/app-config"/>
		<parse-template doc:name="Parse Template"
		location="ui-demo/app-config.js"/>
	</flow>
	<flow name="app">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config"
		path="/app"/>
		<parse-template doc:name="Parse Template"
		location="ui-demo/app.js"/>
	</flow>
	<flow name="rest-service">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config"
		path="services/restService"/>
		<parse-template doc:name="Parse Template"
		location="ui-demo/services/restService.js"/>
	</flow>
	<flow name="order-controller">
		<http:listener doc:name="Listener" config-ref="HTTP_Listener_config"
		path="order/order.controller"/>
		<parse-template doc:name="Parse Template"
		location="ui-demo/order/order.controller.js"/>
	</flow>
	<flow name="write-order">
		<http:listener doc:name="Listener"
		config-ref="HTTP_Listener_config"
		path="/order/writeOrder"/>
		<parse-template doc:name="Parse Template"
		location="ui-demo/order/writeOrder.html"/>
	</flow>
</mule>
----

== See Also

* xref:release-notes::connector/hl7-mllp-connector-release-notes-mule-4.adoc[HL7 MLLP Connector Release Notes]
* https://www.mulesoft.com/exchange/com.mulesoft.connectors/mule-hl7-mllp-connector/[HL7 MLLP Connector in Anypoint Exchange]
